<!DOCTYPE html>
<html lang="en-UK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>SkillsConnect | Learning Made Simple</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- jsPDF library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        input, textarea, button, select, a {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        /* Prevent zoom on input focus */
        input, textarea, select, button {
            font-size: 16px !important;
            -webkit-appearance: none !important;
            -moz-appearance: none !important;
            appearance: none !important;
            touch-action: manipulation !important;
        }

        input:focus, textarea:focus, select:focus, button:focus {
            font-size: 16px !important;
            outline: none;
        }

        html, body {
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden;
            touch-action: none;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        }
        
        /* Login Modal Transitions */
        #loginModal {
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        #loginModal.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        /* Sidebar Transitions */
        .sidebar {
            transition: all 0.3s ease;
            width: 256px; /* Default width for desktop */
            flex-shrink: 0; /* Prevent shrinking */
            background: linear-gradient(135deg, #4F46E5 0%, #6366F1 100%);
            box-shadow: 4px 0 12px rgba(79, 70, 229, 0.15);
        }
        /* Adjust content area margin based on sidebar state */
        .content-area {
            transition: margin-left 0.3s ease;
            margin-left: 0; /* No margin needed - sidebar is in flex container */
            flex-grow: 1;
        }

        /* Mobile specific sidebar */
        @media (max-width: 1023px) { /* Tailind's lg breakpoint is 1024px */
            .sidebar {
                position: fixed;
                z-index: 1000;
                transform: translateX(-100%);
                box-shadow: 0 0 20px rgba(79, 70, 229, 0.3);
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .content-area {
                margin-left: 0 !important; /* No left margin on mobile */
            }
            .mobile-menu-btn {
                display: block; /* Show mobile menu button */
            }
            #toggleSidebar { /* Hide desktop toggle button on mobile and desktop */
                display: none !important;
            }
        }
        @media (min-width: 1024px) {
            .mobile-menu-btn { /* Hide mobile menu button on desktop */
                display: none;
            }
        }

        /* Course card hover effect */
        .course-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(79, 70, 229, 0.15);
        }
        
        /* Notification badge positioning */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* Dropdown menu hidden by default, shown by JS */
        .dropdown-menu {
            display: none;
            position: absolute;
            right: 0;
            z-index: 1000;
            animation: slideDown 0.2s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Active sidebar item styling */
        .sidebar-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            margin: 4px 8px;
            border-radius: 10px;
            color: rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
            position: relative;
        }
        .sidebar-item:hover {
            background-color: rgba(255, 255, 255, 0.15);
            color: #fff;
            transform: translateX(4px);
        }
        .sidebar-item.active {
            background-color: rgba(255, 255, 255, 0.25);
            color: #fff;
            font-weight: 600;
            box-shadow: inset 3px 0 0 #fff;
        }
        .sidebar-item i {
            width: 24px; /* Ensure icon has consistent width */
            text-align: center;
        }

        /* Content section hidden by default */
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }

        /* Message Modal specific styles */
        #messageModal, #addUserModal, #pdfViewerModal, #assignStudentsModal, #createAssignmentModal, #viewAssignmentModal {
            transition: opacity 0.3s ease, transform 0.3s ease;
            transform: translateY(20px);
        }
        #messageModal.show, #addUserModal.show, #pdfViewerModal.show, #assignStudentsModal.show, #createAssignmentModal.show, #viewAssignmentModal.show {
            opacity: 1;
            transform: translateY(0);
        }
        #messageModal.hidden, #addUserModal.hidden, #pdfViewerModal.hidden, #assignStudentsModal.hidden, #createAssignmentModal.hidden, #viewAssignmentModal.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        /* Enhanced Card Styling */
        .bg-white {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
        
        /* Enhanced Shadow for Cards */
        .shadow {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08), 0 4px 12px rgba(79, 70, 229, 0.08);
            transition: box-shadow 0.3s ease;
        }
        
        .shadow:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12), 0 8px 24px rgba(79, 70, 229, 0.12);
        }
        
        /* Button Enhancements */
        button {
            transition: all 0.3s ease;
        }
        
        .bg-indigo-600 {
            background: linear-gradient(135deg, #4F46E5 0%, #6366F1 100%);
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
        }
        
        .bg-indigo-600:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.4);
        }
        
        .bg-green-600 {
            background: linear-gradient(135deg, #16A34A 0%, #22C55E 100%);
            box-shadow: 0 4px 15px rgba(22, 163, 74, 0.3);
        }
        
        .bg-green-600:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(22, 163, 74, 0.4);
        }
        
        /* Table Enhancements */
        thead {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        }
        
        tbody tr {
            border-bottom: 1px solid rgba(79, 70, 229, 0.08);
            transition: background-color 0.2s ease;
        }
        
        tbody tr:hover {
            background-color: rgba(79, 70, 229, 0.05);
        }
        
        /* Modal Enhancements */
        .fixed.inset-0.bg-gray-600 {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(4px);
        }
        
        .rounded-lg {
            border-radius: 12px;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100 font-sans antialiased" style="display: none;">

    <!-- Message Modal -->
    <div id="messageModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 shadow-xl max-w-sm w-full transform transition-all duration-300 scale-100 opacity-100">
            <h3 class="text-lg font-semibold text-gray-900 mb-4" id="messageModalTitle">Notification</h3>
            <p class="text-gray-700 mb-6" id="messageModalContent"></p>
            <div class="flex justify-end">
                <button
                    onclick="hideMessageModal()"
                    class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition ease-in-out duration-150"
                >
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 shadow-xl max-w-md w-full transform transition-all duration-300 scale-100 opacity-100">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Add New User</h3>
            <form id="addUserForm">
                <div class="mb-4 text-center">
                    <label class="block text-gray-700 text-sm font-medium mb-2">User Picture</label>
                    <img id="userPicturePreview" class="inline-block h-24 w-24 rounded-full mb-3 object-cover" src="https://placehold.co/96x96/E0E7FF/4F46E5?text=UP" alt="User Picture">
                    <input type="file" id="userPictureInput" class="block w-full text-sm text-gray-500
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-md file:border-0
                        file:text-sm file:font-semibold
                        file:bg-indigo-50 file:text-indigo-700
                        hover:file:bg-indigo-100"/>
                    <p class="text-xs text-gray-500 mt-1">PNG, JPG, up to 5MB</p>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="userNameInput">Name</label>
                    <input id="userNameInput" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter user's name">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="userSurnameInput">Surname</label>
                    <input id="userSurnameInput" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter user's surname">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="userEmailInput">Email Address</label>
                    <input id="userEmailInput" type="email" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter user's email">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="userIDNumberInput">ID Number</label>
                    <input id="userIDNumberInput" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter user's ID number">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="companyNameInput">Company Name</label>
                    <input id="companyNameInput" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter company name">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="userPasswordInput">Password</label>
                    <input id="userPasswordInput" type="password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter a password">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="newUserRoleSelect">Select Role</label>
                    <select id="newUserRoleSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="administrator">Administrator</option>
                        <option value="training_manager">Training Manager</option>
                        <option value="student">Student</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-3">
                    <button type="button" onclick="hideAddUserModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 transition ease-in-out duration-150">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition ease-in-out duration-150">
                        Add User
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bulk Upload Users Modal -->
    <div id="bulkUploadModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 shadow-xl max-w-md w-full transform transition-all duration-300 scale-100 opacity-100">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Bulk Upload Users</h3>
            <form id="bulkUploadForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2">Upload CSV File</label>
                    <p class="text-gray-600 text-xs mb-3">CSV format: name, email, idNumber, company, role (administrator/training_manager/student), password</p>
                    <input type="file" id="bulkUploadFileInput" accept=".csv" class="block w-full text-sm text-gray-500
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-md file:border-0
                        file:text-sm file:font-semibold
                        file:bg-indigo-50 file:text-indigo-700
                        hover:file:bg-indigo-100" required>
                    <p class="text-xs text-gray-500 mt-2">Only CSV files accepted. Max 1MB</p>
                </div>

                <div class="mb-4 bg-blue-50 p-3 rounded border border-blue-200">
                    <p class="text-xs text-blue-700"><strong>CSV Template Example:</strong></p>
                    <p class="text-xs text-blue-600 font-mono mt-1">John Doe,john@example.com,EMP001,TechCorp,student,password123</p>
                    <p class="text-xs text-blue-600 font-mono">Jane Smith,jane@example.com,EMP002,TechCorp,training_manager,password123</p>
                </div>

                <div id="uploadProgress" class="mb-4 hidden">
                    <p class="text-sm text-gray-700 mb-2">Processing: <span id="uploadProgressText">0/0</span></p>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="uploadProgressBar" class="bg-indigo-600 h-2 rounded-full" style="width: 0%"></div>
                    </div>
                </div>

                <div id="uploadResults" class="mb-4 hidden">
                    <div class="bg-green-50 border border-green-200 rounded p-2">
                        <p class="text-xs font-semibold text-green-700">Successfully Added: <span id="successCount">0</span></p>
                    </div>
                    <div id="errorResults" class="bg-red-50 border border-red-200 rounded p-2 mt-2 hidden">
                        <p class="text-xs font-semibold text-red-700">Errors: <span id="errorCount">0</span></p>
                        <ul id="errorList" class="text-xs text-red-600 mt-1 list-disc list-inside max-h-24 overflow-y-auto"></ul>
                    </div>
                </div>

                <div class="flex justify-end space-x-3">
                    <button type="button" onclick="hideBulkUploadModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none">
                        <i class="fas fa-upload mr-1"></i> Upload
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Login Modal -->
    <!-- Test Credentials:
         Admin: username "admin", role "Administrator"
         Training Manager: username "jane", role "Training Manager"
         Student: username "alice", role "Student" (has 2 enrolled courses, 65 hours spent, 2 badges earned)
         Student: username "bob", role "Student" (has 1 enrolled course, 30 hours spent)
    -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-2xl p-8 w-full max-w-md border border-gray-100">
            <div class="text-center mb-8">
                <div class="inline-block p-4 rounded-lg bg-gradient-to-br from-indigo-100 to-indigo-50 mb-4">
                    <i class="fas fa-graduation-cap text-indigo-600 text-4xl"></i>
                </div>
                <h2 class="text-3xl font-bold bg-gradient-to-r from-indigo-600 to-indigo-400 bg-clip-text text-transparent">SKILLSCONNECT</h2>
                <p class="text-gray-600 mt-2">Welcome back to your learning hub</p>
            </div>
            <form id="loginForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-semibold mb-2" for="loginUsernameInput">Username</label>
                    <input id="loginUsernameInput" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition" placeholder="Enter your username">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-semibold mb-2" for="loginPasswordInput">Password</label>
                    <input id="loginPasswordInput" type="password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition" placeholder="Enter your password">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-semibold mb-2" for="userRoleSelect">Select Role</label>
                    <select id="userRoleSelect" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition bg-white">
                        <option value="administrator">Administrator</option>
                        <option value="training_manager">Training Manager</option>
                        <option value="student">Student</option>
                    </select>
                </div>
                <button type="submit" class="w-full bg-gradient-to-r from-indigo-600 to-indigo-500 text-white py-3 px-4 rounded-lg hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 font-semibold transition transform hover:-translate-y-0.5">
                    Sign In
                </button>
                <div class="mt-4 text-center text-sm text-gray-600">
                    <a href="#" class="text-indigo-600 hover:text-indigo-700 font-medium transition">Forgot password?</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for viewing PDF (simulated) -->
    <div id="pdfViewerModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 shadow-xl max-w-2xl w-full transform transition-all duration-300 scale-100 opacity-100">
            <h3 class="text-lg font-semibold text-gray-900 mb-4" id="pdfModalTitle">View Document</h3>
            <div class="mb-4 h-64 overflow-y-auto border border-gray-300 p-2 rounded-md bg-gray-50 text-gray-700">
                <p>Simulating PDF content here for: <span id="simulatedPdfContentFileName" class="font-medium"></span></p>
                <p class="mt-2 text-sm text-gray-600">In a real application, an embedded PDF viewer (e.g., using PDF.js or a Google Docs Viewer iframe) would display the document here.</p>
                <p class="mt-2 text-xs text-gray-500">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                <p class="mt-2 text-xs text-gray-500">Section 2: Detailed analysis and findings. Proin eget tortor risus. Curabitur arcu erat, accumsan id imperdiet et, porttitor at sem. Vestibulum ac diam sit amet quam vehicula elementum sed sit amet dui.</p>
                <p class="mt-2 text-xs text-gray-500">Conclusion: Summary of key takeaways and next steps. Cras ultricies ligula sed magna dictum porta. Nulla porttitor accumsan tincidunt. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Donec velit neque, auctor sit amet aliquam vel, ullamcorper sit amet ligula.</p>
            </div>
            <div class="flex justify-end space-x-3">
                <button
                    onclick="hidePdfViewerModal()"
                    class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 transition ease-in-out duration-150"
                >
                    Close
                </button>
                <button
                    id="markAsReadBtn"
                    class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition ease-in-out duration-150"
                >
                    Mark as Read
                </button>
            </div>
        </div>
    </div>

    <!-- Assign Students Modal -->
    <div id="assignStudentsModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 shadow-xl max-w-md w-full transform transition-all duration-300 scale-100 opacity-100">
            <h3 class="text-lg font-semibold text-gray-900 mb-4" id="assignStudentsModalTitle">Assign Students to Programme</h3>
            <div class="mb-4 max-h-60 overflow-y-auto border border-gray-300 rounded-md p-2">
                <p id="noStudentsAvailable" class="text-gray-500 text-sm text-center py-4 hidden">No students available. Add students via User Management first.</p>
                <div id="assignStudentsList" class="space-y-2">
                    <!-- Student checkboxes will be loaded here -->
                </div>
            </div>
            <div class="flex justify-end space-x-3">
                <button type="button" onclick="hideAssignStudentsModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none">
                    Cancel
                </button>
                <button type="button" id="saveAssignedStudentsBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none">
                    Save Assignments
                </button>
            </div>
        </div>
    </div>

    <!-- FIX: Create Assignment Modal (for Training Manager) -->
    <div id="createAssignmentModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 shadow-xl max-w-lg w-full transform transition-all duration-300 scale-100 opacity-100">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Create New Assignment</h3>
            <form id="createAssignmentForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="assignToStudentSelect">Assign to Student</label>
                    <select id="assignToStudentSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <!-- Students will be populated here by JS -->
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="assignmentTitleInput">Assignment Title</label>
                    <input id="assignmentTitleInput" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="e.g., Chapter 1 Review">
                </div>
                 <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="assignmentDueDateInput">Due Date</label>
                    <input id="assignmentDueDateInput" type="date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="assignmentInstructionsTextarea">Instructions</label>
                    <textarea id="assignmentInstructionsTextarea" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="4" placeholder="Provide clear instructions for the student..."></textarea>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="assignmentDocumentInput">Upload Document (Word, PDF)</label>
                    <input type="file" id="assignmentDocumentInput" accept=".pdf,.doc,.docx" class="block w-full text-sm text-gray-500
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-md file:border-0
                        file:text-sm file:font-semibold
                        file:bg-indigo-50 file:text-indigo-700
                        hover:file:bg-indigo-100"/>
                    <p id="assignmentDocFileName" class="text-xs text-gray-500 mt-1 hidden"></p>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="assignmentMarksInput">Total Marks</label>
                    <input id="assignmentMarksInput" type="number" class="w-28 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="e.g., 100" min="0">
                </div>
                <div class="flex justify-end space-x-3">
                    <button type="button" onclick="hideCreateAssignmentModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none">
                        Create & Assign
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- FIX: View Assignment Modal (for Student) -->
    <div id="viewAssignmentModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 shadow-xl max-w-xl w-full transform transition-all duration-300 scale-100 opacity-100">
            <h3 class="text-2xl font-semibold text-gray-900 mb-2" id="viewAssignmentTitle">Assignment Title</h3>
            <p class="text-sm text-gray-500 mb-4">Due: <span id="viewAssignmentDueDate"></span> | Total Marks: <span id="viewAssignmentTotalMarks" class="font-bold"></span></p>
            
            <div class="mb-4 border-t pt-4">
                <h4 class="text-md font-semibold text-gray-800 mb-2">Instructions:</h4>
                <p class="text-gray-700 text-sm whitespace-pre-wrap" id="viewAssignmentInstructions"></p>
            </div>
            
             <div class="mb-6 border-t pt-4" id="viewAssignmentDocumentSection">
                <h4 class="text-md font-semibold text-gray-800 mb-2">Attached Document:</h4>
                <a href="#" id="viewAssignmentDownloadLink" target="_blank" class="text-indigo-600 hover:text-indigo-800 hover:underline">
                    <i class="fas fa-file-download mr-2"></i><span id="viewAssignmentDocName">document.pdf</span>
                </a>
            </div>

            <div class="flex justify-between items-center">
                 <button onclick="hideViewAssignmentModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none">
                    Close
                </button>
                <button id="submitAssignmentBtn" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none">
                    <i class="fas fa-check-circle mr-2"></i>Mark as Submitted
                </button>
            </div>
        </div>
    </div>

    <!-- Certificate Viewer Modal -->
    <div id="certificateViewerModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 shadow-xl max-w-2xl w-full transform transition-all duration-300 scale-100 opacity-100">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-900" id="certificateViewerTitle">View Certificate</h3>
                <button onclick="closeCertificateViewer()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="mb-4 bg-gradient-to-br from-amber-50 to-yellow-50 p-8 rounded-lg border-2 border-amber-200 text-center min-h-96 flex flex-col justify-center items-center" id="certificateDisplayArea">
                <div class="text-6xl mb-4 text-amber-600">
                    <i class="fas fa-certificate"></i>
                </div>
                <h2 class="text-3xl font-bold text-amber-900 mb-2" id="certificateName">Certificate of Achievement</h2>
                <p class="text-gray-600 mb-4">This certifies that</p>
                <p class="text-2xl font-semibold text-gray-800 mb-6" id="certificateStudentName">Student Name</p>
                <p class="text-gray-600 mb-2">has successfully completed</p>
                <p class="text-lg font-semibold text-gray-800 mb-6" id="certificateCourseName">Course Name</p>
                <p class="text-sm text-gray-600 mb-6">Date: <span id="certificateDate"></span></p>
                <p class="text-xs text-gray-500 italic">Certificate ID: <span id="certificateId"></span></p>
            </div>
            <div class="flex justify-end space-x-3">
                <button onclick="downloadCertificate()" class="px-4 py-2 bg-amber-600 text-white rounded-md hover:bg-amber-700 focus:outline-none">
                    <i class="fas fa-download mr-2"></i> Download
                </button>
                <button onclick="closeCertificateViewer()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Badge Viewer Modal -->
    <div id="badgeViewerModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 shadow-xl max-w-md w-full transform transition-all duration-300 scale-100 opacity-100">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-900" id="badgeViewerTitle">Badge Details</h3>
                <button onclick="closeBadgeViewer()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="mb-4 text-center">
                <div class="text-8xl mb-4" id="badgeViewerIcon">üèÖ</div>
                <h2 class="text-2xl font-bold text-gray-900 mb-2" id="badgeViewerName">Badge Name</h2>
                <p class="text-gray-600 mb-4" id="badgeViewerDescription">Badge description</p>
                <div class="bg-blue-50 p-3 rounded-lg mb-4">
                    <p class="text-sm text-gray-700"><strong>Requirements:</strong> <span id="badgeViewerRequirement">Complete requirement</span></p>
                </div>
                <div class="bg-green-50 p-2 rounded mb-4">
                    <p class="text-xs text-green-700" id="badgeViewerStatus">Earned on: <span id="badgeEarnedDate"></span></p>
                </div>
            </div>
            <div class="flex justify-end">
                <button onclick="closeBadgeViewer()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Course Viewer Modal (with Sections, Video and Questions) -->
    <div id="courseViewerModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden overflow-y-auto">
        <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full m-4 transform transition-all duration-300">
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h2 class="text-2xl font-semibold text-gray-900" id="courseViewerTitle">Course Title</h2>
                <button onclick="closeCourseViewer()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="p-6">
                <!-- Course Info -->
                <div class="mb-6">
                    <p class="text-gray-600 mb-2" id="courseViewerDescription">Course description</p>
                    <div class="flex space-x-4 text-sm text-gray-600">
                        <span><i class="fas fa-book mr-2"></i>Course ID: <span id="courseViewerCourseId"></span></span>
                        <span><i class="fas fa-star mr-2"></i>Progress: <span id="courseViewerProgress"></span>%</span>
                    </div>
                </div>

                <!-- Section/Chapter Tabs -->
                <div class="mb-6 border-b border-gray-200">
                    <div class="flex overflow-x-auto space-x-4 pb-3" id="sectionTabsContainer">
                        <!-- Section tabs will be inserted here -->
                    </div>
                </div>

                <!-- Video Placeholder -->
                <div class="mb-6">
                    <div id="videoPlayer" class="bg-black rounded-lg overflow-hidden flex items-center justify-center h-96 mb-4 relative group cursor-pointer">
                        <div class="absolute inset-0 bg-gray-900 flex flex-col items-center justify-center">
                            <i class="fas fa-play-circle text-6xl text-white mb-4 group-hover:scale-110 transition"></i>
                            <p class="text-white text-lg">Video Player</p>
                            <p class="text-gray-400 text-sm mt-2">Click to play section video</p>
                        </div>
                    </div>
                    <div class="bg-gray-100 p-3 rounded text-sm text-gray-600">
                        <p><strong>Video Duration:</strong> <span id="courseVideoDuration">15 minutes</span></p>
                    </div>
                </div>

                <!-- Section Title -->
                <h3 class="text-lg font-semibold text-gray-800 mb-4" id="sectionTitle">Section Title</h3>

                <!-- Questions Section -->
                <div class="border-t pt-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Section Questions</h3>
                    <div id="courseQuestionsContainer" class="space-y-4">
                        <p class="text-gray-500 text-center py-8">Loading questions...</p>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex justify-between mt-8 pt-6 border-t border-gray-200">
                    <button onclick="closeCourseViewer()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none">
                        Close
                    </button>
                    <button id="submitCourseAnswersBtn" class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none">
                        <i class="fas fa-check mr-2"></i>Submit Answers
                    </button>
                </div>
            </div>
        </div>
    </div>


    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <div id="sidebar" class="sidebar bg-gradient-to-b from-indigo-800 to-indigo-900 text-white flex flex-col">
            <!-- Logo -->
            <div class="p-6 flex items-center justify-between border-b border-indigo-700/50">
                <div class="flex items-center space-x-3">
                    <span class="logo-text text-xl font-bold">SKILLSCONNECT</span>
                </div>
                <button id="toggleSidebar" class="text-white focus:outline-none hidden lg:block hover:bg-white/10 p-2 rounded transition">
                    <i class="fas fa-bars"></i>
                </button>
                <button id="mobileCloseSidebarBtn" class="text-white focus:outline-none lg:hidden hover:bg-white/10 p-2 rounded transition">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- User Info -->
            <div class="user-info p-6 flex items-center border-b border-indigo-700/50 bg-white/5 backdrop-blur">
                <img src="https://placehold.co/40x40/FF5733/FFFFFF?text=U" alt="User" class="w-10 h-10 rounded-full mr-3 ring-2 ring-white/30">
                <div>
                    <div class="font-semibold text-sm" id="sidebarUsername"></div>
                    <div class="text-xs text-indigo-200" id="sidebarUserrole"></div>
                </div>
            </div>
            
            <!-- Navigation -->
            <nav class="flex-1 overflow-y-auto">
                <div id="adminNav" class="nav-section">
                    <div class="p-6 text-xs uppercase text-indigo-300 font-bold sidebar-text tracking-wider">Administration</div>
                    <a href="#" class="sidebar-item active" data-section="dashboard">
                        <i class="fas fa-tachometer-alt mr-3"></i>
                        <span class="sidebar-text">Dashboard</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="user-management">
                        <i class="fas fa-users mr-3"></i>
                        <span class="sidebar-text">User Management</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="course-content">
                        <i class="fas fa-file-upload mr-3"></i>
                        <span class="sidebar-text">Course Content</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="reports">
                        <i class="fas fa-chart-bar mr-3"></i>
                        <span class="sidebar-text">Reports</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="system-settings">
                        <i class="fas fa-cog mr-3"></i>
                        <span class="sidebar-text">Settings</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="certificates-management">
                        <i class="fas fa-certificate mr-3"></i>
                        <span class="sidebar-text">Certificates</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="badges-management">
                        <i class="fas fa-medal mr-3"></i>
                        <span class="sidebar-text">Badges</span>
                    </a>
                </div>
                
                <div id="trainingManagerNav" class="nav-section hidden">
                    <div class="p-6 text-xs uppercase text-indigo-300 font-bold sidebar-text tracking-wider">Management</div>
                    <a href="#" class="sidebar-item active" data-section="dashboard">
                        <i class="fas fa-tachometer-alt mr-3"></i>
                        <span class="sidebar-text">Dashboard</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="my-courses">
                        <i class="fas fa-book mr-3"></i>
                        <span class="sidebar-text">My Courses</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="programme-management">
                        <i class="fas fa-sitemap mr-3"></i>
                        <span class="sidebar-text">Programmes</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="course-content">
                        <i class="fas fa-file-upload mr-3"></i>
                        <span class="sidebar-text">Course Overview</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="user-programme-assignment">
                        <i class="fas fa-user-tag mr-3"></i>
                        <span class="sidebar-text">Assign Students</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="assignments">
                        <i class="fas fa-tasks mr-3"></i>
                        <span class="sidebar-text">Assignments</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="grades">
                        <i class="fas fa-graduation-cap mr-3"></i>
                        <span class="sidebar-text">Gradebook</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="certificate-templates">
                        <i class="fas fa-certificate mr-3"></i>
                        <span class="sidebar-text">Certificates</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="badges-created">
                        <i class="fas fa-medal mr-3"></i>
                        <span class="sidebar-text">Badges</span>
                    </a>
                </div>
                
                <div id="studentNav" class="nav-section hidden">
                    <div class="p-6 text-xs uppercase text-indigo-300 font-bold sidebar-text tracking-wider">Learning</div>
                    <a href="#" class="sidebar-item active" data-section="dashboard">
                        <i class="fas fa-tachometer-alt mr-3"></i>
                        <span class="sidebar-text">Dashboard</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="enrolled-courses">
                        <i class="fas fa-book mr-3"></i>
                        <span class="sidebar-text">My Courses</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="student-assignments">
                        <i class="fas fa-tasks mr-3"></i>
                        <span class="sidebar-text">Assignments</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="my-grades">
                        <i class="fas fa-graduation-cap mr-3"></i>
                        <span class="sidebar-text">My Grades</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="my-certificates">
                        <i class="fas fa-certificate mr-3"></i>
                        <span class="sidebar-text">My Certificates</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="my-badges">
                        <i class="fas fa-medal mr-3"></i>
                        <span class="sidebar-text">My Badges</span>
                    </a>
                    <a href="#" class="sidebar-item" data-section="calendar">
                        <i class="fas fa-calendar-alt mr-3"></i>
                        <span class="sidebar-text">Calendar</span>
                    </a>
                </div>
                
                <div class="p-6 text-xs uppercase text-indigo-300 font-bold sidebar-text tracking-wider border-t border-indigo-700/50 mt-4">Account</div>
                <a href="#" class="sidebar-item" data-section="profile">
                    <i class="fas fa-user mr-3"></i>
                    <span class="sidebar-text">Profile</span>
                </a>
                <a href="#" class="sidebar-item" data-section="messages">
                    <i class="fas fa-envelope mr-3"></i>
                    <span class="sidebar-text">Messages</span>
                    <span class="notification-badge bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">2</span>
                </a>
                <a href="#" class="sidebar-item" data-section="notifications">
                    <i class="fas fa-bell mr-3"></i>
                    <span class="sidebar-text">Notifications</span>
                    <span class="notification-badge bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">5</span>
                </a>
                <a href="#" class="sidebar-item" id="logoutBtn">
                    <i class="fas fa-sign-out-alt mr-3"></i>
                    <span class="sidebar-text">Logout</span>
                </a>
            </nav>
        </div>
        
        <!-- Main Content -->
        <div id="contentArea" class="content-area flex-1 overflow-y-auto">
            <!-- Top Navigation -->
            <header class="bg-white shadow-sm border-b border-gray-100">
                <div class="flex items-center justify-between px-6 py-4">
                    <div class="flex items-center">
                        <button id="mobileMenuBtn" class="mobile-menu-btn text-gray-600 mr-4 focus:outline-none lg:hidden hover:text-indigo-600 transition">
                            <i class="fas fa-bars text-xl"></i>
                        </button>
                        <div>
                            <h1 class="text-2xl font-bold bg-gradient-to-r from-indigo-600 to-indigo-400 bg-clip-text text-transparent" id="pageTitle">Dashboard</h1>
                            <p class="text-xs text-gray-500 mt-1">Welcome to your learning hub</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <button class="text-gray-600 focus:outline-none">
                                <i class="fas fa-search text-xl"></i>
                            </button>
                        </div>
                        
                        <div class="relative dropdown">
                            <button type="button" class="text-gray-600 focus:outline-none relative" onclick="toggleDropdown(this)">
                                <i class="fas fa-bell text-xl"></i>
                                <span class="notification-badge bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                            </button>
                            <div class="dropdown-menu hidden mt-2 w-64 bg-white rounded-md shadow-lg py-1">
                                <div class="px-4 py-2 border-b border-gray-200">
                                    <h3 class="text-sm font-semibold text-gray-800">Notifications</h3>
                                </div>
                                <p class="block px-4 py-2 text-sm text-gray-700">No new notifications.</p>
                                <div class="px-4 py-2 border-t border-gray-200">
                                    <a href="#" class="text-xs text-indigo-600 hover:underline">View all notifications</a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="relative dropdown">
                            <button type="button" class="flex items-center focus:outline-none" onclick="toggleDropdown(this)">
                                <img src="https://placehold.co/32x32/FF5733/FFFFFF?text=U" alt="User" class="w-8 h-8 rounded-full">
                                <span class="ml-2 text-gray-700 hidden md:inline" id="topNavUsername">Admin User</span>
                                <i class="fas fa-chevron-down ml-1 text-gray-600 text-xs hidden md:inline"></i>
                            </button>
                            <div class="dropdown-menu hidden mt-2 w-48 bg-white rounded-md shadow-lg py-1">
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-section="profile">
                                    <i class="fas fa-user mr-2"></i> Profile
                                </a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-section="system-settings">
                                    <i class="fas fa-cog mr-2"></i> Settings
                                </a>
                                <div class="border-t border-gray-200"></div>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" id="topLogoutBtn">
                                    <i class="fas fa-sign-out-alt mr-2"></i> Logout
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Page Content -->
            <main class="p-6 flex-1 overflow-y-auto">
                <!-- Dashboard Content -->
                <div id="dashboardContent" class="content-section active">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent">Welcome back, <span id="greetingName"></span>!</h2>
                        <p class="text-gray-600 mt-2">Here's your learning hub snapshot for today</p>
                    </div>
                    
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6" id="adminStatsCards">
                        <div class="bg-white rounded-lg shadow p-6 border-l-4 border-green-500 hover:shadow-lg transition">
                            <div class="flex items-center">
                                <div class="p-3 rounded-lg bg-gradient-to-br from-green-100 to-green-50 text-green-600 mr-4">
                                    <i class="fas fa-book text-xl"></i>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 font-medium">Total Courses</p>
                                    <h3 class="text-3xl font-bold text-gray-900" id="totalCourses">0</h3>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6 border-l-4 border-blue-500 hover:shadow-lg transition" id="totalStudentsCard">
                            <div class="flex items-center">
                                <div class="p-3 rounded-lg bg-gradient-to-br from-blue-100 to-blue-50 text-blue-600 mr-4">
                                    <i class="fas fa-users text-xl"></i>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 font-medium">Total Students</p>
                                    <h3 class="text-3xl font-bold text-gray-900" id="totalStudents">0</h3>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6 border-l-4 border-purple-500 hover:shadow-lg transition">
                            <div class="flex items-center">
                                <div class="p-3 rounded-lg bg-gradient-to-br from-purple-100 to-purple-50 text-purple-600 mr-4">
                                    <i class="fas fa-star text-xl"></i>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 font-medium">Avg. Course Rating</p>
                                    <h3 class="text-3xl font-bold text-gray-900" id="studentGPA">N/A</h3>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Student Stats Cards (Hidden by default) -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6" id="studentStatsCards" style="display: none;">
                        <div class="bg-white rounded-lg shadow p-6 border-l-4 border-blue-500 hover:shadow-lg transition">
                            <div class="flex items-center">
                                <div class="p-3 rounded-lg bg-gradient-to-br from-blue-100 to-blue-50 text-blue-600 mr-4">
                                    <i class="fas fa-clock text-xl"></i>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 font-medium">Total Hours Spent</p>
                                    <h3 class="text-3xl font-bold text-gray-900" id="studentTotalHours">0</h3>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6 border-l-4 border-purple-500 hover:shadow-lg transition">
                            <div class="flex items-center">
                                <div class="p-3 rounded-lg bg-gradient-to-br from-purple-100 to-purple-50 text-purple-600 mr-4">
                                    <i class="fas fa-trophy text-xl"></i>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 font-medium">Badges Earned</p>
                                    <h3 class="text-3xl font-bold text-gray-900" id="studentBadgesCount">0</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Activity -->
                    <div class="bg-white rounded-lg shadow p-6 mb-6" id="recentActivitySection">
                        <div class="flex justify-between items-center mb-6 pb-4 border-b border-gray-100">
                            <div>
                                <h3 class="text-lg font-bold text-gray-900">Recent Activity</h3>
                                <p class="text-sm text-gray-600 mt-1">Latest updates in your system</p>
                            </div>
                            <a href="#" class="text-sm text-indigo-600 hover:text-indigo-700 font-medium transition">View all ‚Üí</a>
                        </div>
                        <div class="space-y-4" id="recentActivityList">
                            <p class="text-gray-500 text-sm text-center py-4">No recent activity to display.</p>
                        </div>
                    </div>

                    <!-- Recent Notifications (For Students) -->
                    <div class="bg-white rounded-lg shadow p-6 mb-6" id="recentNotificationsSection" style="display: none;">
                        <div class="flex justify-between items-center mb-6 pb-4 border-b border-gray-100">
                            <div>
                                <h3 class="text-lg font-bold text-gray-900">Recent Notifications</h3>
                                <p class="text-sm text-gray-600 mt-1">Stay updated with latest news</p>
                            </div>
                            <a href="#" class="text-sm text-indigo-600 hover:text-indigo-700 font-medium transition">Mark all as read ‚Üí</a>
                        </div>
                        <div class="space-y-3" id="recentNotificationsList">
                            <p class="text-gray-500 text-sm text-center py-4">No notifications to display.</p>
                        </div>
                    </div>

                    <!-- Badges Earned Summary (For Students) -->
                    <div class="bg-white rounded-lg shadow p-6 mb-6" id="badgesEarnedSection" style="display: none;">
                        <div class="flex justify-between items-center mb-6 pb-4 border-b border-gray-100">
                            <div>
                                <h3 class="text-lg font-bold text-gray-900">Recent Badges Received</h3>
                                <p class="text-sm text-gray-600 mt-1">Your latest achievements</p>
                            </div>
                            <a href="#" class="text-sm text-indigo-600 hover:text-indigo-700 font-medium transition">View all ‚Üí</a>
                        </div>
                        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4" id="badgesEarnedList">
                            <div class="text-center p-4 bg-gradient-to-br from-yellow-50 to-amber-50 rounded-lg border border-yellow-200">
                                <div class="text-4xl mb-2">üèÖ</div>
                                <p class="text-xs font-semibold text-gray-700">Quick Learner</p>
                                <p class="text-xs text-gray-500">Jan 15</p>
                            </div>
                            <div class="text-center p-4 bg-gradient-to-br from-blue-50 to-cyan-50 rounded-lg border border-blue-200">
                                <div class="text-4xl mb-2">‚≠ê</div>
                                <p class="text-xs font-semibold text-gray-700">Star Student</p>
                                <p class="text-xs text-gray-500">Jan 10</p>
                            </div>
                            <div class="text-center p-4 bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg border border-green-200">
                                <div class="text-4xl mb-2">üéØ</div>
                                <p class="text-xs font-semibold text-gray-700">Goal Setter</p>
                                <p class="text-xs text-gray-500">Jan 5</p>
                            </div>
                            <div class="text-center p-4 bg-gradient-to-br from-purple-50 to-indigo-50 rounded-lg border border-purple-200">
                                <div class="text-4xl mb-2">üöÄ</div>
                                <p class="text-xs font-semibold text-gray-700">Rising Star</p>
                                <p class="text-xs text-gray-500">Dec 28</p>
                            </div>
                        </div>
                    </div>

                    <!-- Certificates Earned (For Students) -->
                    <div class="bg-white rounded-lg shadow p-6 mb-6" id="certificatesEarnedSection" style="display: none;">
                        <div class="flex justify-between items-center mb-6 pb-4 border-b border-gray-100">
                            <div>
                                <h3 class="text-lg font-bold text-gray-900">Certificates Earned</h3>
                                <p class="text-sm text-gray-600 mt-1">Your credentials</p>
                            </div>
                            <a href="#" class="text-sm text-indigo-600 hover:text-indigo-700 font-medium transition">View all ‚Üí</a>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="certificatesEarnedList">
                            <p class="text-gray-500 text-sm col-span-full text-center py-4">No certificates earned yet. Complete courses to earn certificates!</p>
                        </div>
                    </div>
                    
                    <!-- Courses/Assignments Section -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Courses -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex justify-between items-center mb-6 pb-4 border-b border-gray-100">
                                <div>
                                    <h3 class="text-lg font-bold text-gray-900" id="coursesTitle">All Courses</h3>
                                    <p class="text-sm text-gray-600 mt-1">Continue your learning</p>
                                </div>
                                <a href="#" class="text-sm text-indigo-600 hover:text-indigo-700 font-medium transition">View all ‚Üí</a>
                            </div>
                            <div class="space-y-4" id="coursesList">
                                <p class="text-gray-500 text-sm text-center py-4">No courses to display. Click "Course Content & Creation" to add new courses.</p>
                            </div>
                        </div>
                        
                        <!-- Assignments -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex justify-between items-center mb-6 pb-4 border-b border-gray-100">
                                <div>
                                    <h3 class="text-lg font-bold text-gray-900" id="assignmentsTitle">Recent Assignments</h3>
                                    <p class="text-sm text-gray-600 mt-1">Your tasks and submissions</p>
                                </div>
                                <a href="#" class="text-sm text-indigo-600 hover:text-indigo-700 font-medium transition">View all ‚Üí</a>
                            </div>
                            <div class="space-y-4" id="assignmentsList">
                                <p class="text-gray-500 text-sm text-center py-4">No recent assignments to display.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- User Management Content -->
                <div id="user-managementContent" class="content-section">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent">User Management</h2>
                        <p class="text-gray-600 mt-2">Create, edit, and manage all system users</p>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow overflow-hidden mb-6">
                        <div class="px-6 py-6 border-b border-gray-100 flex justify-between items-center bg-gradient-to-r from-gray-50 to-white">
                            <div>
                                <h3 class="text-lg font-bold text-gray-900">All Users</h3>
                                <p class="text-sm text-gray-600 mt-1">Manage system users</p>
                            </div>
                            <div class="flex space-x-2">
                                <button id="bulkUploadBtn" class="bg-gradient-to-r from-green-600 to-green-500 text-white px-4 py-2 rounded-lg text-sm hover:shadow-lg focus:outline-none font-medium transition transform hover:-translate-y-0.5">
                                    <i class="fas fa-upload mr-2"></i> Bulk Upload
                                </button>
                                <button id="addUserBtn" class="bg-gradient-to-r from-indigo-600 to-indigo-500 text-white px-4 py-2 rounded-lg text-sm hover:shadow-lg focus:outline-none font-medium transition transform hover:-translate-y-0.5">
                                    <i class="fas fa-plus mr-2"></i> Add User
                                </button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                                    <tr>
                                        <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Name</th>
                                        <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Email</th>
                                        <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">ID Number</th>
                                        <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Company</th>
                                        <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Role</th>
                                        <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="userTableBody">
                                    <tr>
                                        <td colspan="7" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No users to display. Click "Add User" to add new entries.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="px-6 py-4 border-t border-gray-100 flex items-center justify-between bg-gray-50">
                            <div class="text-sm text-gray-600">Showing <span class="font-semibold text-gray-900" id="usersShowingCount">0</span> to <span class="font-semibold text-gray-900" id="usersTotalCountDisplay">0</span> of <span class="font-semibold text-gray-900" id="usersTotalCount">0</span> results</div>
                            <div class="flex space-x-2">
                                <button class="px-3 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-100 transition" disabled>Previous</button>
                                <button class="px-3 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-100 transition" disabled>1</button>
                                <button class="px-3 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-100 transition" disabled>Next</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Programme Management Content (formerly part of Course Management) -->
                <div id="programme-managementContent" class="content-section">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent">Programme Management</h2>
                        <p class="text-gray-600 mt-2">Create, edit, and manage your learning programmes</p>
                    </div>
                    <!-- Create New Programme Section -->
                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <div class="flex items-center mb-6 pb-4 border-b border-gray-100">
                            <div class="p-3 rounded-lg bg-indigo-100 text-indigo-600 mr-3">
                                <i class="fas fa-plus-circle"></i>
                            </div>
                            <h3 class="text-lg font-bold text-gray-900">Create New Programme</h3>
                        </div>
                        <form id="createProgrammeForm">
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="programmeNameInput">Programme Name</label>
                                <input id="programmeNameInput" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition" placeholder="e.g., Software Development Bootcamp">
                            </div>
                            <div class="mb-4 text-center">
                                <label class="block text-gray-700 text-sm font-medium mb-2">Programme Picture (Optional)</label>
                                <img id="programmePicturePreview" class="inline-block h-32 w-32 rounded-lg mb-3 object-cover border-2 border-gray-200" src="https://placehold.co/128x128/ADD8E6/00008B?text=Programme+Image" alt="Programme Image">
                                <input type="file" id="programmePictureInput" accept="image/*" class="block w-full text-sm text-gray-500
                                    file:mr-4 file:py-2 file:px-4
                                    file:rounded-lg file:border-0
                                    file:text-sm file:font-semibold
                                    file:bg-blue-50 file:text-blue-700
                                    hover:file:bg-blue-100 transition"/>
                                <p class="text-xs text-gray-500 mt-1">PNG, JPG, up to 5MB</p>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2">Link Courses to Programme</label>
                                <div id="linkedCoursesSelection" class="border border-gray-300 rounded-lg p-3 max-h-40 overflow-y-auto bg-gray-50">
                                    <p id="noCoursesAvailableForProgramme" class="text-gray-500 text-sm text-center">No courses available. Create courses first.</p>
                                </div>
                            </div>

                            <div class="flex justify-end mt-6 space-x-3">
                                <button type="button" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 focus:outline-none font-medium transition" onclick="resetProgrammeForm()">
                                    Reset
                                </button>
                                <button type="submit" class="px-4 py-2 bg-gradient-to-r from-indigo-600 to-indigo-500 text-white rounded-lg hover:shadow-lg focus:outline-none font-medium transition transform hover:-translate-y-0.5">
                                    Create Programme
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Existing Programmes Table -->
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-6 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-white">
                            <h3 class="text-lg font-bold text-gray-900">Existing Programmes</h3>
                            <p class="text-sm text-gray-600 mt-1">View and manage all programmes</p>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
                                    <tr>
                                        <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Image</th>
                                        <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Programme Name</th>
                                        <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Linked Courses</th>
                                        <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Assigned Students</th>
                                        <th class="px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="existingProgrammesTableBody">
                                    <tr>
                                        <td colspan="5" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No programmes to display. Create a new programme above.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between">
                            <div class="text-sm text-gray-500">Showing <span class="font-medium" id="programmesShowingCount">0</span> to <span class="font-medium" id="programmesTotalCountDisplay">0</span> of <span class="font-medium" id="programmesTotalCount">0</span> results</div>
                            <div class="flex space-x-2">
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Previous</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>1</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Next</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- User Assignment to Programmes Content (New Section) -->
                <div id="user-programme-assignmentContent" class="content-section">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">Assign Students to Programmes</h2>
                        <p class="text-gray-600">Assign students to existing learning programmes.</p>
                    </div>

                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">Available Programmes for Assignment</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Programme Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Linked Courses</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Assigned Students</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="programmesForAssignmentTableBody">
                                    <tr>
                                        <td colspan="4" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No programmes available for assignment. Create programmes first.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between">
                            <div class="text-sm text-gray-500">Showing <span class="font-medium" id="assignProgrammesShowingCount">0</span> to <span class="font-medium" id="assignProgrammesTotalCountDisplay">0</span> of <span class="font-medium" id="assignProgrammesTotalCount">0</span> results</div>
                            <div class="flex space-x-2">
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Previous</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>1</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Next</button>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Course Content & Creation Content (for Admin Overview) -->
                <div id="course-contentContent" class="content-section">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Course Content Overview</h2>
                    <p class="text-gray-600 mb-6">View and manage all courses in the system.</p>

                    <!-- Course Search Bar -->
                    <div class="mb-6">
                        <input type="text" id="courseSearchInput" placeholder="Search courses by name, description, or creator..." class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>

                    <!-- Available Course Materials (All Existing Courses Table) -->
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">All Existing Courses (for Admin Review)</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Image</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Course Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Video</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Document</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Marks</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Creator</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="allExistingCoursesTableBody">
                                    <tr>
                                        <td colspan="8" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No courses to display. Create a new course in "My Courses".</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between">
                            <div class="text-sm text-gray-500">Showing <span class="font-medium" id="allCoursesShowingCount">0</span> to <span class="font-medium" id="allCoursesTotalCountDisplay">0</span> of <span class="font-medium" id="allCoursesTotalCount">0</span> results</div>
                            <div class="flex space-x-2">
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Previous</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>1</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Next</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports Content -->
                <div id="reportsContent" class="content-section">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">Reports</h2>
                        <p class="text-gray-600">Generate various reports on user and course data.</p>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Generate New Report</h3>
                        <form id="reportGenerationForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div class="col-span-1">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="reportStartDate">Start Date</label>
                                <input type="date" id="reportStartDate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div class="col-span-1">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="reportEndDate">End Date</label>
                                <input type="date" id="reportEndDate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div class="col-span-1">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="reportUserStatus">User Type / Status</label>
                                <select id="reportUserStatus" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="all">All Users</option>
                                    <option value="active">Active Users</option>
                                    <option value="deactivated">Inactive Users</option>
                                    <option value="student">Students Only</option>
                                    <option value="training_manager">Training Managers Only</option>
                                    <option value="administrator">Administrators Only</option>
                                </select>
                            </div>
                            <div class="col-span-1">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="reportCourseSelect">Select Course (Optional)</label>
                                <select id="reportCourseSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="all">All Courses</option>
                                    <!-- Courses will be dynamically loaded here -->
                                </select>
                            </div>
                            <div class="col-span-full flex justify-end mt-4">
                                <button type="submit" class="px-6 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition ease-in-out duration-150">
                                    Generate Report
                                </button>
                            </div>
                        </form>
                    </div>

                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">Report Results</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID Number</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Enrolled Courses</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Completed Courses</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hours Spent</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Start Date</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">End Date</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="reportResultsTableBody">
                                    <tr>
                                        <td colspan="9" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No report generated. Use the filters above and click "Generate Report".</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between">
                            <div class="text-sm text-gray-500">Showing <span class="font-medium" id="reportShowingCount">0</span> to <span class="font-medium" id="reportTotalCountDisplay">0</span> of <span class="font-medium" id="reportTotalCount">0</span> results</div>
                            <div class="flex space-x-2">
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Previous</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>1</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Next</button>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- System Settings Content -->
                <div id="system-settingsContent" class="content-section">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">System Settings</h2>
                    <p class="text-gray-600 mb-6">Configure general LMS settings.</p>
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">General Settings</h3>
                        </div>
                        <div class="p-6">
                            <form id="generalSettingsForm">
                                <div class="mb-4">
                                    <label class="block text-gray-700 text-sm font-medium mb-2" for="systemNameInput">System Name</label>
                                    <input type="text" id="systemNameInput" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="e.g., SKILLSCONNECT">
                                </div>
                                <div class="mb-4 text-center">
                                    <label class="block text-gray-700 text-sm font-medium mb-2">System Logo (Optional)</label>
                                    <img id="systemLogoPreview" class="inline-block h-24 w-24 rounded-full mb-3 object-cover border border-gray-300" src="https://placehold.co/96x96/ADD8E6/00008B?text=LMS" alt="System Logo">
                                    <input type="file" id="systemLogoInput" accept="image/*" class="block w-full text-sm text-gray-500
                                        file:mr-4 file:py-2 file:px-4
                                        file:rounded-md file:border-0
                                        file:text-sm file:font-semibold
                                        file:bg-blue-50 file:text-blue-700
                                        hover:file:bg-blue-100"/>
                                    <p class="text-xs text-gray-500 mt-1">PNG, JPG, up to 5MB</p>
                                </div>
                                <div class="mb-4">
                                    <label class="block text-gray-700 text-sm font-medium mb-2" for="defaultTimezoneSelect">Default Timezone</label>
                                    <select id="defaultTimezoneSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                        <option value="UTC-12">UTC-12:00 (Baker Island)</option>
                                        <option value="UTC-11">UTC-11:00 (Niue, Samoa)</option>
                                        <option value="UTC-10">UTC-10:00 (Hawaii)</option>
                                        <option value="UTC-9:30">UTC-09:30 (Marquesas Islands)</option>
                                        <option value="UTC-9">UTC-09:00 (Alaska)</option>
                                        <option value="UTC-8">UTC-08:00 (Pacific Time - US & Canada)</option>
                                        <option value="UTC-7">UTC-07:00 (Mountain Time - US & Canada)</option>
                                        <option value="UTC-6">UTC-06:00 (Central Time - US & Canada)</option>
                                        <option value="UTC-5">UTC-05:00 (Eastern Time - US & Canada)</option>
                                        <option value="UTC-4">UTC-04:00 (Atlantic Time - Canada)</option>
                                        <option value="UTC-3:30">UTC-03:30 (Newfoundland)</option>
                                        <option value="UTC-3">UTC-03:00 (Brasilia, Buenos Aires)</option>
                                        <option value="UTC-2">UTC-02:00 (Mid-Atlantic)</option>
                                        <option value="UTC-1">UTC-01:00 (Azores)</option>
                                        <option value="UTC">UTC (Coordinated Universal Time)</option>
                                        <option value="UTC+1">UTC+01:00 (Central European Time)</option>
                                        <option value="UTC+2" selected>UTC+02:00 (South African Standard Time)</option>
                                        <option value="UTC+3">UTC+03:00 (Moscow, Nairobi)</option>
                                        <option value="UTC+3:30">UTC+03:30 (Tehran)</option>
                                        <option value="UTC+4">UTC+04:00 (Dubai, Baku)</option>
                                        <option value="UTC+4:30">UTC+04:30 (Kabul)</option>
                                        <option value="UTC+5">UTC+05:00 (Islamabad, Tashkent)</option>
                                        <option value="UTC+5:30">UTC+05:30 (Mumbai, Kolkata)</option>
                                        <option value="UTC+5:45">UTC+05:45 (Kathmandu)</option>
                                        <option value="UTC+6">UTC+06:00 (Dhaka, Almaty)</option>
                                        <option value="UTC+6:30">UTC+06:30 (Yangon)</option>
                                        <option value="UTC+7">UTC+07:00 (Bangkok, Hanoi)</option>
                                        <option value="UTC+8">UTC+08:00 (Beijing, Perth)</option>
                                        <option value="UTC+8:45">UTC+08:45 (Eucla)</option>
                                        <option value="UTC+9">UTC+09:00 (Tokyo, Seoul)</option>
                                        <option value="UTC+9:30">UTC+09:30 (Adelaide, Darwin)</option>
                                        <option value="UTC+10">UTC+10:00 (Sydney, Melbourne)</option>
                                        <option value="UTC+10:30">UTC+10:30 (Lord Howe Island)</option>
                                        <option value="UTC+11">UTC+11:00 (Solomon Islands)</option>
                                        <option value="UTC+12">UTC+12:00 (Fiji, Auckland)</option>
                                        <option value="UTC+12:45">UTC+12:45 (Chatham Islands)</option>
                                        <option value="UTC+13">UTC+13:00 (Tonga)</option>
                                        <option value="UTC+14">UTC+14:00 (Kiribati)</option>
                                    </select>
                                </div>
                                <div class="mb-6">
                                    <label class="block text-gray-700 text-sm font-medium mb-2" for="systemLanguageSelect">System Language</label>
                                    <select id="systemLanguageSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                        <option value="en">English</option>
                                        <option value="es">Spanish</option>
                                        <option value="fr">French</option>
                                        <option value="de">German</option>
                                        <option value="zh">Chinese (Simplified)</option>
                                        <option value="af">Afrikaans</option>
                                    </select>
                                </div>
                                <div class="flex justify-end">
                                    <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition ease-in-out duration-150">
                                        Save Changes
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- My Courses Content (Training Manager) -->
                <div id="my-coursesContent" class="content-section">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">My Courses</h2>
                        <p class="text-gray-600">Create new courses and manage your assigned course materials.</p>
                    </div>

                    <!-- Create New Course Section -->
                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Create New Course</h3>
                        <form id="createCourseForm">
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="courseNameInput">Course Name</label>
                                <input id="courseNameInput" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="e.g., Advanced Algebra">
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="courseDescriptionInput">Course Description</label>
                                <textarea id="courseDescriptionInput" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="3" placeholder="Brief description of the course content."></textarea>
                            </div>
                            <div class="mb-4 text-center">
                                <label class="block text-gray-700 text-sm font-medium mb-2">Course Picture (Optional)</label>
                                <img id="coursePicturePreview" class="inline-block h-32 w-32 rounded-lg mb-3 object-cover border border-gray-300" src="https://placehold.co/128x128/E0E7FF/4F46E5?text=Course+Image" alt="Course Image">
                                <input type="file" id="coursePictureInput" accept="image/*" class="block w-full text-sm text-gray-500
                                    file:mr-4 file:py-2 file:px-4
                                    file:rounded-md file:border-0
                                    file:text-sm file:font-semibold
                                    file:bg-indigo-50 file:text-indigo-700
                                    hover:file:bg-indigo-100"/>
                                <p class="text-xs text-gray-500 mt-1">PNG, JPG, up to 5MB</p>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="courseVideoInput">Upload Course Video (Optional)</label>
                                <input type="file" id="courseVideoInput" accept="video/*" class="block w-full text-sm text-gray-500
                                    file:mr-4 file:py-2 file:px-4
                                    file:rounded-md file:border-0
                                    file:text-sm file:font-semibold
                                    file:bg-indigo-50 file:text-indigo-700
                                    hover:file:bg-indigo-100"/>
                                <p id="courseVideoFileName" class="text-xs text-gray-500 mt-1 hidden"></p>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="coursePdfInput">Upload Course Document (PDF, PPT, Optional)</label>
                                <input type="file" id="coursePdfInput" accept=".pdf,.ppt,.pptx" class="block w-full text-sm text-gray-500
                                    file:mr-4 file:py-2 file:px-4
                                    file:rounded-md file:border-0
                                    file:text-sm file:font-semibold
                                    file:bg-indigo-50 file:text-indigo-700
                                    hover:file:bg-indigo-100"/>
                                <p id="coursePdfFileName" class="text-xs text-gray-500 mt-1 hidden"></p>
                            </div>

                            <hr class="my-6 border-gray-200">

                            <h4 class="text-md font-semibold text-gray-800 mb-3">Add Questions to Course</h4>
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="questionTypeSelect">Question Type</label>
                                <select id="questionTypeSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="">Select a question type</option>
                                    <option value="multiple-choice">Multiple Choice</option>
                                    <option value="true-false">True/False</option>
                                    <option value="matching">Matching</option>
                                    <option value="long-answer">Long Answer</option>
                                </select>
                            </div>

                            <!-- Question Input Area (Dynamic) -->
                            <div id="questionInputArea" class="space-y-4 mb-4">
                                <!-- Content will be dynamically loaded here based on question type -->
                            </div>

                            <button type="button" id="addQuestionBtn" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-md text-sm hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 transition ease-in-out duration-150" disabled>
                                <i class="fas fa-plus mr-1"></i> Add Question
                            </button>

                            <div class="mt-6">
                                <h4 class="text-md font-semibold text-gray-800 mb-3">Questions for this Course:</h4>
                                <ul id="courseQuestionsList" class="border border-gray-200 rounded-md p-4 bg-gray-50 max-h-48 overflow-y-auto">
                                    <li class="text-gray-500 text-sm italic">No questions added yet.</li>
                                </ul>
                            </div>

                            <div class="flex justify-end mt-6 space-x-3">
                                <button type="button" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 transition ease-in-out duration-150" onclick="resetCourseForm()">
                                    Reset Form
                                </button>
                                <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition ease-in-out duration-150">
                                    Create Course
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Available Course Materials (Training Manager's Courses) -->
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">Your Created Courses</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Image</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Course Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Video</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Document</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Marks</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="trainingManagerCoursesTableBody">
                                    <tr>
                                        <td colspan="7" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No courses created by you. Create a new course above.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between">
                            <div class="text-sm text-gray-500">Showing <span class="font-medium" id="myCoursesShowingCount">0</span> to <span class="font-medium" id="myCoursesTotalCountDisplay">0</span> of <span class="font-medium" id="myCoursesTotalCount">0</span> results</div>
                            <div class="flex space-x-2">
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Previous</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>1</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Next</button>
                            </div>
                        </div>
                    </div>
                </div>
                
<!-- ================= STUDENT MY COURSES (UI IMPROVED) ================= -->
<div id="enrolled-coursesContent" class="content-section">

  <h2 class="text-2xl font-semibold text-gray-800 mb-6">My Courses</h2>

  <!-- Tabs -->
  <div class="flex space-x-2 mb-6 bg-gray-100 p-1 rounded-lg w-fit">
    <button id="tabInProgress"
      onclick="showStudentCourses('inprogress')"
      class="px-5 py-2 rounded-md text-sm font-medium bg-indigo-600 text-white transition">
      In Progress
    </button>

    <button id="tabCompleted"
      onclick="showStudentCourses('completed')"
      class="px-5 py-2 rounded-md text-sm font-medium text-gray-600 hover:text-gray-800 transition">
      Completed
    </button>
  </div>

  <!-- Courses Grid -->
  <div id="studentCoursesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
  </div>

</div>
<!-- =================================================================== -->

                
                <!-- Assignments Content -->
                <div id="assignmentsContent" class="content-section">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800" id="assignmentsPageTitle">Assignments</h2>
                        <p class="text-gray-600" id="assignmentsPageSubtitle">View and manage your assignments</p>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow overflow-hidden mb-6">
                        <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-800">Your Created Assignments</h3>
                            <button class="bg-indigo-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-indigo-700 focus:outline-none" id="createAssignmentBtn">
                                <i class="fas fa-plus mr-1"></i> Create Assignment
                            </button>
                        </div>
                        <!-- FIX: Table for TM assignments -->
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Title</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Assigned To</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Due Date</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Marks</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="tmAssignmentsTableBody">
                                    <tr><td colspan="6" class="p-6 text-gray-500 text-sm text-center">No assignments created yet.</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Grades Content (Training Manager) -->
                <div id="gradesContent" class="content-section">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800" id="gradesPageTitle">Gradebook</h2>
                        <p class="text-gray-600" id="gradesPageSubtitle">View and manage grades</p>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow overflow-hidden mb-6">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <div class="flex justify-between items-center">
                                <h3 class="text-lg font-semibold text-gray-800">Course Grades</h3>
                                <div class="flex space-x-2">
                                    <select class="mt-1 block pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                        <option>All Courses</option>
                                        <option>Mathematics 101</option>
                                        <option>Introduction to Biology</option>
                                        <option>History of Art</option>
                                    </select>
                                    <button class="bg-indigo-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-indigo-700 focus:outline-none">
                                        <i class="fas fa-download mr-1"></i> Export
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Student</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Assignment 1</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Assignment 2</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Midterm</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Final Exam</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Grade</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="trainingManagerGradesTableBody">
                                    <tr>
                                        <td colspan="8" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No grades to display.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between">
                            <div class="text-sm text-gray-500">Showing <span class="font-medium">0</span> to <span class="font-medium">0</span> of <span class="font-medium">0</span> students</div>
                            <div class="flex space-x-2">
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Previous</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>1</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>2</button>
                                <button class="px-3 py-1 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50" disabled>Next</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Student Assignments Content (Placeholder) -->
                <div id="student-assignmentsContent" class="content-section">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">My Assignments</h2>
                    <p class="text-gray-600 mb-6">View your assignments and submission status.</p>
                    <!-- FIX: Dynamic list for student assignments -->
                    <div id="studentAssignmentsList" class="space-y-4">
                        <div class="p-6 bg-white rounded-lg shadow text-gray-500 text-sm text-center">No assignments for you to display.</div>
                    </div>
                </div>

                <!-- My Grades Content (Student) -->
                <div id="my-gradesContent" class="content-section">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">My Grades</h2>
                        <p class="text-gray-600">View your grades for all courses</p>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow overflow-hidden mb-6">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">Course Grades</h3>
                        </div>
                        <div class="p-6">
                            <div class="mb-8">
                                <h4 class="text-lg font-medium text-gray-800 mb-4">Mathematics 101</h4>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Assignment</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Due Date</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Score</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Feedback</th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white divide-y divide-gray-200" id="studentGradesMath101">
                                            <tr>
                                                <td colspan="5" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No grades for this course yet.</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="mt-4 p-4 bg-gray-50 rounded-md">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <span class="text-sm font-medium text-gray-700">Current Grade:</span>
                                            <span class="ml-1 text-lg font-semibold text-gray-900">N/A</span>
                                        </div>
                                        <button class="bg-indigo-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-indigo-700 focus:outline-none">
                                            View Full Report
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-8">
                                <h4 class="text-lg font-medium text-gray-800 mb-4">Introduction to Biology</h4>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Assignment</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Due Date</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Score</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Feedback</th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white divide-y divide-gray-200" id="studentGradesBiology">
                                            <tr>
                                                <td colspan="5" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No grades for this course yet.</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="mt-4 p-4 bg-gray-50 rounded-md">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <span class="text-sm font-medium text-gray-700">Current Grade:</span>
                                            <span class="ml-1 text-lg font-semibold text-gray-900">N/A</span>
                                        </div>
                                        <button class="bg-indigo-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-indigo-700 focus:outline-none">
                                            View Full Report
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile Content (Placeholder) -->
                <div id="profileContent" class="content-section">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">User Profile</h2>
                    <p class="text-gray-600 mb-6">Manage your personal information.</p>
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">Personal Information</h3>
                        </div>
                        <div class="p-6">
                            <form id="profileSettingsForm">
                                <div class="mb-4 text-center">
                                    <label class="block text-gray-700 text-sm font-medium mb-2">Profile Picture</label>
                                    <img id="profilePicturePreview" class="inline-block h-24 w-24 rounded-full mb-3 object-cover border border-gray-300" src="https://placehold.co/96x96/ADD8E6/00008B?text=P" alt="Profile Picture">
                                    <input type="file" id="profilePictureInput" accept="image/*" class="block w-full text-sm text-gray-500
                                        file:mr-4 file:py-2 file:px-4
                                        file:rounded-md file:border-0
                                        file:text-sm file:font-semibold
                                        file:bg-blue-50 file:text-blue-700
                                        hover:file:bg-blue-100"/>
                                    <p class="text-xs text-gray-500 mt-1">PNG, JPG, up to 5MB</p>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="mb-4">
                                        <label class="block text-gray-700 text-sm font-medium mb-2" for="profileFullNameInput">Full Name</label>
                                        <input type="text" id="profileFullNameInput" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Your Full Name">
                                    </div>
                                    <div class="mb-4">
                                        <label class="block text-gray-700 text-sm font-medium mb-2" for="profileEmailInput">Email Address</label>
                                        <input type="email" id="profileEmailInput" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="your.email@example.com">
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="mb-4">
                                        <label class="block text-gray-700 text-sm font-medium mb-2" for="profileContactInput">Contact Number</label>
                                        <input type="text" id="profileContactInput" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="+27 12 345 6789">
                                    </div>
                                    <div class="mb-4">
                                        <label class="block text-gray-700 text-sm font-medium mb-2" for="profileAddressInput">Address</label>
                                        <input type="text" id="profileAddressInput" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="123 Main St, City, Country">
                                    </div>
                                </div>
                                <div class="mb-6">
                                    <label class="block text-gray-700 text-sm font-medium mb-2" for="profilePasswordInput">New Password (leave blank to keep current)</label>
                                    <input type="password" id="profilePasswordInput" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter new password">
                                                </div>
                                <div class="flex justify-end">
                                    <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition ease-in-out duration-150">
                                        Save Changes
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Messages Content (Placeholder) -->
                <div id="messagesContent" class="content-section">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Messages</h2>
                    <p class="text-gray-600 mb-6">Compose and view your messages.</p>
                    
                    <!-- Compose New Email Section -->
                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Compose New Email to Student</h3>
                        <form id="composeEmailForm">
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="emailRecipientSelect">To (Student)</label>
                                <select id="emailRecipientSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="">Select a student</option>
                                    <!-- Student options will be populated dynamically -->
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="emailSubjectInput">Subject</label>
                                <input type="text" id="emailSubjectInput" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter email subject">
                            </div>
                            <div class="mb-6">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="emailBodyTextarea">Message</label>
                                <textarea id="emailBodyTextarea" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="6" placeholder="Write your message here..."></textarea>
                            </div>
                            <div class="flex justify-end">
                                <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition ease-in-out duration-150">
                                    <i class="fas fa-paper-plane mr-2"></i> Send Email
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Existing Messages/Inbox (Placeholder) -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Your Inbox</h3>
                        <div class="divide-y divide-gray-200" id="inboxMessagesList">
                            <div class="p-4 hover:bg-gray-50 transition cursor-pointer border-l-4 border-indigo-600">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-semibold text-gray-800">Jane Manager</h4>
                                    <span class="text-xs text-gray-500">Jan 20, 2:30 PM</span>
                                </div>
                                <p class="text-sm font-medium text-gray-700 mb-1">Assignment Submission Guidelines</p>
                                <p class="text-sm text-gray-600">Please ensure all assignments are submitted before the deadline. Guidelines are available in the course materials section...</p>
                                <span class="inline-block mt-2 px-2 py-1 text-xs bg-indigo-100 text-indigo-700 rounded">Unread</span>
                            </div>
                            
                            <div class="p-4 hover:bg-gray-50 transition cursor-pointer">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-semibold text-gray-800">Admin User</h4>
                                    <span class="text-xs text-gray-500">Jan 18, 10:15 AM</span>
                                </div>
                                <p class="text-sm font-medium text-gray-700 mb-1">System Maintenance Notice</p>
                                <p class="text-sm text-gray-600">The system will undergo maintenance on Jan 25 from 11 PM to 1 AM. Please plan your activities accordingly...</p>
                                <span class="inline-block mt-2 px-2 py-1 text-xs bg-green-100 text-green-700 rounded">Read</span>
                            </div>
                            
                            <div class="p-4 hover:bg-gray-50 transition cursor-pointer border-l-4 border-indigo-600">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-semibold text-gray-800">Jane Manager</h4>
                                    <span class="text-xs text-gray-500">Jan 16, 3:45 PM</span>
                                </div>
                                <p class="text-sm font-medium text-gray-700 mb-1">Great Progress on Web Development Course!</p>
                                <p class="text-sm text-gray-600">You're doing excellent in the Web Development course. Keep up the momentum and don't hesitate to reach out if you need help...</p>
                                <span class="inline-block mt-2 px-2 py-1 text-xs bg-indigo-100 text-indigo-700 rounded">Unread</span>
                            </div>
                            
                            <div class="p-4 hover:bg-gray-50 transition cursor-pointer">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-semibold text-gray-800">Admin User</h4>
                                    <span class="text-xs text-gray-500">Jan 14, 9:00 AM</span>
                                </div>
                                <p class="text-sm font-medium text-gray-700 mb-1">Welcome to SkillsConnect LMS</p>
                                <p class="text-sm text-gray-600">Welcome aboard! We're excited to have you as part of our learning community. Start exploring courses and begin your learning journey...</p>
                                <span class="inline-block mt-2 px-2 py-1 text-xs bg-green-100 text-green-700 rounded">Read</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notifications Content (Placeholder) -->
                <div id="notificationsContent" class="content-section">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Notifications</h2>
                    <p class="text-gray-600 mb-6">View all your system notifications.</p>
                    
                    <div class="space-y-4">
                        <!-- Important Notification -->
                        <div class="bg-white rounded-lg shadow p-6 border-l-4 border-red-500 hover:shadow-lg transition">
                            <div class="flex justify-between items-start mb-3">
                                <div class="flex items-start gap-4">
                                    <div class="p-2 rounded-lg bg-red-100 text-red-600">
                                        <i class="fas fa-exclamation-circle text-xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-gray-800">Assignment Due Soon</h3>
                                        <p class="text-sm text-gray-600">React Project assignment is due in 3 days</p>
                                    </div>
                                </div>
                                <span class="text-xs text-gray-500">Jan 22, 2:15 PM</span>
                            </div>
                            <div class="ml-14">
                                <button class="text-sm text-indigo-600 hover:text-indigo-700 font-medium">View Assignment ‚Üí</button>
                            </div>
                        </div>

                        <!-- Success Notification -->
                        <div class="bg-white rounded-lg shadow p-6 border-l-4 border-green-500 hover:shadow-lg transition">
                            <div class="flex justify-between items-start mb-3">
                                <div class="flex items-start gap-4">
                                    <div class="p-2 rounded-lg bg-green-100 text-green-600">
                                        <i class="fas fa-check-circle text-xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-gray-800">Badge Earned!</h3>
                                        <p class="text-sm text-gray-600">You've earned the "Quick Learner" badge</p>
                                    </div>
                                </div>
                                <span class="text-xs text-gray-500">Jan 21, 5:30 PM</span>
                            </div>
                            <div class="ml-14">
                                <span class="inline-block mt-2 px-2 py-1 text-xs bg-green-100 text-green-700 rounded">Achievement</span>
                            </div>
                        </div>

                        <!-- Info Notification -->
                        <div class="bg-white rounded-lg shadow p-6 border-l-4 border-blue-500 hover:shadow-lg transition">
                            <div class="flex justify-between items-start mb-3">
                                <div class="flex items-start gap-4">
                                    <div class="p-2 rounded-lg bg-blue-100 text-blue-600">
                                        <i class="fas fa-info-circle text-xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-gray-800">New Course Available</h3>
                                        <p class="text-sm text-gray-600">Advanced Python Programming course is now available</p>
                                    </div>
                                </div>
                                <span class="text-xs text-gray-500">Jan 20, 10:00 AM</span>
                            </div>
                            <div class="ml-14">
                                <button class="text-sm text-indigo-600 hover:text-indigo-700 font-medium">Enroll Now ‚Üí</button>
                            </div>
                        </div>

                        <!-- Grade Notification -->
                        <div class="bg-white rounded-lg shadow p-6 border-l-4 border-yellow-500 hover:shadow-lg transition">
                            <div class="flex justify-between items-start mb-3">
                                <div class="flex items-start gap-4">
                                    <div class="p-2 rounded-lg bg-yellow-100 text-yellow-600">
                                        <i class="fas fa-star text-xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-gray-800">Grade Posted</h3>
                                        <p class="text-sm text-gray-600">Your grade for JavaScript Basics quiz has been posted (95%)</p>
                                    </div>
                                </div>
                                <span class="text-xs text-gray-500">Jan 19, 3:20 PM</span>
                            </div>
                            <div class="ml-14">
                                <button class="text-sm text-indigo-600 hover:text-indigo-700 font-medium">View Grade ‚Üí</button>
                            </div>
                        </div>

                        <!-- Reminder Notification -->
                        <div class="bg-white rounded-lg shadow p-6 border-l-4 border-purple-500 hover:shadow-lg transition">
                            <div class="flex justify-between items-start mb-3">
                                <div class="flex items-start gap-4">
                                    <div class="p-2 rounded-lg bg-purple-100 text-purple-600">
                                        <i class="fas fa-bell text-xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-gray-800">Course Enrollment Reminder</h3>
                                        <p class="text-sm text-gray-600">You haven't started the "Data Analytics Basics" course yet</p>
                                    </div>
                                </div>
                                <span class="text-xs text-gray-500">Jan 18, 1:45 PM</span>
                            </div>
                            <div class="ml-14">
                                <button class="text-sm text-indigo-600 hover:text-indigo-700 font-medium">Start Course ‚Üí</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Student: My Certificates Content -->
                <div id="my-certificatesContent" class="content-section">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">My Certificates</h2>
                        <p class="text-gray-600">View and download your earned certificates.</p>
                    </div>

                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">Your Certificates</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Certificate ID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Course Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Issue Date</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="studentCertificatesTableBody">
                                    <tr>
                                        <td colspan="5" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No certificates earned yet. Complete courses to earn certificates.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Training Manager: Certificate Templates Content -->
                <div id="certificate-templatesContent" class="content-section">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">Certificate Templates</h2>
                        <p class="text-gray-600">Create and manage certificate templates for your courses.</p>
                    </div>

                    <!-- Create Certificate Template -->
                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Create Certificate Template</h3>
                        <form id="createCertificateTemplateForm">
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="certTemplateName">Template Name</label>
                                <input id="certTemplateName" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="e.g., Standard Course Completion">
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="certTemplateDesc">Template Description</label>
                                <textarea id="certTemplateDesc" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="3" placeholder="Description of the certificate template..."></textarea>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="certTemplateColor">Certificate Color Scheme</label>
                                <select id="certTemplateColor" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="amber">Gold/Amber</option>
                                    <option value="blue">Blue</option>
                                    <option value="green">Green</option>
                                    <option value="purple">Purple</option>
                                </select>
                            </div>
                            <div class="mb-6">
                                <label class="block text-gray-700 text-sm font-medium mb-2">Linked Courses</label>
                                <div id="certTemplateCoursesSelection" class="border border-gray-300 rounded-md p-3 max-h-40 overflow-y-auto bg-gray-50">
                                    <p id="noCertCourses" class="text-gray-500 text-sm text-center">No courses available. Create courses first.</p>
                                </div>
                            </div>
                            <div class="flex justify-end space-x-3">
                                <button type="button" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none" onclick="resetCertTemplateForm()">
                                    Reset Form
                                </button>
                                <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none">
                                    Create Template
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Existing Certificate Templates -->
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">Existing Templates</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Template Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Color Scheme</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Linked Courses</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="certTemplatesTableBody">
                                    <tr>
                                        <td colspan="5" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No templates created yet. Create a new template above.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Admin: Certificates Management Content -->
                <div id="certificates-managementContent" class="content-section">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">Certificate Management</h2>
                        <p class="text-gray-600">Manage all certificates issued in the system.</p>
                    </div>

                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">All Issued Certificates</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Certificate ID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Student Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Course Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Issue Date</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Certificate Type</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="allCertificatesTableBody">
                                    <tr>
                                        <td colspan="7" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No certificates issued yet.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Student: My Badges Content -->
                <div id="my-badgesContent" class="content-section">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">My Badges</h2>
                        <p class="text-gray-600">Earn badges by reaching learning milestones. Each badge represents your learning progress.</p>
                    </div>

                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                        <h3 class="text-lg font-semibold text-blue-900 mb-2">Your Learning Progress</h3>
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-blue-700">Total Hours Spent</p>
                                <p class="text-3xl font-bold text-blue-900" id="studentTotalHours">0</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-blue-700">Badges Earned</p>
                                <p class="text-3xl font-bold text-blue-900" id="studentBadgesCount">0</p>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div id="studentBadgesContainer">
                            <div class="text-center py-12">
                                <p class="text-gray-500">Start learning to earn badges!</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Student: Calendar Content -->
                <div id="calendarContent" class="content-section">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">My Calendar</h2>
                        <p class="text-gray-600">View all your assignments, tests, and exams in one place</p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Calendar -->
                        <div class="lg:col-span-2 bg-white rounded-lg shadow p-6">
                            <div class="mb-4 flex items-center justify-between">
                                <h3 class="text-lg font-semibold text-gray-800" id="calendarMonthYear"></h3>
                                <div class="space-x-2">
                                    <button class="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded transition" onclick="previousMonth()">‚Üê Prev</button>
                                    <button class="px-3 py-1 bg-indigo-600 hover:bg-indigo-700 text-white rounded transition" onclick="goToToday()">Today</button>
                                    <button class="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded transition" onclick="nextMonth()">Next ‚Üí</button>
                                </div>
                            </div>
                            
                            <!-- Days of Week Header -->
                            <div class="grid grid-cols-7 gap-2 mb-4">
                                <div class="text-center font-semibold text-gray-600 text-sm">Sun</div>
                                <div class="text-center font-semibold text-gray-600 text-sm">Mon</div>
                                <div class="text-center font-semibold text-gray-600 text-sm">Tue</div>
                                <div class="text-center font-semibold text-gray-600 text-sm">Wed</div>
                                <div class="text-center font-semibold text-gray-600 text-sm">Thu</div>
                                <div class="text-center font-semibold text-gray-600 text-sm">Fri</div>
                                <div class="text-center font-semibold text-gray-600 text-sm">Sat</div>
                            </div>
                            
                            <!-- Calendar Days -->
                            <div class="grid grid-cols-7 gap-2" id="calendarDays"></div>
                        </div>

                        <!-- Upcoming Events Sidebar -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Upcoming Events</h3>
                            <div id="upcomingEventsList" class="space-y-4">
                                <!-- Events will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- All Events List -->
                    <div class="mt-8 bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                            <h3 class="text-lg font-semibold text-gray-800">All Events</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50 border-b border-gray-200">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Title</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="allEventsList" class="divide-y divide-gray-200">
                                    <!-- Events will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Training Manager: Manage Badges Content -->
                <div id="badges-createdContent" class="content-section">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">Manage Badges</h2>
                        <p class="text-gray-600">Create and manage badges for student achievement recognition.</p>
                    </div>

                    <!-- Create Badge -->
                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Create New Badge</h3>
                        <form id="createBadgeForm">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="mb-4">
                                    <label class="block text-gray-700 text-sm font-medium mb-2" for="badgeName">Badge Name</label>
                                    <input id="badgeName" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="e.g., Rising Star">
                                </div>
                                <div class="mb-4">
                                    <label class="block text-gray-700 text-sm font-medium mb-2" for="badgeHoursRequired">Hours Required</label>
                                    <input id="badgeHoursRequired" type="number" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="e.g., 5" min="1">
                                </div>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="badgeDescription">Description</label>
                                <textarea id="badgeDescription" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="3" placeholder="Describe what achievement this badge represents..."></textarea>
                            </div>
                            <div class="mb-4">
                                <label class="block text-gray-700 text-sm font-medium mb-2" for="badgeIcon">Badge Icon (Emoji)</label>
                                <input id="badgeIcon" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="e.g., ‚≠ê or üèÖ" maxlength="2">
                            </div>
                            <div class="flex justify-end space-x-3">
                                <button type="button" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 focus:outline-none" onclick="resetBadgeForm()">
                                    Reset Form
                                </button>
                                <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none">
                                    Create Badge
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Existing Badges -->
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">Available Badges</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Icon</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Badge Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hours Required</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Students Earned</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="createdBadgesTableBody">
                                    <tr>
                                        <td colspan="6" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No badges created yet. Create a new badge above.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Admin: Badges Management Content -->
                <div id="badges-managementContent" class="content-section">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">Badges Management</h2>
                        <p class="text-gray-600">Monitor all badges and student achievements across the system.</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-yellow-100 text-yellow-600 mr-4">
                                    <i class="fas fa-medal text-2xl"></i>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Total Badges Created</p>
                                    <h3 class="text-2xl font-semibold text-gray-800" id="totalBadgesCount">0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-blue-100 text-blue-600 mr-4">
                                    <i class="fas fa-award text-2xl"></i>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Total Earned</p>
                                    <h3 class="text-2xl font-semibold text-gray-800" id="totalEarnedCount">0</h3>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-green-100 text-green-600 mr-4">
                                    <i class="fas fa-users text-2xl"></i>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Students with Badges</p>
                                    <h3 class="text-2xl font-semibold text-gray-800" id="studentsWithBadgesCount">0</h3>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800">All Badges in System</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Icon</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Badge Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hours Required</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created By</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Times Earned</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200" id="allBadgesTableBody">
                                    <tr>
                                        <td colspan="6" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No badges in system yet.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <script>
        // Global variables for message modal
        const messageModal = document.getElementById('messageModal');
        const messageModalTitle = document.getElementById('messageModalTitle');
        const messageModalContent = document.getElementById('messageModalContent');

        function showMessageModal(title, content) {
            messageModalTitle.textContent = title;
            messageModalContent.textContent = content;
            messageModal.classList.remove('hidden');
            messageModal.classList.add('show');
        }

        function hideMessageModal() {
            messageModal.classList.remove('show');
            messageModal.classList.add('hidden');
        }

        // Global variables for Add User Modal
        const addUserModal = document.getElementById('addUserModal');
        const userPicturePreview = document.getElementById('userPicturePreview');
        const userPictureInput = document.getElementById('userPictureInput');

        userPictureInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    userPicturePreview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                userPicturePreview.src = "https://placehold.co/96x96/E0E7FF/4F46E5?text=UP"; // Reset to placeholder
            }
        });

        function showAddUserModal() {
            addUserModal.classList.remove('hidden');
            addUserModal.classList.add('show');
            userPicturePreview.src = "https://placehold.co/96x96/E0E7FF/4F46E5?text=UP"; // Reset preview on open
        }

        function hideAddUserModal() {
            addUserModal.classList.remove('show');
            addUserModal.classList.add('hidden');
            // Clear the form fields and reset image preview when closing
            document.getElementById('addUserForm').reset();
            userPicturePreview.src = "https://placehold.co/96x96/E0E7FF/4F46E5?text=UP";
        }

        // Bulk Upload Functions
        const bulkUploadModal = document.getElementById('bulkUploadModal');
        const bulkUploadForm = document.getElementById('bulkUploadForm');
        const bulkUploadFileInput = document.getElementById('bulkUploadFileInput');

        function showBulkUploadModal() {
            bulkUploadModal.classList.remove('hidden');
            bulkUploadModal.classList.add('show');
            bulkUploadForm.reset();
            document.getElementById('uploadProgress').classList.add('hidden');
            document.getElementById('uploadResults').classList.add('hidden');
        }

        function hideBulkUploadModal() {
            bulkUploadModal.classList.remove('show');
            bulkUploadModal.classList.add('hidden');
            bulkUploadForm.reset();
            document.getElementById('uploadProgress').classList.add('hidden');
            document.getElementById('uploadResults').classList.add('hidden');
        }

        // Parse CSV and bulk upload users
        bulkUploadForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const file = bulkUploadFileInput.files[0];
            if (!file) {
                showMessageModal('Error', 'Please select a CSV file.');
                return;
            }

            if (!file.name.endsWith('.csv')) {
                showMessageModal('Error', 'Please upload a CSV file only.');
                return;
            }

            if (file.size > 1024 * 1024) {
                showMessageModal('Error', 'File size must be less than 1MB.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const csv = e.target.result;
                processCSVUpload(csv);
            };
            reader.readAsText(file);
        });

        function processCSVUpload(csv) {
            const lines = csv.trim().split('\n');
            const progressDiv = document.getElementById('uploadProgress');
            const resultsDiv = document.getElementById('uploadResults');
            
            progressDiv.classList.remove('hidden');
            resultsDiv.classList.add('hidden');

            let successCount = 0;
            let errorCount = 0;
            let errors = [];

            lines.forEach((line, index) => {
                if (line.trim() === '') return; // Skip empty lines

                const parts = line.split(',').map(p => p.trim());
                
                // Validate CSV format
                if (parts.length < 6) {
                    errors.push(`Row ${index + 1}: Invalid format. Expected 6 fields.`);
                    errorCount++;
                    return;
                }

                const [name, email, idNumber, company, role, password] = parts;

                // Validate required fields
                if (!name || !email || !idNumber || !company || !role || !password) {
                    errors.push(`Row ${index + 1}: Missing required fields.`);
                    errorCount++;
                    return;
                }

                // Validate email format
                if (!email.includes('@')) {
                    errors.push(`Row ${index + 1}: Invalid email format.`);
                    errorCount++;
                    return;
                }

                // Validate role
                const validRoles = ['administrator', 'training_manager', 'student'];
                if (!validRoles.includes(role.toLowerCase())) {
                    errors.push(`Row ${index + 1}: Invalid role. Use administrator, training_manager, or student.`);
                    errorCount++;
                    return;
                }

                // Check if user already exists
                if (allUsersData.find(u => u.email === email)) {
                    errors.push(`Row ${index + 1}: User with email ${email} already exists.`);
                    errorCount++;
                    return;
                }

                // Create new user
                const newUser = {
                    id: Date.now() + Math.random(),
                    name: name.split(' ')[0] || name,
                    surname: name.split(' ')[1] || '',
                    email: email,
                    idNumber: idNumber,
                    company: company,
                    role: role.toLowerCase(),
                    password: password,
                    status: 'active',
                    coursesEnrolled: [],
                    totalHoursSpent: 0,
                    picture: 'https://placehold.co/40x40/FF5733/FFFFFF?text=U'
                };

                allUsersData.push(newUser);
                successCount++;

                // Update progress bar
                const total = lines.length - 1;
                const progress = Math.round(((index + 1) / total) * 100);
                document.getElementById('uploadProgressBar').style.width = progress + '%';
                document.getElementById('uploadProgressText').textContent = `${index + 1}/${total}`;
            });

            // Show results
            progressDiv.classList.add('hidden');
            resultsDiv.classList.remove('hidden');

            document.getElementById('successCount').textContent = successCount;
            document.getElementById('errorCount').textContent = errorCount;

            const errorResultsDiv = document.getElementById('errorResults');
            if (errorCount > 0) {
                errorResultsDiv.classList.remove('hidden');
                const errorList = document.getElementById('errorList');
                errorList.innerHTML = errors.map(err => `<li>${err}</li>`).join('');
            } else {
                errorResultsDiv.classList.add('hidden');
            }

            if (successCount > 0) {
                showMessageModal('Success', `${successCount} user(s) uploaded successfully!`);
                renderUserTable();
            }
        }

        // Dropdown toggle function
        function toggleDropdown(button) {
            const menu = button.nextElementSibling;
            if (menu && menu.classList.contains('dropdown-menu')) {
                menu.classList.toggle('hidden');
            }
        }
        
        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            const dropdowns = document.querySelectorAll('.dropdown-menu:not(.hidden)');
            dropdowns.forEach(dropdown => {
                const parentDropdown = dropdown.closest('.dropdown');
                if (parentDropdown && !parentDropdown.contains(e.target)) {
                    dropdown.classList.add('hidden');
                }
            });
        });

        // Function to show specific content section
        function showSection(sectionId) {
            // Hide all content sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            // Show the requested section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
                // Update page title
                const pageTitle = document.getElementById('pageTitle');
                if (pageTitle) {
                    // Extract title from section ID, e.g., "user-managementContent" -> "User Management"
                    let titleText = sectionId.replace('Content', '').replace(/-/g, ' ');
                    titleText = titleText.charAt(0).toUpperCase() + titleText.slice(1); // Capitalize first letter
                    // Special handling for the renamed sections
                    if (sectionId === 'course-contentContent') {
                        pageTitle.textContent = 'Course Content Overview';
                    } else if (sectionId === 'programme-managementContent') {
                        pageTitle.textContent = 'Programme Management';
                    } else if (sectionId === 'user-programme-assignmentContent') {
                        pageTitle.textContent = 'Assign Students to Programmes';
                    } else if (sectionId === 'profileContent') {
                        pageTitle.textContent = 'User Profile';
                    } else if (sectionId === 'reportsContent') {
                        pageTitle.textContent = 'Reports';
                    } else if (sectionId === 'my-coursesContent') { // New for Training Manager
                         pageTitle.textContent = 'My Courses';
                    }
                    else {
                         pageTitle.textContent = titleText;
                    }
                }
            }

            // Update active state in sidebar
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            const activeItem = document.querySelector(`.sidebar-item[data-section="${sectionId.replace('Content', '')}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }

            // Logic for populating sections when they are shown
            if (sectionId === 'course-contentContent') { // Admin's view of all courses
                renderAllExistingCoursesTable();
            }
            if (sectionId === 'programme-managementContent') {
                populateLinkedCoursesSelection();
                renderExistingProgramsTable();
            }
            if (sectionId === 'user-programme-assignmentContent') {
                renderProgrammesForAssignmentTable();
            }
            if (sectionId === 'system-settingsContent') {
                loadSystemSettings();
            }
            if (sectionId === 'profileContent') {
                loadProfileSettings();
            }
            if (sectionId === 'dashboardContent') {
                updateDashboardStats();
            }
            if (sectionId === 'reportsContent') {
                populateReportCourseSelect();
            }
            if (sectionId === 'my-coursesContent') { // Training Manager's "My Courses"
                renderTrainingManagerCoursesTable();
            }
            if (sectionId === 'assignmentsContent') {
                renderTMAssignmentsTable();
            }
            if (sectionId === 'student-assignmentsContent') {
                renderStudentAssignmentsList();
            }
            if (sectionId === 'messagesContent') { // New: Populate student dropdown for emails
                populateStudentEmailDropdown();
            }

            // Close mobile sidebar if open
            const sidebar = document.getElementById('sidebar');
            if (window.innerWidth <= 1023 && sidebar.classList.contains('active')) {
                sidebar.classList.remove('active');
            }
        }

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('loginUsernameInput').value;
            const password = document.getElementById('loginPasswordInput').value;
            const role = document.getElementById('userRoleSelect').value;
            
            // In a real app, you'd validate credentials against a backend
            // For this demo, we just find the user by name and role
            const userLoggedIn = allUsersData.find(u => u.name.toLowerCase() === username.toLowerCase() && u.role === role);

            if (!userLoggedIn) {
                showMessageModal('Login Error', 'Invalid username or role. Please try again.');
                return;
            }

            if (username && password) {
                const loginModalElement = document.getElementById('loginModal');
                if (loginModalElement) {
                    loginModalElement.classList.add('hidden');
                } else {
                    console.error("Error: loginModal element not found.");
                    showMessageModal('Critical Error', 'The login dialog could not be hidden. Please refresh the page.');
                    return;
                }
                
                // Set the logged-in user data from the dummy data
                loggedInUser.id = userLoggedIn.id;
                loggedInUser.name = userLoggedIn.name;
                loggedInUser.role = userLoggedIn.role;
                loggedInUser.fullName = `${userLoggedIn.name}${userLoggedIn.surname ? ' ' + userLoggedIn.surname : ''}`;
                loggedInUser.email = userLoggedIn.email;
                loggedInUser.picture = userLoggedIn.picture;

                // Update display usernames and role
                document.getElementById('sidebarUsername').textContent = loggedInUser.fullName;
                document.getElementById('sidebarUserrole').textContent = loggedInUser.role.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
                document.getElementById('topNavUsername').textContent = loggedInUser.fullName;
                document.getElementById('greetingName').textContent = loggedInUser.name; // Only first name for greeting
                document.querySelector('#sidebar .user-info img').src = loggedInUser.picture;
                document.querySelector('header .dropdown img').src = loggedInUser.picture;


                // Show/hide navigation sections based on role
                document.querySelectorAll('.nav-section').forEach(section => {
                    section.classList.add('hidden');
                });

                let navSectionToShowId;
                if (role === 'administrator') {
                    navSectionToShowId = 'adminNav';
                } else if (role === 'training_manager') {
                    navSectionToShowId = 'trainingManagerNav';
                }
                else { // student
                    navSectionToShowId = `studentNav`;
                }
                const navSectionElement = document.getElementById(navSectionToShowId);
                if (navSectionElement) {
                    navSectionElement.classList.remove('hidden');
                } else {
                    console.error(`Navigation section with ID '${navSectionToShowId}' not found.`);
                    showMessageModal('Configuration Error', 'Could not find the navigation section for your role. Please contact support.');
                }

                // Show appropriate default section based on role
                let defaultSectionId = 'dashboardContent';
                if (role === 'training_manager') {
                    defaultSectionId = 'dashboardContent';
                } else if (role === 'student') {
                    defaultSectionId = 'dashboardContent'; // Students also see dashboard
                }
                showSection(defaultSectionId);
                updateDashboardStats(); // Update dashboard stats after login

            } else {
                showMessageModal('Login Error', 'Please enter both username and password.');
            }
        });

        // Event listeners for sidebar navigation
        document.querySelectorAll('.sidebar-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault(); // Prevent default link behavior
                const sectionId = this.getAttribute('data-section') + 'Content';
                showSection(sectionId);
            });
        });

        // Logout functionality
        function handleLogout() {
            localStorage.removeItem('loggedInUser');
            showMessageModal('Logged Out', 'You have been successfully logged out.');
            document.getElementById('loginModal').classList.remove('hidden');
            
            // Reset UI
            document.getElementById('sidebarUsername').textContent = '';
            document.getElementById('sidebarUserrole').textContent = '';
            document.getElementById('topNavUsername').textContent = '';
            document.getElementById('greetingName').textContent = '';
            document.querySelector('#sidebar .user-info img').src = 'https://placehold.co/40x40/FF5733/FFFFFF?text=U';
            document.querySelector('header .dropdown img').src = 'https://placehold.co/32x32/FF5733/FFFFFF?text=U';
            document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
            document.querySelectorAll('.nav-section').forEach(section => section.classList.add('hidden'));
            document.getElementById('pageTitle').textContent = 'SKILLSCONNECT';
            
            // Reset loggedInUser state
            loggedInUser = {
                id: null,
                name: '',
                role: '',
                fullName: '',
                email: '',
                contact: '',
                address: '',
                picture: 'https://placehold.co/96x96/ADD8E6/00008B?text=P'
            };
            updateDashboardStats(); // Reset dashboard stats on logout
        }
        document.getElementById('logoutBtn').addEventListener('click', handleLogout);
        document.getElementById('topLogoutBtn').addEventListener('click', handleLogout);

        // Dummy logged in user data (will be populated on successful login)
        let loggedInUser = {
            id: null, // Will be set on login
            name: '',
            role: '',
            fullName: '',
            email: '',
            contact: '',
            address: '',
            picture: 'https://placehold.co/96x96/ADD8E6/00008B?text=P'
        };

        // Global array to store user data
        let allUsersData = [
            // Dummy Administrator
            {
                id: 1,
                name: 'Admin',
                surname: 'User',
                email: 'admin@skillsconnect.com',
                idNumber: 'ADM001',
                company: 'SkillsConnect',
                role: 'administrator',
                picture: 'https://placehold.co/40x40/FF5733/FFFFFF?text=AU',
                status: 'active',
                enrollmentDate: '2023-01-01',
                endDate: null,
                coursesEnrolled: [],
                totalHoursSpent: 0
            },
            // Dummy Training Manager (formerly Teacher)
            {
                id: 2,
                name: 'Jane',
                surname: 'Trainer',
                email: 'jane.trainer@skillsconnect.com',
                idNumber: 'TRM001',
                company: 'SkillsConnect',
                role: 'training_manager',
                picture: 'https://placehold.co/40x40/5DADE2/FFFFFF?text=JT',
                status: 'active',
                enrollmentDate: '2023-02-15',
                endDate: null,
                coursesEnrolled: [],
                totalHoursSpent: 0
            },
            // Dummy Students
            {
                id: 3,
                name: 'Alice',
                surname: '', // Changed to empty string
                email: 'alice@skillsconnect.com',
                idNumber: 'STD001',
                company: 'Global Corp',
                role: 'student',
                picture: 'https://placehold.co/40x40/F1C40F/FFFFFF?text=A',
                status: 'active',
                enrollmentDate: '2023-03-01',
                endDate: null,
                coursesEnrolled: [
                    { courseId: 101, enrollmentDate: '2023-03-01', completionDate: null, hoursSpent: 25 },
                    { courseId: 102, enrollmentDate: '2023-04-10', completionDate: '2023-06-20', hoursSpent: 40 }
                ],
                totalHoursSpent: 65
            },
            {
                id: 4,
                name: 'Bob',
                surname: '', // Changed to empty string
                email: 'bob@skillsconnect.com',
                idNumber: 'STD002',
                company: 'Local Business',
                role: 'student',
                picture: 'https://placehold.co/40x40/FF6347/FFFFFF?text=B',
                status: 'active',
                enrollmentDate: '2023-03-05',
                endDate: null,
                coursesEnrolled: [
                    { courseId: 101, enrollmentDate: '2023-03-05', completionDate: '2023-05-15', hoursSpent: 30 }
                ],
                totalHoursSpent: 30
            },
            {
                id: 5,
                name: 'Charlie',
                surname: '', // Changed to empty string
                email: 'charlie@skillsconnect.com',
                idNumber: 'STD003',
                company: 'Tech Solutions',
                role: 'student',
                picture: 'https://placehold.co/40x40/A9A9A9/FFFFFF?text=C',
                status: 'deactivated', // Inactive user
                enrollmentDate: '2023-01-10',
                endDate: '2023-02-01',
                coursesEnrolled: [
                    { courseId: 103, enrollmentDate: '2023-01-10', completionDate: null, hoursSpent: 5 }
                ],
                totalHoursSpent: 5
            }
        ];

        // Add User Button Listener
        document.getElementById('addUserBtn').addEventListener('click', showAddUserModal);

        // Bulk Upload Button Listener
        document.getElementById('bulkUploadBtn').addEventListener('click', showBulkUploadModal);

        // Add User Form Submission
        document.getElementById('addUserForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const name = document.getElementById('userNameInput').value.trim();
            const surname = document.getElementById('userSurnameInput').value.trim();
            const email = document.getElementById('userEmailInput').value.trim();
            const idNumber = document.getElementById('userIDNumberInput').value.trim();
            const companyName = document.getElementById('companyNameInput').value.trim();
            const password = document.getElementById('userPasswordInput').value.trim();
            const role = document.getElementById('newUserRoleSelect').value;
            const userPictureFile = userPictureInput.files[0];
            let userPictureSrc = '';

            if (!name || !surname || !email || !idNumber || !password || !companyName) {
                showMessageModal('Input Error', 'Please fill in all fields.');
                return;
            }

            // Basic email validation
            if (!email.includes('@') || !email.includes('.')) {
                showMessageModal('Input Error', 'Please enter a valid email address.');
                return;
            }

            // Generate a simple unique ID for the user
            const userId = Date.now();

            // Handle user picture
            if (userPictureFile) {
                userPictureSrc = URL.createObjectURL(userPictureFile);
            } else {
                // Generate initials for placeholder if no image is uploaded
                const initials = `${name.charAt(0)}${surname.charAt(0)}`.toUpperCase();
                const randomColor = Math.floor(Math.random()*16777215).toString(16).padStart(6, '0');
                userPictureSrc = `https://placehold.co/40x40/${randomColor}/FFFFFF?text=${initials}`;
            }

            const newUser = {
                id: userId,
                name: name,
                surname: surname,
                email: email,
                idNumber: idNumber,
                company: companyName,
                role: role,
                picture: userPictureSrc,
                status: 'active', // Default status
                enrollmentDate: new Date().toISOString().slice(0, 10), // Current date as start date
                endDate: null, // No end date initially
                coursesEnrolled: [],
                totalHoursSpent: 0
            };
            allUsersData.push(newUser); // Add new user to the global array

            renderUserTable(); // Re-render the user table to include the new user
            updateDashboardStats(); // Update dashboard stats after adding user

            showMessageModal('Success', `${name} ${surname} has been added as a ${role.replace('_', ' ')}.`);
            hideAddUserModal();
        });

        function renderUserTable() {
            const userTableBody = document.getElementById('userTableBody');
            userTableBody.innerHTML = ''; // Clear existing rows

            if (allUsersData.length === 0) {
                userTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No users to display. Click "Add User" to add new entries.</td>
                    </tr>
                `;
                document.getElementById('usersTotalCount').textContent = 0;
                document.getElementById('usersShowingCount').textContent = 0;
                document.getElementById('usersTotalCountDisplay').textContent = 0;
                return;
            }

            allUsersData.forEach(user => {
                const newRow = userTableBody.insertRow();
                newRow.classList.add('cursor-pointer', 'hover:bg-gray-50');
                newRow.dataset.userId = user.id;

                const fullName = `${user.name}${user.surname ? ' ' + user.surname : ''}`;

                const nameCell = newRow.insertCell();
                nameCell.classList.add('px-6', 'py-4', 'whitespace-nowrap');
                nameCell.innerHTML = `
                    <div class="flex items-center">
                        <div class="flex-shrink-0 h-10 w-10">
                            <img class="h-10 w-10 rounded-full object-cover" src="${user.picture}" alt="${fullName}">
                        </div>
                        <div class="ml-4">
                            <div class="text-sm font-medium text-gray-900">${fullName}</div>
                            <div class="text-sm text-gray-500">${user.role.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}</div>
                        </div>
                    </div>
                `;

                newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.email}</td>`;
                newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.idNumber}</td>`;
                newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.company}</td>`;
                
                const roleCell = newRow.insertCell();
                roleCell.classList.add('px-6', 'py-4', 'whitespace-nowrap');
                let roleColorClass;
                switch (user.role) {
                    case 'administrator':
                        roleColorClass = 'bg-indigo-100 text-indigo-800';
                        break;
                    case 'training_manager':
                        roleColorClass = 'bg-yellow-100 text-yellow-800';
                        break;
                    case 'student':
                        roleColorClass = 'bg-blue-100 text-blue-800';
                        break;
                    default:
                        roleColorClass = 'bg-gray-100 text-gray-800';
                }
                roleCell.innerHTML = `<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${roleColorClass}">${user.role.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}</span>`;

                const statusCell = newRow.insertCell();
                statusCell.classList.add('px-6', 'py-4', 'whitespace-nowrap');
                let statusClass = user.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                statusCell.innerHTML = `
                    <button class="status-toggle-btn px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}" data-status="${user.status}">
                        ${user.status.charAt(0).toUpperCase() + user.status.slice(1)}
                    </button>
                `;
                statusCell.querySelector('.status-toggle-btn').addEventListener('click', function() {
                    const button = this;
                    const rowUserId = parseInt(button.closest('tr').dataset.userId);
                    let userToUpdate = allUsersData.find(u => u.id === rowUserId);

                    if (userToUpdate) {
                        if (userToUpdate.status === 'active') {
                            userToUpdate.status = 'deactivated';
                            userToUpdate.endDate = new Date().toISOString().slice(0, 10); // Set end date on deactivation
                            button.textContent = 'Deactivated';
                            button.classList.remove('bg-green-100', 'text-green-800');
                            button.classList.add('bg-red-100', 'text-red-800');
                            showMessageModal('User Status', `User ${userToUpdate.name} status changed to Deactivated.`);
                        } else {
                            userToUpdate.status = 'active';
                            userToUpdate.endDate = null; // Clear end date on reactivation
                            button.textContent = 'Active';
                            button.classList.remove('bg-red-100', 'text-red-800');
                            button.classList.add('bg-green-100', 'text-green-800');
                            showMessageModal('User Status', `User ${userToUpdate.name} status changed to Active.`);
                        }
                        updateDashboardStats(); // Update dashboard stats after status change
                    }
                });

                newRow.insertCell().outerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <a href="#" class="text-indigo-600 hover:text-indigo-900 mr-3">Edit</a>
                        <a href="#" class="text-red-600 hover:text-red-900">Delete</a>
                    </td>
                `;
            });

            document.getElementById('usersTotalCount').textContent = allUsersData.length;
            document.getElementById('usersShowingCount').textContent = allUsersData.length > 0 ? 1 : 0;
            document.getElementById('usersTotalCountDisplay').textContent = allUsersData.length;
        }


        // Sidebar toggle logic
        const sidebar = document.getElementById('sidebar');
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileCloseSidebarBtn = document.getElementById('mobileCloseSidebarBtn');
        const contentArea = document.getElementById('contentArea');

        // Mobile sidebar toggle (drawer functionality)
        mobileMenuBtn.addEventListener('click', () => {
            sidebar.classList.add('active');
        });
        mobileCloseSidebarBtn.addEventListener('click', () => {
            sidebar.classList.remove('active');
        });

        // Sidebar stays expanded at all times - no collapse functionality

        // Make entire table rows clickable (if they have data-link attribute) - Adjusted to avoid status button
        document.addEventListener('click', function(e) {
            // Ensure the clicked element or its parent is not an action button or the status toggle button
            if (e.target.closest('a') || e.target.closest('button') || e.target.classList.contains('status-toggle-btn')) {
                return;
            }

            let targetRow = e.target.closest('tr[data-link]');
            if (targetRow) {
                const link = targetRow.getAttribute('data-link');
                const sectionMatch = link.match(/^([a-zA-Z-]+)\.html/);
                if (sectionMatch) {
                    const sectionId = sectionMatch[1] + 'Content';
                    showMessageModal('Row Clicked', `You clicked on a row linked to: ${link}. In a real application, this would show user details or navigate to a specific page.`);
                } else {
                    showMessageModal('Row Clicked', `You clicked on a row linked to: ${link}. This action is currently simulated.`);
                }
            }
        });


        // Show login modal on page load
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('loginModal').classList.remove('hidden');
            renderUserTable(); // Initial render of the user table with dummy data
            renderAllExistingCoursesTable(); // Initial render of the admin courses table
        });


        // Course Management Specific Logic
        let allCoursesData = [
            {
                id: 101,
                name: 'Introduction to Web Development',
                description: 'Learn the basics of HTML, CSS, and JavaScript.',
                videoFileName: 'intro_web_dev.mp4',
                pdfFileName: 'web_dev_notes.pdf',
                picture: 'https://placehold.co/128x128/E0E7FF/4F46E5?text=Web+Dev',
                questions: [
                    { type: 'multiple-choice', text: 'What does HTML stand for?', options: ['Hyper Text Markup Language', 'Hyperlink and Text Markup Language', 'High Tech Modern Language'], correctAnswer: 0, marks: 10 },
                    { type: 'true-false', text: 'CSS is used for styling web pages.', correctAnswer: true, marks: 5 }
                ],
                readStatus: false,
                creatorId: 2 // Created by Training Manager (Jane Trainer)
            },
            {
                id: 102,
                name: 'Data Science Fundamentals',
                description: 'Explore data analysis, machine learning, and statistical modeling.',
                videoFileName: 'data_science_intro.mp4',
                pdfFileName: 'data_science_guide.pdf',
                picture: 'https://placehold.co/128x128/D1FAE5/065F46?text=Data+Science',
                questions: [
                    { type: 'multiple-choice', text: 'Which language is commonly used in data science?', options: ['Java', 'Python', 'C++'], correctAnswer: 1, marks: 10 },
                    { type: 'matching', pairs: [{term: 'Regression', definition: 'Predicting continuous values'}, {term: 'Classification', definition: 'Categorizing data'}], marks: 20 }
                ],
                readStatus: false,
                creatorId: 2 // Created by Training Manager (Jane Trainer)
            },
            {
                id: 103,
                name: 'Advanced Algorithms',
                description: 'Deep dive into complex algorithms and data structures.',
                videoFileName: 'advanced_algo.mp4',
                pdfFileName: 'algo_handbook.pdf',
                picture: 'https://placehold.co/128x128/FFE4E6/E04C6C?text=Algorithms',
                questions: [
                    { type: 'true-false', text: 'Big O notation describes the efficiency of an algorithm.', correctAnswer: true, marks: 15 }
                ],
                readStatus: false,
                creatorId: 2 // Created by Training Manager (Jane Trainer)
            }
        ];
        let currentCourseQuestions = [];
        let currentVideoFileName = '';
        let currentCoursePdfFileName = '';
        const coursePicturePreview = document.getElementById('coursePicturePreview');
        const coursePictureInput = document.getElementById('coursePictureInput');
        const coursePdfInput = document.getElementById('coursePdfInput');
        const coursePdfFileNameDisplay = document.getElementById('coursePdfFileName');

        // Function to render question input fields based on type
        function renderQuestionInputArea(type) {
            const questionInputArea = document.getElementById('questionInputArea');
            questionInputArea.innerHTML = ''; // Clear previous inputs
            document.getElementById('addQuestionBtn').disabled = true; // Disable until valid input

            if (!type) return; // Exit if no type is selected

            const marksInputHTML = `
                <div class="mt-2">
                    <label class="block text-gray-700 text-sm font-medium mb-2" for="questionMarks">Marks</label>
                    <input type="number" id="questionMarks" class="w-24 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" min="1" value="1">
                </div>
            `;

            if (type === 'multiple-choice') {
                questionInputArea.innerHTML = `
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2" for="mcQuestionText">Question Text</label>
                        <textarea id="mcQuestionText" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="2" placeholder="Enter multiple-choice question"></textarea>
                    </div>
                    <div id="mcOptionsContainer" class="space-y-2 mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Options (Check correct answer)</label>
                        <div class="flex items-center">
                            <input type="radio" name="mcAnswer" value="0" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                            <input type="text" class="mc-option ml-2 px-3 py-2 border border-gray-300 rounded-md w-full" placeholder="Option A">
                            <button type="button" class="remove-option-btn ml-2 text-red-600 hover:text-red-900"><i class="fas fa-times"></i></button>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" name="mcAnswer" value="1" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                            <input type="text" class="mc-option ml-2 px-3 py-2 border border-gray-300 rounded-md w-full" placeholder="Option B">
                            <button type="button" class="remove-option-btn ml-2 text-red-600 hover:text-red-900"><i class="fas fa-times"></i></button>
                        </div>
                    </div>
                    <button type="button" id="addMcOptionBtn" class="text-indigo-600 text-sm hover:text-indigo-800 focus:outline-none">
                        <i class="fas fa-plus mr-1"></i> Add Option
                    </button>
                    ${marksInputHTML}
                `;
                document.getElementById('addMcOptionBtn').addEventListener('click', addMultipleChoiceOption);
                document.querySelectorAll('.remove-option-btn').forEach(button => {
                    button.addEventListener('click', removeMultipleChoiceOption);
                });
                document.getElementById('mcQuestionText').addEventListener('input', checkQuestionReadiness);
                document.querySelectorAll('.mc-option').forEach(input => {
                    input.addEventListener('input', checkQuestionReadiness);
                });
                document.querySelectorAll('input[name="mcAnswer"]').forEach(radio => {
                    radio.addEventListener('change', checkQuestionReadiness);
                });

            } else if (type === 'true-false') {
                questionInputArea.innerHTML = `
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2" for="tfQuestionText">Question Text</label>
                        <textarea id="tfQuestionText" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="2" placeholder="Enter true/false statement"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Correct Answer</label>
                        <div class="flex items-center space-x-4">
                            <label class="inline-flex items-center">
                                <input type="radio" name="tfAnswer" value="true" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                                <span class="ml-2 text-gray-700">True</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="tfAnswer" value="false" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                                <span class="ml-2 text-gray-700">False</span>
                            </label>
                        </div>
                    </div>
                    ${marksInputHTML}
                `;
                document.getElementById('tfQuestionText').addEventListener('input', checkQuestionReadiness);
                document.querySelectorAll('input[name="tfAnswer"]').forEach(radio => {
                    radio.addEventListener('change', checkQuestionReadiness);
                });
            } else if (type === 'matching') {
                questionInputArea.innerHTML = `
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Matching Pairs (Term : Definition)</label>
                        <div id="matchingPairsContainer" class="space-y-2 mb-4">
                            <div class="flex items-center space-x-2">
                                <input type="text" class="matching-term px-3 py-2 border border-gray-300 rounded-md w-1/2" placeholder="Term">
                                <span class="text-gray-500">:</span>
                                <input type="text" class="matching-definition px-3 py-2 border border-gray-300 rounded-md w-1/2" placeholder="Definition">
                                <button type="button" class="remove-pair-btn text-red-600 hover:text-red-900"><i class="fas fa-times"></i></button>
                            </div>
                            <div class="flex items-center space-x-2">
                                <input type="text" class="matching-term px-3 py-2 border border-gray-300 rounded-md w-1/2" placeholder="Term">
                                <span class="text-gray-500">:</span>
                                <input type="text" class="matching-definition px-3 py-2 border border-gray-300 rounded-md w-1/2" placeholder="Definition">
                                <button type="button" class="remove-pair-btn ml-2 text-red-600 hover:text-red-900"><i class="fas fa-times"></i></button>
                            </div>
                        </div>
                        <button type="button" id="addMatchingPairBtn" class="text-indigo-600 text-sm hover:text-indigo-800 focus:outline-none">
                            <i class="fas fa-plus mr-1"></i> Add Pair
                        </button>
                    </div>
                    ${marksInputHTML}
                `;
                document.getElementById('addMatchingPairBtn').addEventListener('click', addMatchingPair);
                document.querySelectorAll('.remove-pair-btn').forEach(button => {
                    button.addEventListener('click', removeMatchingPair);
                });
                document.querySelectorAll('.matching-term, .matching-definition').forEach(input => {
                    input.addEventListener('input', checkQuestionReadiness);
                });
            } else if (type === 'long-answer') {
                questionInputArea.innerHTML = `
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2" for="longAnswerQuestionText">Question Text</label>
                        <textarea id="longAnswerQuestionText" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="3" placeholder="Enter long answer question"></textarea>
                    </div>
                    ${marksInputHTML}
                `;
                document.getElementById('longAnswerQuestionText').addEventListener('input', checkQuestionReadiness);
            }
            checkQuestionReadiness();
        }

        // Validate if question input fields are filled to enable "Add Question" button
        function checkQuestionReadiness() {
            const type = document.getElementById('questionTypeSelect').value;
            const addQuestionBtn = document.getElementById('addQuestionBtn');
            let isValid = false;

            if (type === 'multiple-choice') {
                const questionText = document.getElementById('mcQuestionText').value.trim();
                const options = Array.from(document.querySelectorAll('.mc-option')).map(input => input.value.trim());
                const anyOptionFilled = options.some(option => option !== '');
                const anyRadioSelected = Array.from(document.querySelectorAll('input[name="mcAnswer"]')).some(radio => radio.checked);
                isValid = questionText !== '' && options.length >= 2 && anyOptionFilled && anyRadioSelected;
            } else if (type === 'true-false') {
                const questionText = document.getElementById('tfQuestionText').value.trim();
                const anyRadioSelected = Array.from(document.querySelectorAll('input[name="tfAnswer"]')).some(radio => radio.checked);
                isValid = questionText !== '' && anyRadioSelected;
            } else if (type === 'matching') {
                const pairs = [];
                document.querySelectorAll('#matchingPairsContainer > div').forEach(pairDiv => {
                    const term = pairDiv.querySelector('.matching-term').value.trim();
                    const definition = pairDiv.querySelector('.matching-definition').value.trim();
                    if (term && definition) {
                        pairs.push({ term, definition });
                    }
                });
                const allPairsValid = pairs.every(pair => pair.term !== '' && pair.definition !== '');
                isValid = pairs.length >= 2 && allPairsValid;
            } else if (type === 'long-answer') {
                const questionText = document.getElementById('longAnswerQuestionText').value.trim();
                isValid = questionText !== '';
            }
            addQuestionBtn.disabled = !isValid;
        }

        // Multiple Choice: Add new option field
        function addMultipleChoiceOption() {
            const container = document.getElementById('mcOptionsContainer');
            const optionCount = container.children.length;
            const newOptionDiv = document.createElement('div');
            newOptionDiv.classList.add('flex', 'items-center');
            newOptionDiv.innerHTML = `
                <input type="radio" name="mcAnswer" value="${optionCount}" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                <input type="text" class="mc-option ml-2 px-3 py-2 border border-gray-300 rounded-md w-full" placeholder="Option ${String.fromCharCode(65 + optionCount)}">
                <button type="button" class="remove-option-btn ml-2 text-red-600 hover:text-red-900"><i class="fas fa-times"></i></button>
            `;
            container.appendChild(newOptionDiv);
            newOptionDiv.querySelector('.remove-option-btn').addEventListener('click', removeMultipleChoiceOption);
            newOptionDiv.querySelector('.mc-option').addEventListener('input', checkQuestionReadiness);
            newOptionDiv.querySelector('input[name="mcAnswer"]').addEventListener('change', checkQuestionReadiness);
            checkQuestionReadiness();
        }

        // Multiple Choice: Remove option field
        function removeMultipleChoiceOption(event) {
            const optionDiv = event.target.closest('.flex.items-center');
            if (optionDiv) {
                optionDiv.remove();
                // Re-index radio button values
                document.querySelectorAll('#mcOptionsContainer .flex.items-center').forEach((div, index) => {
                    div.querySelector('input[type="radio"]').value = index;
                });
            }
            checkQuestionReadiness();
        }

        // Matching: Add new pair field
        function addMatchingPair() {
            const container = document.getElementById('matchingPairsContainer');
            const newPairDiv = document.createElement('div');
            newPairDiv.classList.add('flex', 'items-center', 'space-x-2');
            newPairDiv.innerHTML = `
                <input type="text" class="matching-term px-3 py-2 border border-gray-300 rounded-md w-1/2" placeholder="Term">
                <span class="text-gray-500">:</span>
                <input type="text" class="matching-definition px-3 py-2 border border-gray-300 rounded-md w-1/2" placeholder="Definition">
                <button type="button" class="remove-pair-btn text-red-600 hover:text-red-900"><i class="fas fa-times"></i></button>
            `;
            container.appendChild(newPairDiv);
            newPairDiv.querySelector('.remove-pair-btn').addEventListener('click', removeMatchingPair);
            newPairDiv.querySelectorAll('.matching-term, .matching-definition').forEach(input => {
                input.addEventListener('input', checkQuestionReadiness);
            });
            checkQuestionReadiness();
        }

        // Matching: Remove pair field
        function removeMatchingPair(event) {
            const pairDiv = event.target.closest('.flex.items-center');
            if (pairDiv) {
                pairDiv.remove();
            }
            checkQuestionReadiness();
        }

        // Event listener for question type selection dropdown
        document.getElementById('questionTypeSelect').addEventListener('change', function() {
            renderQuestionInputArea(this.value);
        });

        // Event listener for adding a question to the current course's temporary list
        document.getElementById('addQuestionBtn').addEventListener('click', function() {
            const type = document.getElementById('questionTypeSelect').value;
            let question = { type: type };

            const marksInput = document.getElementById('questionMarks');
            const marks = marksInput ? parseInt(marksInput.value, 10) : 0;
            if (!marks || marks <= 0) {
                showMessageModal('Input Error', 'Please enter a valid number of marks (greater than 0).');
                return;
            }
            question.marks = marks;


            if (type === 'multiple-choice') {
                const questionText = document.getElementById('mcQuestionText').value.trim();
                const options = Array.from(document.querySelectorAll('.mc-option')).map(input => input.value.trim());
                const correctAnswerIndex = document.querySelector('input[name="mcAnswer"]:checked')?.value;

                if (!questionText || options.some(o => !o) || correctAnswerIndex === undefined) {
                    showMessageModal('Input Error', 'Please fill in all multiple-choice fields and select a correct answer.');
                    return;
                }

                question.text = questionText;
                question.options = options;
                question.correctAnswer = parseInt(correctAnswerIndex);

            } else if (type === 'true-false') {
                const questionText = document.getElementById('tfQuestionText').value.trim();
                const correctAnswer = document.querySelector('input[name="tfAnswer"]:checked')?.value;

                if (!questionText || !correctAnswer) {
                    showMessageModal('Input Error', 'Please fill in the true/false question and select a correct answer.');
                    return;
                }

                question.text = questionText;
                question.correctAnswer = correctAnswer === 'true';

            } else if (type === 'matching') {
                const pairs = [];
                document.querySelectorAll('#matchingPairsContainer > div').forEach(pairDiv => {
                    const term = pairDiv.querySelector('.matching-term').value.trim();
                    const definition = pairDiv.querySelector('.matching-definition').value.trim();
                    if (term && definition) {
                        pairs.push({ term, definition });
                    }
                });

                if (pairs.length < 2 || pairs.some(pair => !pair.term || !pair.definition)) { // Require at least 2 complete pairs
                    showMessageModal('Input Error', 'Please add at least two complete matching pairs (Term and Definition).');
                    return;
                }
                question.pairs = pairs;
            } else if (type === 'long-answer') {
                const questionText = document.getElementById('longAnswerQuestionText').value.trim();
                if (!questionText) {
                    showMessageModal('Input Error', 'Please enter the long answer question text.');
                    return;
                }
                question.text = questionText;
            }
            else {
                showMessageModal('Error', 'Please select a question type.');
                return;
            }

            currentCourseQuestions.push(question);
            updateCourseQuestionsList();
            showMessageModal('Question Added', `A ${type.replace('-', ' ')} question has been added for ${marks} marks.`);
            // Clear question form after adding
            document.getElementById('questionTypeSelect').value = '';
            renderQuestionInputArea(''); // Clear inputs
            document.getElementById('addQuestionBtn').disabled = true;
        });

        // Update the displayed list of questions for the current course
        function updateCourseQuestionsList() {
            const list = document.getElementById('courseQuestionsList');
            list.innerHTML = ''; // Clear existing list

            if (currentCourseQuestions.length === 0) {
                list.innerHTML = '<li class="text-gray-500 text-sm italic">No questions added yet.</li>';
                return;
            }

            currentCourseQuestions.forEach((q, index) => {
                const listItem = document.createElement('li');
                listItem.classList.add('flex', 'justify-between', 'items-center', 'py-2', 'px-3', 'border-b', 'border-gray-100');
                if (index === currentCourseQuestions.length - 1) {
                    listItem.classList.remove('border-b'); // Remove border for last item
                }
                let questionSummary = '';
                const marksText = `(${q.marks} ${q.marks === 1 ? 'mark' : 'marks'})`;
                if (q.type === 'multiple-choice') {
                    questionSummary = `MC: ${q.text.substring(0, 40)}${q.text.length > 40 ? '...' : ''} ${marksText}`;
                } else if (q.type === 'true-false') {
                    questionSummary = `T/F: ${q.text.substring(0, 40)}${q.text.length > 40 ? '...' : ''} ${marksText}`;
                } else if (q.type === 'matching') {
                    questionSummary = `Matching: ${q.pairs.length} pairs ${marksText}`;
                } else if (q.type === 'long-answer') {
                    questionSummary = `Long Answer: ${q.text.substring(0, 40)}${q.text.length > 40 ? '...' : ''} ${marksText}`;
                }

                listItem.innerHTML = `
                    <span class="text-sm text-gray-700">${index + 1}. ${questionSummary}</span>
                    <button type="button" class="text-red-600 hover:text-red-900 text-sm delete-question-btn" data-index="${index}">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                list.appendChild(listItem);
            });

            document.querySelectorAll('.delete-question-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const indexToDelete = parseInt(this.dataset.index);
                    currentCourseQuestions.splice(indexToDelete, 1);
                    updateCourseQuestionsList();
                    showMessageModal('Question Removed', 'Question has been removed from the course.');
                });
            });
        }

        // Handle video file name display
        document.getElementById('courseVideoInput').addEventListener('change', function() {
            const fileNameDisplay = document.getElementById('courseVideoFileName');
            if (this.files.length > 0) {
                fileNameDisplay.textContent = `Selected: ${this.files[0].name}`;
                fileNameDisplay.classList.remove('hidden');
                currentVideoFileName = this.files[0].name; // Store file name for display
            } else {
                fileNameDisplay.textContent = '';
                fileNameDisplay.classList.add('hidden');
                currentVideoFileName = '';
            }
        });

        // Handle PDF file name display
        coursePdfInput.addEventListener('change', function() {
            if (this.files.length > 0) {
                coursePdfFileNameDisplay.textContent = `Selected: ${this.files[0].name}`;
                coursePdfFileNameDisplay.classList.remove('hidden');
                currentCoursePdfFileName = this.files[0].name;
            } else {
                coursePdfFileNameDisplay.textContent = '';
                coursePdfFileNameDisplay.classList.add('hidden');
                currentCoursePdfFileName = '';
            }
        });

        // Handle Course Picture preview
        coursePictureInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    coursePicturePreview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                coursePicturePreview.src = "https://placehold.co/128x128/E0E7FF/4F46E5?text=Course+Image"; // Reset to placeholder
            }
        });


        // Reset Course Form
        function resetCourseForm() {
            document.getElementById('createCourseForm').reset();
            document.getElementById('questionTypeSelect').value = '';
            renderQuestionInputArea('');
            currentCourseQuestions = [];
            updateCourseQuestionsList();
            currentVideoFileName = '';
            currentCoursePdfFileName = '';
            document.getElementById('courseVideoFileName').classList.add('hidden');
            coursePdfFileNameDisplay.classList.add('hidden');
            coursePicturePreview.src = "https://placehold.co/128x128/E0E7FF/4F46E5?text=Course+Image"; // Reset course picture preview
            document.getElementById('addQuestionBtn').disabled = true;
            showMessageModal('Form Reset', 'The course creation form has been cleared.');
        }

        // Handle Create Course Form Submission
        document.getElementById('createCourseForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const courseName = document.getElementById('courseNameInput').value.trim();
            const courseDescription = document.getElementById('courseDescriptionInput').value.trim();

            if (!courseName || !courseDescription) {
                showMessageModal('Input Error', 'Please enter course name and description.');
                return;
            }

            if (currentCourseQuestions.length === 0) {
                showMessageModal('Input Error', 'Please add at least one question to the course.');
                return;
            }
            if (!loggedInUser.id) {
                showMessageModal('Authentication Error', 'Please log in as a Training Manager to create a course.');
                return;
            }

            const coursePicture = coursePicturePreview.src;

            const newCourse = {
                id: Date.now(),
                name: courseName,
                description: courseDescription,
                videoFileName: currentVideoFileName,
                pdfFileName: currentCoursePdfFileName,
                picture: coursePicture,
                questions: [...currentCourseQuestions],
                readStatus: false,
                creatorId: loggedInUser.id // Assign creator ID
            };
            allCoursesData.push(newCourse);

            renderTrainingManagerCoursesTable(); // Re-render the Training Manager's courses table
            renderAllExistingCoursesTable(); // Re-render the Admin's courses table
            populateLinkedCoursesSelection(); // Update courses available for programmes
            populateReportCourseSelect(); // Update courses available in reports dropdown

            updateDashboardStats(); // Update dashboard stats after adding course

            showMessageModal('Course Created', `Course "${courseName}" has been successfully created with ${currentCourseQuestions.length} questions.`);
            resetCourseForm();
        });

        // Render Training Manager's Courses Table
        function renderTrainingManagerCoursesTable() {
            const tableBody = document.getElementById('trainingManagerCoursesTableBody');
            tableBody.innerHTML = '';
            const myCourses = allCoursesData.filter(course => course.creatorId === loggedInUser.id);

            if (myCourses.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No courses created by you. Create a new course above.</td>
                    </tr>
                `;
            } else {
                myCourses.forEach(course => {
                    const newRow = tableBody.insertRow();
                    newRow.classList.add('cursor-pointer', 'hover:bg-gray-50');

                    const totalMarks = course.questions.reduce((sum, q) => sum + (q.marks || 0), 0);

                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"><img src="${course.picture}" alt="Course" class="h-10 w-10 rounded-md object-cover"></td>`;
                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${course.name}</td>`;
                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${course.description.substring(0, 50)}${course.description.length > 50 ? '...' : ''}</td>`;
                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${course.videoFileName || 'N/A'}</td>`;
                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${course.pdfFileName || 'N/A'}</td>`;
                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${totalMarks}</td>`;
                    newRow.insertCell().outerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <a href="#" class="text-indigo-600 hover:text-indigo-900 mr-3">Edit</a>
                            <a href="#" class="text-red-600 hover:text-red-900">Delete</a>
                        </td>
                    `;
                });
            }

            let currentCoursesCount = myCourses.length;
            document.getElementById('myCoursesTotalCount').textContent = currentCoursesCount;
            document.getElementById('myCoursesShowingCount').textContent = currentCoursesCount > 0 ? 1 : 0;
            document.getElementById('myCoursesTotalCountDisplay').textContent = currentCoursesCount;
        }

        // Render ALL Existing Courses Table (for Admin overview)
        function renderAllExistingCoursesTable() {
            const existingCoursesTableBody = document.getElementById('allExistingCoursesTableBody');
            existingCoursesTableBody.innerHTML = '';

            if (allCoursesData.length === 0) {
                existingCoursesTableBody.innerHTML = `
                    <tr>
                        <td colspan="8" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No courses to display. Create a new course in "My Courses".</td>
                    </tr>
                `;
            } else {
                allCoursesData.forEach(course => {
                    const creator = allUsersData.find(user => user.id === course.creatorId);
                    const creatorName = creator ? `${creator.name}${creator.surname ? ' ' + creator.surname : ''}` + (creator.role ? ` (${creator.role.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')})` : '') : 'Unknown';

                    const newRow = existingCoursesTableBody.insertRow();
                    newRow.classList.add('cursor-pointer', 'hover:bg-gray-50');

                    const totalMarks = course.questions.reduce((sum, q) => sum + (q.marks || 0), 0);

                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"><img src="${course.picture}" alt="Course" class="h-10 w-10 rounded-md object-cover"></td>`;
                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${course.name}</td>`;
                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${course.description.substring(0, 50)}${course.description.length > 50 ? '...' : ''}</td>`;
                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${course.videoFileName || 'N/A'}</td>`;
                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${course.pdfFileName || 'N/A'}</td>`;
                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${totalMarks}</td>`;
                    newRow.insertCell().outerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${creatorName}</td>`;
                    newRow.insertCell().outerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <a href="#" class="text-indigo-600 hover:text-indigo-900 mr-3">Edit</a>
                            <a href="#" class="text-red-600 hover:text-red-900">Delete</a>
                        </td>
                    `;
                });
            }

            let currentCoursesCount = allCoursesData.length;
            document.getElementById('allCoursesTotalCount').textContent = currentCoursesCount;
            document.getElementById('allCoursesShowingCount').textContent = currentCoursesCount > 0 ? 1 : 0;
            document.getElementById('allCoursesTotalCountDisplay').textContent = currentCoursesCount;
        }


        // PDF Viewer Modal Logic
        const pdfViewerModal = document.getElementById('pdfViewerModal');
        const pdfModalTitle = document.getElementById('pdfModalTitle');
        const simulatedPdfContentFileName = document.getElementById('simulatedPdfContentFileName');
        let currentViewingDocumentId = null; // To keep track of which document is being viewed

        function showPdfViewerModal(documentName, documentId) {
            pdfModalTitle.textContent = `View Document: ${documentName}`;
            simulatedPdfContentFileName.textContent = documentName;
            currentViewingDocumentId = documentId; // Store the ID
            
            // Set initial state of Mark as Read button based on document status
            const markAsReadBtn = document.getElementById('markAsReadBtn');
            const course = allCoursesData.find(c => c.id === documentId);
            if (course && course.readStatus) {
                markAsReadBtn.textContent = 'Already Read';
                markAsReadBtn.disabled = true;
                markAsReadBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                markAsReadBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
            } else {
                markAsReadBtn.textContent = 'Mark as Read';
                markAsReadBtn.disabled = false;
                markAsReadBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                markAsReadBtn.classList.add('bg-green-600', 'hover:bg-green-700');
            }

            pdfViewerModal.classList.remove('hidden');
            pdfViewerModal.classList.add('show');
        }

        function hidePdfViewerModal() {
            pdfViewerModal.classList.remove('show');
            pdfViewerModal.classList.add('hidden');
            currentViewingDocumentId = null; // Clear the ID
        }

        // Mark as Read button listener inside PDF viewer modal
        document.getElementById('markAsReadBtn').addEventListener('click', function() {
            if (currentViewingDocumentId) {
                const courseIndex = allCoursesData.findIndex(c => c.id === currentViewingDocumentId);
                if (courseIndex !== -1) {
                    allCoursesData[courseIndex].readStatus = true;
                    showMessageModal('Completion Marked', `"${allCoursesData[courseIndex].pdfFileName}" marked as read.`);
                    // Update the UI in course content list as well
                    renderAllExistingCoursesTable(); // For admin view
                    renderTrainingManagerCoursesTable(); // For Training Manager view
                    // Disable the button in the modal
                    this.textContent = 'Already Read';
                    this.disabled = true;
                    this.classList.remove('bg-green-600', 'hover:bg-green-700');
                    this.classList.add('bg-gray-400', 'cursor-not-allowed');
                }
            }
        });


        // Programme Management Logic
        let allProgramsData = []; // Stores all created programme data
        const programmePicturePreview = document.getElementById('programmePicturePreview');
        const programmePictureInput = document.getElementById('programmePictureInput');
        const linkedCoursesSelection = document.getElementById('linkedCoursesSelection');

        // Handle Programme Picture preview
        programmePictureInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    programmePicturePreview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                programmePicturePreview.src = "https://placehold.co/128x128/ADD8E6/00008B?text=Programme+Image"; // Reset to placeholder
            }
        });

        // Populate courses for linking to a programme
        function populateLinkedCoursesSelection() {
            linkedCoursesSelection.innerHTML = '';
            if (allCoursesData.length === 0) {
                linkedCoursesSelection.innerHTML = '<p id="noCoursesAvailableForProgramme" class="text-gray-500 text-sm text-center">No courses available. Create courses first.</p>';
            } else {
                allCoursesData.forEach(course => {
                    const checkboxDiv = document.createElement('div');
                    checkboxDiv.classList.add('flex', 'items-center', 'py-1');
                    checkboxDiv.innerHTML = `
                        <input type="checkbox" id="linkCourse_${course.id}" value="${course.id}" class="linked-course-checkbox h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                        <label for="linkCourse_${course.id}" class="ml-2 text-sm text-gray-700">${course.name}</label>
                    `;
                    linkedCoursesSelection.appendChild(checkboxDiv);
                });
            }
        }

        // Reset Programme Form
        function resetProgrammeForm() {
            document.getElementById('createProgrammeForm').reset();
            programmePicturePreview.src = "https://placehold.co/128x128/ADD8E6/00008B?text=Programme+Image";
            document.querySelectorAll('.linked-course-checkbox').forEach(checkbox => checkbox.checked = false);
            showMessageModal('Form Reset', 'The programme creation form has been cleared.');
        }

        // Handle Create Programme Form Submission
        document.getElementById('createProgrammeForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const programmeName = document.getElementById('programmeNameInput').value.trim();
            const programmePicture = programmePicturePreview.src;
            const selectedCourseIds = Array.from(document.querySelectorAll('.linked-course-checkbox:checked'))
                                          .map(checkbox => parseInt(checkbox.value));

            if (!programmeName) {
                showMessageModal('Input Error', 'Please enter a programme name.');
                return;
            }

            const newProgramme = {
                id: Date.now(),
                name: programmeName,
                picture: programmePicture,
                linkedCourseIds: selectedCourseIds,
                assignedStudentIds: [] // Initially no students assigned
            };
            allProgramsData.push(newProgramme);
            
            renderExistingProgramsTable();
            renderProgrammesForAssignmentTable(); // Update the new assignment table
            updateDashboardStats(); // Update dashboard stats after adding programme

            showMessageModal('Programme Created', `Programme "${programmeName}" has been successfully created.`);
            resetProgrammeForm();
        });

        // Render Existing Programmes Table
        function renderExistingProgramsTable() {
            const tableBody = document.getElementById('existingProgrammesTableBody');
            tableBody.innerHTML = '';

            if (allProgramsData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No programmes to display. Create a new programme above.</td>
                    </tr>
                `;
            } else {
                allProgramsData.forEach(programme => {
                    const row = tableBody.insertRow();
                    row.classList.add('cursor-pointer', 'hover:bg-gray-50');
                    row.dataset.programmeId = programme.id; // Store programme ID on the row

                    const linkedCoursesCount = programme.linkedCourseIds.length;
                    const assignedStudentsCount = programme.assignedStudentIds.length;

                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap"><img src="${programme.picture}" alt="Programme" class="h-10 w-10 rounded-md object-cover"></td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${programme.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${linkedCoursesCount} course(s)</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${assignedStudentsCount} student(s)</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button class="text-blue-600 hover:text-blue-900 mr-3 assign-students-btn" data-programme-id="${programme.id}">Assign Students</button>
                            <a href="#" class="text-indigo-600 hover:text-indigo-900 mr-3">Edit</a>
                            <a href="#" class="text-red-600 hover:text-red-900">Delete</a>
                        </td>
                    `;
                });
            }

            // Update programme counts
            document.getElementById('programmesTotalCount').textContent = allProgramsData.length;
            document.getElementById('programmesShowingCount').textContent = allProgramsData.length > 0 ? 1 : 0;
            document.getElementById('programmesTotalCountDisplay').textContent = allProgramsData.length;
        }

        // Assign Students Modal Logic
        const assignStudentsModal = document.getElementById('assignStudentsModal');
        const assignStudentsModalTitle = document.getElementById('assignStudentsModalTitle');
        const assignStudentsList = document.getElementById('assignStudentsList');
        const noStudentsAvailableMsg = document.getElementById('noStudentsAvailable');
        let currentProgrammeIdToAssign = null;

        function showAssignStudentsModal(programmeId) {
            currentProgrammeIdToAssign = programmeId;
            const programme = allProgramsData.find(p => p.id === programmeId);
            if (!programme) {
                showMessageModal('Error', 'Programme not found.');
                return;
            }
            assignStudentsModalTitle.textContent = `Assign Students to: ${programme.name}`;
            assignStudentsList.innerHTML = ''; // Clear previous list

            const students = allUsersData.filter(user => user.role === 'student');

            if (students.length === 0) {
                noStudentsAvailableMsg.classList.remove('hidden');
            } else {
                noStudentsAvailableMsg.classList.add('hidden');
                students.forEach(student => {
                    // Check if student is already assigned to THIS programme
                    const isAssignedToThisProgramme = programme.assignedStudentIds.includes(student.id);
                    const checkboxDiv = document.createElement('div');
                    checkboxDiv.classList.add('flex', 'items-center', 'py-1');
                    const fullName = `${student.name}${student.surname ? ' ' + student.surname : ''}`;
                    checkboxDiv.innerHTML = `
                        <input type="checkbox" id="assignStudent_${student.id}" value="${student.id}" class="assign-student-checkbox h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" ${isAssignedToThisProgramme ? 'checked' : ''}>
                        <label for="assignStudent_${student.id}" class="ml-2 text-sm text-gray-700">${fullName} (${student.email})</label>
                    `;
                    assignStudentsList.appendChild(checkboxDiv);
                });
            }

            assignStudentsModal.classList.remove('hidden');
            assignStudentsModal.classList.add('show');
        }

        function hideAssignStudentsModal() {
            assignStudentsModal.classList.remove('show');
            assignStudentsModal.classList.add('hidden');
            currentProgrammeIdToAssign = null;
        }

        document.getElementById('saveAssignedStudentsBtn').addEventListener('click', function() {
            if (currentProgrammeIdToAssign) {
                const programme = allProgramsData.find(p => p.id === currentProgrammeIdToAssign);
                if (programme) {
                    const newlySelectedStudentIds = Array.from(document.querySelectorAll('.assign-student-checkbox:checked'))
                                                      .map(checkbox => parseInt(checkbox.value));
                    
                    // Students removed from this programme
                    const removedStudentIds = programme.assignedStudentIds.filter(id => !newlySelectedStudentIds.includes(id));
                    // Students newly added to this programme
                    const addedStudentIds = newlySelectedStudentIds.filter(id => !programme.assignedStudentIds.includes(id));

                    programme.assignedStudentIds = newlySelectedStudentIds; // Update the programme's assigned students

                    // Update each student's coursesEnrolled list based on programme's linked courses
                    const programmeLinkedCourses = programme.linkedCourseIds;

                    removedStudentIds.forEach(studentId => {
                        const student = allUsersData.find(u => u.id === studentId);
                        if (student) {
                            // Remove courses linked to this programme from student's enrolled list
                            student.coursesEnrolled = student.coursesEnrolled.filter(enr =>
                                !programmeLinkedCourses.includes(enr.courseId)
                            );
                            student.totalHoursSpent = student.coursesEnrolled.reduce((sum, c) => sum + (c.hoursSpent || 0), 0);
                        }
                    });

                    addedStudentIds.forEach(studentId => {
                        const student = allUsersData.find(u => u.id === studentId);
                        if (student) {
                            programmeLinkedCourses.forEach(courseId => {
                                // Add course to student's enrolled list if not already there
                                if (!student.coursesEnrolled.some(enr => enr.courseId === courseId)) {
                                    student.coursesEnrolled.push({
                                        courseId: courseId,
                                        enrollmentDate: new Date().toISOString().slice(0, 10),
                                        completionDate: null,
                                        hoursSpent: 0 // Initialize hours spent for this course
                                    });
                                }
                            });
                             student.totalHoursSpent = student.coursesEnrolled.reduce((sum, c) => sum + (c.hoursSpent || 0), 0);
                        }
                    });
                    
                    showMessageModal('Success', `Student assignments for "${programme.name}" updated.`);
                    renderExistingProgramsTable(); // Re-render programme table
                    renderProgrammesForAssignmentTable(); // Re-render assignment table
                    updateDashboardStats(); // Refresh dashboard counts
                }
            }
            hideAssignStudentsModal();
        });

        // New function to render the table in the "User Assignment to Programmes" section
        function renderProgrammesForAssignmentTable() {
            const tableBody = document.getElementById('programmesForAssignmentTableBody');
            tableBody.innerHTML = '';

            if (allProgramsData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="4" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No programmes available for assignment. Create programmes first.</td>
                    </tr>
                `;
            } else {
                allProgramsData.forEach(programme => {
                    const row = tableBody.insertRow();
                    row.classList.add('hover:bg-gray-50'); // No click for the row, only the button

                    const linkedCoursesNames = programme.linkedCourseIds.map(id => {
                        const course = allCoursesData.find(c => c.id === id);
                        return course ? course.name : 'Unknown Course';
                    }).join(', ') || 'None';

                    const assignedStudentsNames = programme.assignedStudentIds.map(id => {
                        const student = allUsersData.find(u => u.id === id);
                        return student ? `${student.name}${student.surname ? ' ' + student.surname : ''}` : 'Unknown Student';
                    }).join(', ') || 'None';

                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${programme.name}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${linkedCoursesNames}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${assignedStudentsNames}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button class="text-blue-600 hover:text-blue-900 assign-students-btn-trigger" data-programme-id="${programme.id}">Assign/View Students</button>
                        </td>
                    `;
                });
            }

            // Update programme counts for this specific table
            document.getElementById('assignProgrammesTotalCount').textContent = allProgramsData.length;
            document.getElementById('assignProgrammesShowingCount').textContent = allProgramsData.length > 0 ? 1 : 0;
            document.getElementById('assignProgrammesTotalCountDisplay').textContent = allProgramsData.length;

            // Add event listeners for "Assign/View Students" buttons in this new table
            document.querySelectorAll('.assign-students-btn-trigger').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation(); // Prevent row click event if table rows were clickable
                    const programmeId = parseInt(this.dataset.programmeId);
                    showAssignStudentsModal(programmeId);
                });
            });
        }

        // System Settings Logic
        const systemLogoPreview = document.getElementById('systemLogoPreview');
        const systemLogoInput = document.getElementById('systemLogoInput');
        const generalSettingsForm = document.getElementById('generalSettingsForm');
        const systemNameInput = document.getElementById('systemNameInput');
        const defaultTimezoneSelect = document.getElementById('defaultTimezoneSelect');
        const systemLanguageSelect = document.getElementById('systemLanguageSelect');

        // Initial system settings data (can be loaded from localStorage in a real app)
        let systemSettings = {
            systemName: 'SKILLSCONNECT',
            systemLogo: 'https://placehold.co/96x96/ADD8E6/00008B?text=LMS',
            defaultTimezone: 'UTC+2',
            systemLanguage: 'en'
        };

        // Function to load settings into the form
        function loadSystemSettings() {
            systemNameInput.value = systemSettings.systemName;
            systemLogoPreview.src = systemSettings.systemLogo;
            defaultTimezoneSelect.value = systemSettings.defaultTimezone;
            systemLanguageSelect.value = systemSettings.systemLanguage;
        }

        // Handle system logo preview
        systemLogoInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    systemLogoPreview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                systemLogoPreview.src = "https://placehold.co/96x96/ADD8E6/00008B?text=LMS"; // Reset to placeholder
            }
        });

        // Handle form submission for general settings
        generalSettingsForm.addEventListener('submit', function(e) {
            e.preventDefault();

            systemSettings.systemName = systemNameInput.value.trim();
            // Store the base64 or URL for the logo if it's new
            systemSettings.systemLogo = systemLogoPreview.src;
            systemSettings.defaultTimezone = defaultTimezoneSelect.value;
            systemSettings.systemLanguage = systemLanguageSelect.value;

            // Update logo in sidebar and top nav if they exist
            document.querySelectorAll('.fas.fa-graduation-cap.text-2xl.mr-3').forEach(icon => {
                 // Replace original logo icon with image if a custom logo is set
                if (systemSettings.systemLogo !== "https://placehold.co/96x96/ADD8E6/00008B?text=LMS") { // Check if it's not the default placeholder
                    const img = document.createElement('img');
                    img.src = systemSettings.systemLogo;
                    img.classList.add('h-8', 'w-8', 'rounded-full', 'mr-3', 'object-cover');
                    icon.replaceWith(img);
                }
            });


            showMessageModal('Settings Saved', 'General LMS settings have been updated.');
        });

        // Profile Settings Logic
        const profileSettingsForm = document.getElementById('profileSettingsForm');
        const profilePicturePreview = document.getElementById('profilePicturePreview');
        const profilePictureInput = document.getElementById('profilePictureInput');
        const profileFullNameInput = document.getElementById('profileFullNameInput');
        const profileEmailInput = document.getElementById('profileEmailInput');
        const profileContactInput = document.getElementById('profileContactInput');
        const profileAddressInput = document.getElementById('profileAddressInput');
        const profilePasswordInput = document.getElementById('profilePasswordInput');

        // Function to load profile settings into the form
        function loadProfileSettings() {
            profileFullNameInput.value = loggedInUser.fullName;
            profileEmailInput.value = loggedInUser.email;
            profileContactInput.value = loggedInUser.contact || '';
            profileAddressInput.value = loggedInUser.address || '';
            profilePicturePreview.src = loggedInUser.picture;
            profilePasswordInput.value = ''; // Never pre-fill password fields
        }

        // Handle profile picture preview
        profilePictureInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    profilePicturePreview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                profilePicturePreview.src = loggedInUser.picture; // Revert to current user picture
            }
        });

        // Handle profile settings form submission
        profileSettingsForm.addEventListener('submit', function(e) {
            e.preventDefault();

            loggedInUser.fullName = profileFullNameInput.value.trim();
            loggedInUser.email = profileEmailInput.value.trim();
            loggedInUser.contact = profileContactInput.value.trim();
            loggedInUser.address = profileAddressInput.value.trim();
            loggedInUser.picture = profilePicturePreview.src; // Update with new picture if uploaded

            // Find the user in allUsersData and update their properties
            const userIndex = allUsersData.findIndex(u => u.id === loggedInUser.id);
            if (userIndex !== -1) {
                // Ensure name and surname are updated correctly from fullName
                const nameParts = loggedInUser.fullName.split(' ');
                allUsersData[userIndex].name = nameParts[0] || '';
                allUsersData[userIndex].surname = nameParts.slice(1).join(' ') || ''; // Join remaining parts for surname
                allUsersData[userIndex].email = loggedInUser.email;
                // Don't update ID number or role here, as they are not editable via profile
                allUsersData[userIndex].picture = loggedInUser.picture;
                // Add contact and address fields to user object if they exist
                allUsersData[userIndex].contact = loggedInUser.contact;
                allUsersData[userIndex].address = loggedInUser.address;
            }

            if (profilePasswordInput.value.trim() !== '') {
                // In a real app, this would hash and save the new password
                // For simulation, just acknowledge it
                showMessageModal('Password Updated', 'Your password has been changed.');
                profilePasswordInput.value = ''; // Clear password field after change
            }
            
            // Update sidebar and top nav user info in case full name or picture changed
            document.getElementById('sidebarUsername').textContent = loggedInUser.fullName;
            document.getElementById('topNavUsername').textContent = loggedInUser.fullName;
            document.querySelector('#sidebar .user-info img').src = loggedInUser.picture;
            document.querySelector('header .dropdown img').src = loggedInUser.picture;


            showMessageModal('Profile Updated', 'Your personal information has been saved successfully.');
        });

        // Function to update dashboard statistics
        function updateDashboardStats() {
            const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
            const totalCoursesElement = document.getElementById('totalCourses');
            const totalStudentsElement = document.getElementById('totalStudents');
            const adminStatsCards = document.getElementById('adminStatsCards');
            const studentStatsCards = document.getElementById('studentStatsCards');
            const recentActivitySection = document.getElementById('recentActivitySection');
            const recentNotificationsSection = document.getElementById('recentNotificationsSection');
            const badgesEarnedSection = document.getElementById('badgesEarnedSection');
            const certificatesEarnedSection = document.getElementById('certificatesEarnedSection');

            if (loggedInUser && loggedInUser.role === 'student') {
                // Show student stats, hide admin stats
                if (adminStatsCards) adminStatsCards.style.display = 'none';
                if (studentStatsCards) studentStatsCards.style.display = 'grid';
                if (recentActivitySection) recentActivitySection.style.display = 'none';
                if (recentNotificationsSection) recentNotificationsSection.style.display = 'block';
                if (badgesEarnedSection) badgesEarnedSection.style.display = 'block';
                if (certificatesEarnedSection) certificatesEarnedSection.style.display = 'block';

                // Update student stats - with null checks
                const enrolledCoursesElement = document.getElementById('studentEnrolledCourses');
                const totalHoursElement = document.getElementById('studentTotalHours');
                const badgesElement = document.getElementById('studentBadgesCount');

                if (enrolledCoursesElement) {
                    const enrolledCoursesCount = loggedInUser.coursesEnrolled ? loggedInUser.coursesEnrolled.length : 0;
                    enrolledCoursesElement.textContent = enrolledCoursesCount;
                }

                if (totalHoursElement) {
                    const totalHours = loggedInUser.totalHoursSpent || 0;
                    totalHoursElement.textContent = totalHours.toFixed(1);
                }

                if (badgesElement) {
                    // Count student badges
                    const studentBadges = studentBadgesData.filter(b => b.studentId === loggedInUser.id);
                    const badgesCount = studentBadges.length;
                    badgesElement.textContent = badgesCount;
                }

                // Load recent notifications
                setTimeout(() => loadStudentNotifications(loggedInUser.id), 100);
                
                // Load badges earned
                setTimeout(() => loadStudentBadgesEarned(loggedInUser.id), 100);

                // Load certificates earned
                setTimeout(() => loadStudentCertificatesEarned(loggedInUser.id), 100);
            } else {
                // Show admin stats, hide student stats
                if (adminStatsCards) adminStatsCards.style.display = 'grid';
                if (studentStatsCards) studentStatsCards.style.display = 'none';
                if (recentActivitySection) recentActivitySection.style.display = 'block';
                if (recentNotificationsSection) recentNotificationsSection.style.display = 'none';
                if (badgesEarnedSection) badgesEarnedSection.style.display = 'none';
                if (certificatesEarnedSection) certificatesEarnedSection.style.display = 'none';

                if (totalCoursesElement) {
                    totalCoursesElement.textContent = allCoursesData.length;
                }
                if (totalStudentsElement) {
                    const studentsCount = allUsersData.filter(user => user.role === 'student').length;
                    totalStudentsElement.textContent = studentsCount;
                }
            }
        }

        // Function to load student notifications
        function loadStudentNotifications(studentId) {
            const notificationsList = document.getElementById('recentNotificationsList');
            
            if (!notificationsList) {
                console.error('recentNotificationsList element not found');
                return;
            }
            
            console.log('Loading notifications for student:', studentId);
            
            // Sample notifications - in a real system these would come from a database
            const notifications = [
                {
                    id: 1,
                    title: 'Course Completion Reminder',
                    message: 'Remember to complete "Health & Safety Fundamentals" by 25 August 2025',
                    type: 'warning',
                    timestamp: new Date(Date.now() - 1 * 60 * 60 * 1000),
                    read: false
                },
                {
                    id: 2,
                    title: 'Assignment Due Soon',
                    message: 'Your "Fire Safety Assessment" assignment is due in 3 days (22 January 2026)',
                    type: 'warning',
                    timestamp: new Date(Date.now() - 4 * 60 * 60 * 1000),
                    read: false
                },
                {
                    id: 3,
                    title: 'Course Completed',
                    message: 'Congratulations! You completed "Introduction to Web Development"',
                    type: 'success',
                    timestamp: new Date(Date.now() - 24 * 60 * 60 * 1000),
                    read: false
                },
                {
                    id: 4,
                    title: 'Badge Earned',
                    message: 'You earned the "Quick Learner" badge for completing your first 5 hours of learning',
                    type: 'info',
                    timestamp: new Date(Date.now() - 48 * 60 * 60 * 1000),
                    read: true
                },
                {
                    id: 5,
                    title: 'New Course Launch',
                    message: 'New course available: "Advanced Fire Safety Procedures" - Enroll now to get started!',
                    type: 'info',
                    timestamp: new Date(Date.now() - 72 * 60 * 60 * 1000),
                    read: true
                },
                {
                    id: 6,
                    title: 'Grade Posted',
                    message: 'Your grade for "Data Science Quiz" has been posted: 88/100',
                    type: 'success',
                    timestamp: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000),
                    read: true
                },
                {
                    id: 7,
                    title: 'Training Manager Message',
                    message: 'Your trainer Jane sent you feedback: "Great progress on the latest assignments! Keep it up."',
                    type: 'info',
                    timestamp: new Date(Date.now() - 6 * 24 * 60 * 60 * 1000),
                    read: true
                }
            ];

            if (notifications.length === 0) {
                notificationsList.innerHTML = '<p class="text-gray-500 text-sm">No notifications to display.</p>';
                return;
            }

            notificationsList.innerHTML = '';
            notifications.forEach(notification => {
                const notificationElement = document.createElement('div');
                notificationElement.className = `p-4 rounded-lg border-l-4 ${getNotificationStyles(notification.type)} ${notification.read ? 'bg-gray-50' : 'bg-white'}`;
                
                const timeAgo = getTimeAgo(notification.timestamp);
                
                notificationElement.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-800 text-sm">${notification.title}</h4>
                            <p class="text-gray-600 text-sm mt-1">${notification.message}</p>
                            <p class="text-xs text-gray-500 mt-2">${timeAgo}</p>
                        </div>
                        ${!notification.read ? '<span class="ml-4 inline-block w-2 h-2 bg-blue-600 rounded-full"></span>' : ''}
                    </div>
                `;
                notificationsList.appendChild(notificationElement);
            });
        }

        // Helper function to get notification styling based on type
        function getNotificationStyles(type) {
            switch(type) {
                case 'warning':
                    return 'border-yellow-400 bg-yellow-50';
                case 'success':
                    return 'border-green-400 bg-green-50';
                case 'error':
                    return 'border-red-400 bg-red-50';
                case 'info':
                default:
                    return 'border-blue-400 bg-blue-50';
            }
        }

        // Helper function to format time ago
        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            const intervals = {
                year: 31536000,
                month: 2592000,
                week: 604800,
                day: 86400,
                hour: 3600,
                minute: 60
            };

            for (const [key, value] of Object.entries(intervals)) {
                const interval = Math.floor(seconds / value);
                if (interval >= 1) {
                    return interval === 1 ? `${interval} ${key} ago` : `${interval} ${key}s ago`;
                }
            }
            return 'Just now';
        }

        // Function to load and display student badges earned
        function loadStudentBadgesEarned(studentId) {
            const badgesEarnedList = document.getElementById('badgesEarnedList');
            
            if (!badgesEarnedList) {
                console.error('badgesEarnedList element not found');
                return;
            }

            // Get all badges earned by this student
            const studentBadgesEarned = studentBadgesData.filter(b => b.studentId === studentId);

            if (studentBadgesEarned.length === 0) {
                badgesEarnedList.innerHTML = '<p class="text-gray-500 text-sm col-span-full">No badges earned yet. Keep learning to earn badges!</p>';
                return;
            }

            badgesEarnedList.innerHTML = '';
            
            // Get badge details for each earned badge
            studentBadgesEarned.forEach(earnedBadge => {
                const badgeData = allBadgesData.find(b => b.id === earnedBadge.badgeId);
                
                if (badgeData) {
                    const badgeElement = document.createElement('div');
                    badgeElement.className = 'flex flex-col items-center p-4 rounded-lg border-2 border-yellow-400 bg-yellow-50 hover:shadow-lg transition';
                    
                    const earnedDate = new Date(earnedBadge.earnedDate);
                    const dateFormatted = earnedDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
                    
                    badgeElement.innerHTML = `
                        <div class="text-5xl mb-2">${badgeData.icon}</div>
                        <h4 class="font-semibold text-gray-800 text-center text-sm">${badgeData.name}</h4>
                        <p class="text-xs text-gray-600 text-center mt-1">${badgeData.description}</p>
                        <p class="text-xs text-gray-500 mt-2">Earned on ${dateFormatted}</p>
                    `;
                    badgesEarnedList.appendChild(badgeElement);
                }
            });
        }

        // Function to load and display student certificates earned
        function loadStudentCertificatesEarned(studentId) {
            const certificatesEarnedList = document.getElementById('certificatesEarnedList');
            
            if (!certificatesEarnedList) {
                console.error('certificatesEarnedList element not found');
                return;
            }

            // Get all certificates earned by this student
            const studentCertificates = allCertificatesData.filter(c => c.studentId === studentId);

            if (studentCertificates.length === 0) {
                certificatesEarnedList.innerHTML = '<p class="text-gray-500 text-sm col-span-full">No certificates earned yet. Complete courses to earn certificates!</p>';
                return;
            }

            certificatesEarnedList.innerHTML = '';
            
            // Display each certificate
            studentCertificates.forEach(certificate => {
                const certElement = document.createElement('div');
                certElement.className = 'p-4 rounded-lg border-2 border-blue-400 bg-blue-50 hover:shadow-lg transition cursor-pointer';
                
                const issueDate = new Date(certificate.issueDate);
                const dateFormatted = issueDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
                
                certElement.innerHTML = `
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-certificate text-blue-600 text-xl mr-2"></i>
                                <h4 class="font-semibold text-gray-800">${certificate.courseName}</h4>
                            </div>
                            <p class="text-sm text-gray-600 mb-2">${certificate.certificateType}</p>
                            <p class="text-xs text-gray-500">Issued on ${dateFormatted}</p>
                            <p class="text-xs text-gray-500">Certificate ID: ${certificate.id}</p>
                        </div>
                        <button onclick="showCertificateViewer('${certificate.id}')" class="ml-4 px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">
                            View
                        </button>
                    </div>
                `;
                certificatesEarnedList.appendChild(certElement);
            });
        }

        // Reports Section Logic
        const reportGenerationForm = document.getElementById('reportGenerationForm');
        const reportCourseSelect = document.getElementById('reportCourseSelect');
        const reportResultsTableBody = document.getElementById('reportResultsTableBody');

        // Populate course select dropdown for reports
        function populateReportCourseSelect() {
            reportCourseSelect.innerHTML = '<option value="all">All Courses</option>'; // Always have "All Courses"
            allCoursesData.forEach(course => {
                const option = document.createElement('option');
                option.value = course.id;
                option.textContent = course.name;
                reportCourseSelect.appendChild(option);
            });
        }

        // Generate Report Function
        reportGenerationForm.addEventListener('submit', function(e) {
            e.preventDefault();

            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            const userStatusFilter = document.getElementById('reportUserStatus').value;
            const courseFilterId = document.getElementById('reportCourseSelect').value; // Keep as string for 'all'

            let filteredUsers = allUsersData;

            // Apply User Status/Role Filter
            if (userStatusFilter !== 'all') {
                if (userStatusFilter === 'active' || userStatusFilter === 'deactivated') {
                    filteredUsers = filteredUsers.filter(user => user.status === userStatusFilter);
                } else { // Specific role (student, training_manager, administrator)
                    filteredUsers = filteredUsers.filter(user => user.role === userStatusFilter);
                }
            }

            // Apply Date Range Filter (Enrollment Date)
            if (startDate) {
                filteredUsers = filteredUsers.filter(user => user.enrollmentDate && new Date(user.enrollmentDate) >= new Date(startDate));
            }
            if (endDate) {
                filteredUsers = filteredUsers.filter(user => user.enrollmentDate && new Date(user.enrollmentDate) <= new Date(endDate));
            }

            // Render Report Results
            reportResultsTableBody.innerHTML = ''; // Clear previous results

            let displayedRowCount = 0;

            filteredUsers.forEach(user => {
                let enrolledCoursesNames = [];
                let completedCoursesNames = [];
                let userTotalHours = 0;

                // Process courses for students
                if (user.role === 'student' && user.coursesEnrolled && user.coursesEnrolled.length > 0) {
                    user.coursesEnrolled.forEach(enrollment => {
                        const course = allCoursesData.find(c => c.id === enrollment.courseId);
                        if (course) {
                            // Apply course filter
                            if (courseFilterId === 'all' || enrollment.courseId === parseInt(courseFilterId)) {
                                enrolledCoursesNames.push(course.name);
                                userTotalHours += (enrollment.hoursSpent || 0); // Sum hours spent
                                if (enrollment.completionDate) {
                                    completedCoursesNames.push(course.name);
                                }
                            }
                        }
                    });
                }
                
                // If a specific course is filtered and this user (if student) is not enrolled in it, skip.
                // Or if it's a non-student and a course filter is applied, skip.
                if (courseFilterId !== 'all' && user.role === 'student' && !enrolledCoursesNames.length) {
                    return; // Skip this student if they are not associated with the filtered course
                }
                if (courseFilterId !== 'all' && user.role !== 'student') {
                    return; // Skip non-students if a specific course is filtered
                }

                // For non-students, courses/hours are N/A
                const displayEnrolledCourses = user.role === 'student' ? (enrolledCoursesNames.length > 0 ? enrolledCoursesNames.join(', ') : 'None') : 'N/A';
                const displayCompletedCourses = user.role === 'student' ? (completedCoursesNames.length > 0 ? completedCoursesNames.join(', ') : 'None') : 'N/A';
                const displayHoursSpent = user.role === 'student' ? userTotalHours : 'N/A';
                const userEndDate = user.endDate || 'N/A';
                const fullName = `${user.name}${user.surname ? ' ' + user.surname : ''}`;

                const newRow = reportResultsTableBody.insertRow();
                newRow.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${fullName}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.idNumber}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.role.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.status.charAt(0).toUpperCase() + user.status.slice(1)}</td>
                    <td class="px-6 py-4 whitespace-normal text-sm text-gray-500 max-w-xs overflow-hidden text-ellipsis">${displayEnrolledCourses}</td>
                    <td class="px-6 py-4 whitespace-normal text-sm text-gray-500 max-w-xs overflow-hidden text-ellipsis">${displayCompletedCourses}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${displayHoursSpent}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.enrollmentDate}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${userEndDate}</td>
                `;
                displayedRowCount++;
            });

            document.getElementById('reportTotalCount').textContent = displayedRowCount;
            document.getElementById('reportShowingCount').textContent = displayedRowCount > 0 ? 1 : 0;
            document.getElementById('reportTotalCountDisplay').textContent = displayedRowCount;

            if (displayedRowCount === 0) {
                reportResultsTableBody.innerHTML = `
                    <tr>
                        <td colspan="9" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No data found matching your criteria.</td>
                    </tr>
                `;
            }

            showMessageModal('Report Generated', `Report for ${displayedRowCount} entries has been generated.`);
        });

        // Messages Section Email Composition Logic
        const emailRecipientSelect = document.getElementById('emailRecipientSelect');
        const emailSubjectInput = document.getElementById('emailSubjectInput');
        const emailBodyTextarea = document.getElementById('emailBodyTextarea');
        const composeEmailForm = document.getElementById('composeEmailForm');

        function populateStudentEmailDropdown() {
            emailRecipientSelect.innerHTML = '<option value="">Select a student</option>'; // Clear existing and add default
            const students = allUsersData.filter(user => user.role === 'student' && user.status === 'active'); // Only active students

            if (students.length === 0) {
                // Optionally display a message if no students are available
                const option = document.createElement('option');
                option.value = "";
                option.textContent = "No active students available";
                option.disabled = true;
                emailRecipientSelect.appendChild(option);
            } else {
                students.forEach(student => {
                    const option = document.createElement('option');
                    option.value = student.email;
                    const fullName = `${student.name}${student.surname ? ' ' + student.surname : ''}`;
                    option.textContent = `${fullName} (${student.email})`;
                    emailRecipientSelect.appendChild(option);
                });
            }
        }

        composeEmailForm.addEventListener('submit', function(e) {
            e.preventDefault();

            const recipientEmail = emailRecipientSelect.value;
            const recipientName = emailRecipientSelect.options[emailRecipientSelect.selectedIndex].textContent;
            const subject = emailSubjectInput.value.trim();
            const messageBody = emailBodyTextarea.value.trim();

            if (!recipientEmail) {
                showMessageModal('Input Error', 'Please select a student recipient.');
                return;
            }
            if (!subject) {
                showMessageModal('Input Error', 'Please enter a subject for the email.');
                return;
            }
            if (!messageBody) {
                showMessageModal('Input Error', 'Please write your message before sending.');
                return;
            }

            const confirmationMessage = `Simulated Email Sent!\n\nTo: ${recipientName}\nSubject: ${subject}\n\nMessage:\n"${messageBody}"\n\nIn a real application, this email would be sent to the student's email address.`;

            showMessageModal('Email Sent', confirmationMessage);
            
            // Clear the form after successful submission
            composeEmailForm.reset();
        });

        // Event delegation for "Assign Students" buttons in the existing programmes table
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('assign-students-btn')) {
                e.stopPropagation(); // Prevent row click event
                const programmeId = parseInt(e.target.dataset.programmeId);
                showAssignStudentsModal(programmeId);
            }
        });

        // --- FIX: ASSIGNMENT FUNCTIONALITY START ---
        let allAssignmentsData = [];
        
        // Add Health & Safety Case Study Assignment for Alice
        allAssignmentsData.push({
            id: Date.now(),
            title: 'Health and Safety Case Study - TechNow Solutions',
            instructions: 'Read the comprehensive case study about a fire incident at TechNow Solutions and complete all 8 questions. This assignment tests your understanding of workplace health and safety principles including hazard identification, risk assessment, and control measures implementation.',
            dueDate: '2026-02-21',
            documentFileName: 'Health-Safety-Case-Study.html',
            documentFileUrl: 'health-safety-assignment.html',
            totalMarks: 100,
            assignedStudentId: 3,
            creatorId: 1,
            status: 'Assigned',
            submissionDate: null,
            creationDate: '2026-01-21'
        });
        
        const createAssignmentModal = document.getElementById('createAssignmentModal');
        const createAssignmentForm = document.getElementById('createAssignmentForm');
        const assignmentDocumentInput = document.getElementById('assignmentDocumentInput');
        const viewAssignmentModal = document.getElementById('viewAssignmentModal');

        // Show the create assignment modal
        function showCreateAssignmentModal() {
            populateStudentAssignmentDropdown();
            createAssignmentForm.reset();
            document.getElementById('assignmentDocFileName').classList.add('hidden');
            createAssignmentModal.classList.remove('hidden');
            createAssignmentModal.classList.add('show');
        }

        // Hide the create assignment modal
        function hideCreateAssignmentModal() {
            createAssignmentModal.classList.remove('show');
            createAssignmentModal.classList.add('hidden');
        }

        // Populate student dropdown in the assignment modal
        function populateStudentAssignmentDropdown() {
            const select = document.getElementById('assignToStudentSelect');
            select.innerHTML = '<option value="">-- Select a Student --</option>';
            const students = allUsersData.filter(u => u.role === 'student' && u.status === 'active');
            
            if (students.length === 0) {
                 select.innerHTML = '<option value="" disabled>No active students available</option>';
            } else {
                students.forEach(student => {
                    const fullName = `${student.name}${student.surname ? ' ' + student.surname : ''}`;
                    select.innerHTML += `<option value="${student.id}">${fullName}</option>`;
                });
            }
        }

        // Listener for the main "Create Assignment" button
        document.getElementById('createAssignmentBtn').addEventListener('click', showCreateAssignmentModal);

        // Show selected document name
        assignmentDocumentInput.addEventListener('change', function() {
            const fileNameDisplay = document.getElementById('assignmentDocFileName');
            if(this.files.length > 0) {
                fileNameDisplay.textContent = `Selected: ${this.files[0].name}`;
                fileNameDisplay.classList.remove('hidden');
            } else {
                fileNameDisplay.classList.add('hidden');
            }
        });

        // Handle the creation of a new assignment
        createAssignmentForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const studentId = parseInt(document.getElementById('assignToStudentSelect').value, 10);
            const title = document.getElementById('assignmentTitleInput').value.trim();
            const instructions = document.getElementById('assignmentInstructionsTextarea').value.trim();
            const dueDate = document.getElementById('assignmentDueDateInput').value;
            const totalMarks = parseInt(document.getElementById('assignmentMarksInput').value, 10);
            const documentFile = assignmentDocumentInput.files[0];

            if (!studentId || !title || !instructions || !totalMarks || !dueDate) {
                showMessageModal('Input Error', 'Please fill all fields: student, title, instructions, due date, and marks.');
                return;
            }

            const newAssignment = {
                id: Date.now(),
                title,
                instructions,
                dueDate,
                documentFileName: documentFile ? documentFile.name : null,
                documentFileUrl: documentFile ? URL.createObjectURL(documentFile) : null,
                totalMarks,
                assignedStudentId: studentId,
                creatorId: loggedInUser.id,
                status: 'Assigned', // Initial status
                submissionDate: null,
                creationDate: new Date().toISOString().slice(0, 10)
            };
            allAssignmentsData.push(newAssignment);
            renderTMAssignmentsTable();
            showMessageModal('Success', `Assignment "${title}" has been created and assigned.`);
            hideCreateAssignmentModal();
        });

        // Render assignments table for Training Manager
        function renderTMAssignmentsTable() {
            const tableBody = document.getElementById('tmAssignmentsTableBody');
            const myAssignments = allAssignmentsData.filter(a => a.creatorId === loggedInUser.id);
            tableBody.innerHTML = '';
            
            if(myAssignments.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="6" class="p-6 text-gray-500 text-sm text-center">No assignments created yet.</td></tr>`;
                return;
            }

            myAssignments.forEach(assignment => {
                const student = allUsersData.find(u => u.id === assignment.assignedStudentId);
                const studentName = student ? `${student.name}${student.surname ? ' ' + student.surname : ''}` : 'Unknown Student';
                
                let statusColor = 'bg-blue-100 text-blue-800';
                if (assignment.status === 'Submitted') statusColor = 'bg-green-100 text-green-800';
                if (assignment.status === 'Graded') statusColor = 'bg-purple-100 text-purple-800';

                const newRow = tableBody.insertRow();
                newRow.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${assignment.title}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${studentName}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${assignment.dueDate}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColor}">${assignment.status}</span></td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${assignment.totalMarks}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <a href="#" class="text-indigo-600 hover:text-indigo-900">View/Grade</a>
                    </td>
                `;
            });
        }

        // Render assignments list for Student
        function renderStudentAssignmentsList() {
            const container = document.getElementById('studentAssignmentsList');
            const myAssignments = allAssignmentsData.filter(a => a.assignedStudentId === loggedInUser.id);
            container.innerHTML = '';

            if (myAssignments.length === 0) {
                container.innerHTML = `<div class="p-6 bg-white rounded-lg shadow text-gray-500 text-sm text-center">You have no assignments.</div>`;
                return;
            }

            myAssignments.forEach(assignment => {
                let statusColor = 'bg-blue-100 text-blue-800';
                if (assignment.status === 'Submitted') statusColor = 'bg-green-100 text-green-800';
                
                const card = document.createElement('div');
                card.className = 'bg-white rounded-lg shadow p-4 flex justify-between items-center';
                card.innerHTML = `
                    <div>
                        <h4 class="font-semibold text-gray-800">${assignment.title}</h4>
                        <p class="text-sm text-gray-500">Due: ${assignment.dueDate}</p>
                    </div>
                    <div class="flex items-center space-x-4">
                         <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColor}">${assignment.status}</span>
                         <button class="view-assignment-btn bg-indigo-600 text-white px-3 py-1 rounded-md text-sm hover:bg-indigo-700" data-assignment-id="${assignment.id}">View</button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Show the student view assignment modal
        function showViewAssignmentModal(assignmentId) {
            const assignment = allAssignmentsData.find(a => a.id === assignmentId);
            if (!assignment) return;
            
            document.getElementById('viewAssignmentTitle').textContent = assignment.title;
            document.getElementById('viewAssignmentDueDate').textContent = assignment.dueDate;
            document.getElementById('viewAssignmentTotalMarks').textContent = assignment.totalMarks;
            document.getElementById('viewAssignmentInstructions').textContent = assignment.instructions;

            const docSection = document.getElementById('viewAssignmentDocumentSection');
            if (assignment.documentFileName) {
                docSection.classList.remove('hidden');
                document.getElementById('viewAssignmentDocName').textContent = assignment.documentFileName;
                document.getElementById('viewAssignmentDownloadLink').href = assignment.documentFileUrl;
            } else {
                docSection.classList.add('hidden');
            }
            
            // Handle submit button state
            const submitBtn = document.getElementById('submitAssignmentBtn');
            submitBtn.dataset.assignmentId = assignmentId; // Store id on button
            if (assignment.status === 'Submitted') {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Submitted';
                submitBtn.classList.replace('bg-green-600', 'bg-gray-400');
                submitBtn.classList.add('cursor-not-allowed');
            } else {
                submitBtn.disabled = false;
                submitBtn.innerHTML = `<i class="fas fa-check-circle mr-2"></i>Mark as Submitted`;
                submitBtn.classList.replace('bg-gray-400', 'bg-green-600');
                submitBtn.classList.remove('cursor-not-allowed');
            }


            viewAssignmentModal.classList.remove('hidden');
            viewAssignmentModal.classList.add('show');
        }

        function hideViewAssignmentModal() {
            viewAssignmentModal.classList.remove('show');
            viewAssignmentModal.classList.add('hidden');
        }
        
        // Event delegation for student's "View" buttons
        document.getElementById('studentAssignmentsList').addEventListener('click', function(e) {
            if(e.target.classList.contains('view-assignment-btn')) {
                const assignmentId = parseInt(e.target.dataset.assignmentId, 10);
                showViewAssignmentModal(assignmentId);
            }
        });

        // Handle student's submission click
        document.getElementById('submitAssignmentBtn').addEventListener('click', function() {
            const assignmentId = parseInt(this.dataset.assignmentId, 10);
            const assignment = allAssignmentsData.find(a => a.id === assignmentId);
            if (assignment) {
                assignment.status = 'Submitted';
                assignment.submissionDate = new Date().toISOString().slice(0, 10);
                showMessageModal('Submitted', `Assignment "${assignment.title}" has been marked as submitted.`);
                hideViewAssignmentModal();
                renderStudentAssignmentsList(); // Refresh the student list to show new status
                renderTMAssignmentsTable(); // Refresh TM list to show new status
            }
        });

        // --- FIX: ASSIGNMENT FUNCTIONALITY END ---

        // --- CERTIFICATE FUNCTIONALITY ---
        let allCertificateTemplatesData = [];

        // Render student certificates table
        function renderStudentCertificatesTable() {
            const tableBody = document.getElementById('studentCertificatesTableBody');
            const studentCerts = allCertificatesData.filter(c => c.studentId === loggedInUser.id);
            
            if (studentCerts.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No certificates earned yet. Complete courses to earn certificates.</td></tr>';
                return;
            }

            tableBody.innerHTML = '';
            studentCerts.forEach(cert => {
                tableBody.innerHTML += `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${cert.id}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${cert.courseName}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${cert.issueDate}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">${cert.status}</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button onclick="showCertificateViewer('${cert.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3">View</button>
                            <button onclick="downloadCertificate()" class="text-blue-600 hover:text-blue-900">Download</button>
                        </td>
                    </tr>
                `;
            });
        }

        // Render admin all certificates table
        function renderAllCertificatesTable() {
            const tableBody = document.getElementById('allCertificatesTableBody');
            
            if (allCertificatesData.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No certificates issued yet.</td></tr>';
                return;
            }

            tableBody.innerHTML = '';
            allCertificatesData.forEach(cert => {
                tableBody.innerHTML += `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${cert.id}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${cert.studentName}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${cert.courseName}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${cert.issueDate}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${cert.certificateType}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">${cert.status}</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button onclick="showCertificateViewer('${cert.id}')" class="text-indigo-600 hover:text-indigo-900">View</button>
                        </td>
                    </tr>
                `;
            });
        }

        // Render certificate templates for training manager
        function renderCertificateTemplatesTable() {
            const tableBody = document.getElementById('certTemplatesTableBody');
            
            if (allCertificateTemplatesData.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No templates created yet. Create a new template above.</td></tr>';
                return;
            }

            tableBody.innerHTML = '';
            allCertificateTemplatesData.forEach(template => {
                const linkedCoursesNames = template.linkedCourseIds.map(id => {
                    const course = allCoursesData.find(c => c.id === id);
                    return course ? course.name : 'Unknown';
                }).join(', ');

                tableBody.innerHTML += `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${template.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${template.description}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${template.colorScheme}</td>
                        <td class="px-6 py-4 text-sm text-gray-600">${linkedCoursesNames || 'No courses linked'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button class="text-blue-600 hover:text-blue-900 mr-2">Edit</button>
                            <button class="text-red-600 hover:text-red-900">Delete</button>
                        </td>
                    </tr>
                `;
            });
        }

        // Handle certificate template creation
        document.getElementById('createCertificateTemplateForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('certTemplateName').value.trim();
            const description = document.getElementById('certTemplateDesc').value.trim();
            const colorScheme = document.getElementById('certTemplateColor').value;
            const linkedCourseIds = Array.from(document.querySelectorAll('.cert-template-course-checkbox:checked'))
                                      .map(cb => parseInt(cb.value));

            if (!name || !description) {
                showMessageModal('Input Error', 'Please fill in template name and description.');
                return;
            }

            const newTemplate = {
                id: Date.now(),
                name,
                description,
                colorScheme,
                linkedCourseIds,
                creatorId: loggedInUser.id,
                creationDate: new Date().toISOString().slice(0, 10)
            };

            allCertificateTemplatesData.push(newTemplate);
            showMessageModal('Success', `Certificate template "${name}" has been created.`);
            this.reset();
            renderCertificateTemplatesTable();
        });

        function resetCertTemplateForm() {
            document.getElementById('createCertificateTemplateForm').reset();
        }

        // Populate courses for certificate template creation
        function populateCertificateTemplateCoursesSelection() {
            const container = document.getElementById('certTemplateCoursesSelection');
            const activeCoursesForTM = allCoursesData.filter(c => c.creatorId === loggedInUser.id);
            
            if (activeCoursesForTM.length === 0) {
                container.innerHTML = '<p id="noCertCourses" class="text-gray-500 text-sm text-center">No courses available. Create courses first.</p>';
                return;
            }

            container.innerHTML = '';
            activeCoursesForTM.forEach(course => {
                const label = document.createElement('label');
                label.className = 'flex items-center py-2 px-2 hover:bg-gray-100 rounded cursor-pointer';
                label.innerHTML = `
                    <input type="checkbox" value="${course.id}" class="cert-template-course-checkbox mr-2">
                    <span class="text-sm text-gray-700">${course.name}</span>
                `;
                container.appendChild(label);
            });
        }

        // Update tables when sections are shown
        document.addEventListener('click', function(e) {
            if (e.target.getAttribute('data-section') === 'my-certificates') {
                renderStudentCertificatesTable();
            } else if (e.target.getAttribute('data-section') === 'certificate-templates') {
                populateCertificateTemplateCoursesSelection();
                renderCertificateTemplatesTable();
            } else if (e.target.getAttribute('data-section') === 'certificates-management') {
                renderAllCertificatesTable();
            }
        });

        /* ================= STUDENT COURSE PROGRESS (UI ENHANCED) ================= */

        const studentCourses = [
          { 
            id: 1, 
            name: "Health & Safety", 
            progress: 40,
            picture: "https://images.unsplash.com/photo-1576091160399-2b6ba8a7f0f0?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=60",
            description: "Learn essential health and safety practices in the workplace",
            sections: [
              {
                id: 101,
                title: "Introduction",
                videoDuration: "12 minutes",
                questions: [
                  {
                    id: 1,
                    type: 'multiple-choice',
                    question: 'What is the primary goal of health and safety?',
                    options: ['Maximize productivity', 'Protect worker wellbeing', 'Reduce costs', 'Increase efficiency'],
                    correctAnswer: 1
                  },
                  {
                    id: 2,
                    type: 'true-false',
                    question: 'Health and safety regulations are optional.',
                    correctAnswer: false
                  }
                ]
              },
              {
                id: 102,
                title: "Chapter 1: Workplace Hazards",
                videoDuration: "18 minutes",
                questions: [
                  {
                    id: 3,
                    type: 'multiple-choice',
                    question: 'Which of these is a common workplace hazard?',
                    options: ['Proper lighting', 'Slippery floors', 'Good ventilation', 'Ergonomic furniture'],
                    correctAnswer: 1
                  },
                  {
                    id: 4,
                    type: 'multiple-choice',
                    question: 'What should you do if you notice a hazard?',
                    options: ['Ignore it', 'Report it immediately', 'Handle it yourself', 'Wait for others to notice'],
                    correctAnswer: 1
                  }
                ]
              },
              {
                id: 103,
                title: "Chapter 2: Safety Procedures",
                videoDuration: "15 minutes",
                questions: [
                  {
                    id: 5,
                    type: 'true-false',
                    question: 'Personal Protective Equipment (PPE) is always required.',
                    correctAnswer: true
                  },
                  {
                    id: 6,
                    type: 'multiple-choice',
                    question: 'What is the first step in an emergency?',
                    options: ['Alert management', 'Ensure everyone is safe', 'Document the incident', 'Continue working'],
                    correctAnswer: 1
                  }
                ]
              }
            ]
          },
          { 
            id: 2, 
            name: "Fire Fighting", 
            progress: 100,
            picture: "https://images.unsplash.com/photo-1559838106-d8493e3e4ffd?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=60",
            description: "Comprehensive fire safety and firefighting procedures",
            sections: [
              {
                id: 201,
                title: "Introduction",
                videoDuration: "10 minutes",
                questions: [
                  {
                    id: 1,
                    type: 'multiple-choice',
                    question: 'What is the primary purpose of fire safety training?',
                    options: ['Save lives and property', 'Pass time', 'Look good', 'Follow rules'],
                    correctAnswer: 0
                  }
                ]
              },
              {
                id: 202,
                title: "Chapter 1: Fire Basics",
                videoDuration: "14 minutes",
                questions: [
                  {
                    id: 2,
                    type: 'true-false',
                    question: 'Fire requires oxygen, fuel, and heat to burn.',
                    correctAnswer: true
                  }
                ]
              }
            ]
          },
          { 
            id: 3, 
            name: "First Aid", 
            progress: 75,
            picture: "https://images.unsplash.com/photo-1576091160550-2173dba999ef?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=60",
            description: "Master essential first aid techniques and emergency response",
            sections: [
              {
                id: 301,
                title: "Introduction",
                videoDuration: "11 minutes",
                questions: [
                  {
                    id: 1,
                    type: 'multiple-choice',
                    question: 'What is first aid?',
                    options: ['Medical treatment', 'Emergency care before professional help', 'Medicine', 'Surgery'],
                    correctAnswer: 1
                  }
                ]
              },
              {
                id: 302,
                title: "Chapter 1: CPR & Recovery Position",
                videoDuration: "20 minutes",
                questions: [
                  {
                    id: 2,
                    type: 'true-false',
                    question: 'CPR should be performed on all unconscious people.',
                    correctAnswer: false
                  }
                ]
              },
              {
                id: 303,
                title: "Chapter 2: Wound Care",
                videoDuration: "16 minutes",
                questions: [
                  {
                    id: 3,
                    type: 'multiple-choice',
                    question: 'What is the first step in treating a wound?',
                    options: ['Apply bandage', 'Stop the bleeding', 'Disinfect', 'Call emergency'],
                    correctAnswer: 1
                  }
                ]
              }
            ]
          },
          { 
            id: 4, 
            name: "Advanced Excel Skills", 
            progress: 0,
            picture: "https://images.unsplash.com/photo-1633356122544-f134324ef6db?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=60",
            description: "Learn advanced Excel techniques for data analysis",
            type: 'pdf',
            pdfUrl: 'https://www.w3.org/WAI/WCAG21/Techniques/pdf/pdf20.pdf',
            description: 'Master advanced Excel techniques for data analysis and reporting',
            isRead: false,
            sections: []
          }
];

function showStudentCourses(type) {
  const container = document.getElementById("studentCoursesList");
  const tabInProgress = document.getElementById("tabInProgress");
  const tabCompleted = document.getElementById("tabCompleted");

  if (!container) return;

  // Tab styling
  if (type === "completed") {
    tabCompleted.className = "px-5 py-2 rounded-md text-sm font-medium bg-green-600 text-white transition";
    tabInProgress.className = "px-5 py-2 rounded-md text-sm font-medium text-gray-600 hover:text-gray-800 transition";
  } else {
    tabInProgress.className = "px-5 py-2 rounded-md text-sm font-medium bg-indigo-600 text-white transition";
    tabCompleted.className = "px-5 py-2 rounded-md text-sm font-medium text-gray-600 hover:text-gray-800 transition";
  }

  container.innerHTML = "";

  const filtered = studentCourses.filter(course => {
    if (course.type === 'pdf') {
      // For PDF courses, use isRead status
      return type === "completed" ? course.isRead : !course.isRead;
    } else {
      // For video courses, use progress
      return type === "completed" ? course.progress === 100 : course.progress < 100;
    }
  });

  if (filtered.length === 0) {
    container.innerHTML = `
      <p class="text-gray-500 text-sm col-span-full">
        No courses found in this section.
      </p>`;
    return;
  }

  filtered.forEach(course => {
    const courseImage = course.picture || "https://placehold.co/400x200/E0E7FF/4F46E5?text=Course+Image";
    const statusBadge = course.type === 'pdf' 
      ? (course.isRead ? "Completed" : "Not Read")
      : (course.progress === 100 ? "Completed" : "In Progress");
    
    const badgeClass = course.type === 'pdf' 
      ? (course.isRead ? "bg-green-100 text-green-700" : "bg-yellow-100 text-yellow-700")
      : (course.progress === 100 ? "bg-green-100 text-green-700" : "bg-indigo-100 text-indigo-700");
    
    let courseCard = `
      <div class="bg-white rounded-xl shadow hover:shadow-lg transition overflow-hidden">
        <div class="relative w-full h-40 overflow-hidden bg-gray-200">
          <img src="${courseImage}" alt="${course.name}" class="w-full h-full object-cover hover:scale-105 transition-transform duration-300">
          <span class="absolute top-3 right-3 text-xs px-3 py-1 rounded-full font-medium ${badgeClass}">
            ${statusBadge}
          </span>
        </div>
        <div class="p-5">
          <h3 class="font-semibold text-gray-800 mb-2">${course.name}</h3>
          <p class="text-sm text-gray-600 mb-3">${course.description || "No description available"}</p>
          ${course.type === 'pdf' 
            ? `<p class="text-xs text-gray-500 mb-3"><i class="fas fa-file-pdf mr-1 text-red-500"></i>PDF Document</p>` 
            : `<div class="w-full bg-gray-200 rounded-full h-2 mb-3">
                <div class="${course.progress === 100 ? "bg-green-500" : "bg-indigo-600"} h-2 rounded-full" style="width: ${course.progress}%"></div>
              </div>
              <p class="text-sm text-gray-600 mb-3">Progress: <span class="font-medium">${course.progress}%</span></p>`
          }
          ${course.type === 'pdf'
            ? `<div class="flex gap-2">
                <button onclick="viewPDFCourse(${course.id}, '${course.name}')" class="flex-1 text-sm bg-indigo-600 text-white py-2 rounded-md hover:bg-indigo-700 transition">
                  <i class="fas fa-eye mr-1"></i> Open PDF
                </button>
                <button onclick="markPDFAsRead(${course.id})" class="flex-1 text-sm ${course.isRead ? 'bg-green-600 hover:bg-green-700' : 'bg-gray-400 hover:bg-gray-500'} text-white py-2 rounded-md transition">
                  <i class="fas ${course.isRead ? 'fa-check' : 'fa-times'} mr-1"></i> ${course.isRead ? 'Read' : 'Mark Read'}
                </button>
              </div>`
            : `<button onclick="viewStudentCourse(${course.id}, '${course.name}')" class="w-full text-sm bg-indigo-600 text-white py-2 rounded-md hover:bg-indigo-700 transition">
                View course
              </button>`
          }
        </div>
      </div>
    `;
    container.innerHTML += courseCard;
  });
}

// Function to view student course with sections, video and questions
function viewStudentCourse(courseId, courseName) {
    const course = studentCourses.find(c => c.id === courseId);
    if (!course || !course.sections || course.sections.length === 0) return;

    document.getElementById('courseViewerTitle').textContent = course.name;
    document.getElementById('courseViewerDescription').textContent = 'Learn about ' + course.name + '. This course covers essential concepts and practical skills.';
    document.getElementById('courseViewerCourseId').textContent = 'COURSE-' + courseId;
    document.getElementById('courseViewerProgress').textContent = course.progress;

    // Create section tabs
    loadSectionTabs(course);

}

// Function to view PDF course
function viewPDFCourse(courseId, courseName) {
    const course = studentCourses.find(c => c.id === courseId);
    if (!course || course.type !== 'pdf') return;
    
    // Create a modal to view the PDF
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
    modal.innerHTML = `
        <div class="bg-white rounded-lg shadow-lg max-w-4xl w-full max-h-screen overflow-hidden flex flex-col">
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h2 class="text-2xl font-bold text-gray-800">${course.name}</h2>
                <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
            </div>
            <div class="flex-1 overflow-hidden">
                <iframe src="${course.pdfUrl}" class="w-full h-full" style="min-height: 500px;"></iframe>
            </div>
            <div class="p-6 border-t border-gray-200 flex justify-between items-center bg-gray-50">
                <p class="text-sm text-gray-600"><i class="fas fa-file-pdf mr-2 text-red-500"></i>PDF Document</p>
                <button onclick="markPDFAsRead(${courseId}); this.closest('.fixed').remove();" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition">
                    <i class="fas fa-check mr-2"></i>Mark as Read & Close
                </button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

// Function to mark PDF course as read
function markPDFAsRead(courseId) {
    const course = studentCourses.find(c => c.id === courseId);
    if (!course || course.type !== 'pdf') return;
    
    course.isRead = !course.isRead;
    showStudentCourses('inprogress');
    showMessageModal('Success', course.isRead ? `"${course.name}" marked as read!` : `"${course.name}" marked as unread!`);
}

// Function to view student course with sections, video and questions
function viewStudentCourse(courseId, courseName) {
    const course = studentCourses.find(c => c.id === courseId);
    if (!course || !course.sections || course.sections.length === 0) return;

    document.getElementById('courseViewerTitle').textContent = course.name;
    document.getElementById('courseViewerDescription').textContent = 'Learn about ' + course.name + '. This course covers essential concepts and practical skills.';
    document.getElementById('courseViewerCourseId').textContent = 'COURSE-' + courseId;
    document.getElementById('courseViewerProgress').textContent = course.progress;

    // Create section tabs
    loadSectionTabs(course);

    // Load first section by default
    loadSection(course.sections[0].id, courseId);

    // Show the modal
    document.getElementById('courseViewerModal').classList.remove('hidden');
    document.getElementById('courseViewerModal').classList.add('show');

    // Store current course for later use
    window.currentCourse = course;
}

// Function to create section tabs
function loadSectionTabs(course) {
    const tabsContainer = document.getElementById('sectionTabsContainer');
    tabsContainer.innerHTML = '';

    course.sections.forEach((section, index) => {
        const tab = document.createElement('button');
        tab.className = `px-4 py-2 rounded-md text-sm font-medium transition ${
            index === 0 
            ? 'bg-indigo-600 text-white' 
            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
        }`;
        tab.textContent = section.title;
        tab.onclick = () => loadSection(section.id, course.id);
        
        // Update active tab styling on click
        tab.addEventListener('click', function() {
            document.querySelectorAll('#sectionTabsContainer button').forEach(btn => {
                btn.className = 'px-4 py-2 rounded-md text-sm font-medium transition bg-gray-100 text-gray-700 hover:bg-gray-200';
            });
            this.className = 'px-4 py-2 rounded-md text-sm font-medium transition bg-indigo-600 text-white';
        });

        tabsContainer.appendChild(tab);
    });
}

// Function to load a specific section
function loadSection(sectionId, courseId) {
    const course = studentCourses.find(c => c.id === courseId);
    if (!course) return;

    const section = course.sections.find(s => s.id === sectionId);
    if (!section) return;

    // Update section title
    document.getElementById('sectionTitle').textContent = section.title;

    // Update video duration
    document.getElementById('courseVideoDuration').textContent = section.videoDuration;

    // Load section questions
    loadSectionQuestions(section.questions);

    // Store current section for submission
    window.currentSection = section;
}

// Function to load and display section questions
function loadSectionQuestions(questions) {
    const questionsContainer = document.getElementById('courseQuestionsContainer');
    questionsContainer.innerHTML = '';

    if (!questions || questions.length === 0) {
        questionsContainer.innerHTML = '<p class="text-gray-500 text-center py-8">No questions for this section.</p>';
        return;
    }

    questions.forEach((q, index) => {
        let questionHtml = '';

        if (q.type === 'multiple-choice') {
            questionHtml = `
                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <div class="flex items-start mb-3">
                        <span class="inline-flex items-center justify-center h-8 w-8 rounded-full bg-indigo-600 text-white text-sm font-medium mr-3">
                            ${index + 1}
                        </span>
                        <h4 class="text-lg font-semibold text-gray-800">${q.question}</h4>
                    </div>
                    <div class="space-y-2 ml-11">
                        ${q.options.map((option, optIndex) => `
                            <label class="flex items-center p-2 rounded hover:bg-gray-100 cursor-pointer">
                                <input type="radio" name="question-${q.id}" value="${optIndex}" class="w-4 h-4 text-indigo-600">
                                <span class="ml-3 text-gray-700">${option}</span>
                            </label>
                        `).join('')}
                    </div>
                </div>
            `;
        } else if (q.type === 'true-false') {
            questionHtml = `
                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <div class="flex items-start mb-3">
                        <span class="inline-flex items-center justify-center h-8 w-8 rounded-full bg-indigo-600 text-white text-sm font-medium mr-3">
                            ${index + 1}
                        </span>
                        <h4 class="text-lg font-semibold text-gray-800">${q.question}</h4>
                    </div>
                    <div class="space-y-2 ml-11">
                        <label class="flex items-center p-2 rounded hover:bg-gray-100 cursor-pointer">
                            <input type="radio" name="question-${q.id}" value="true" class="w-4 h-4 text-indigo-600">
                            <span class="ml-3 text-gray-700">True</span>
                        </label>
                        <label class="flex items-center p-2 rounded hover:bg-gray-100 cursor-pointer">
                            <input type="radio" name="question-${q.id}" value="false" class="w-4 h-4 text-indigo-600">
                            <span class="ml-3 text-gray-700">False</span>
                        </label>
                    </div>
                </div>
            `;
        }

        questionsContainer.innerHTML += questionHtml;
    });

    // Store questions for submission
    window.currentSectionQuestions = questions;
}

// Function to close course viewer
function closeCourseViewer() {
    document.getElementById('courseViewerModal').classList.add('hidden');
    document.getElementById('courseViewerModal').classList.remove('show');
}

// Handle course answer submission
document.addEventListener('DOMContentLoaded', function() {
    const submitBtn = document.getElementById('submitCourseAnswersBtn');
    if (submitBtn) {
        submitBtn.addEventListener('click', function() {
            if (!window.currentSectionQuestions || window.currentSectionQuestions.length === 0) {
                showMessageModal('No Questions', 'This section has no questions to answer.');
                return;
            }

            let score = 0;
            let totalQuestions = window.currentSectionQuestions.length;
            let allAnswered = true;

            window.currentSectionQuestions.forEach(q => {
                const selected = document.querySelector(`input[name="question-${q.id}"]:checked`);
                if (!selected) {
                    allAnswered = false;
                    return;
                }

                let userAnswer = selected.value;
                if (q.type === 'true-false') {
                    userAnswer = userAnswer === 'true';
                } else {
                    userAnswer = parseInt(userAnswer);
                }

                if (userAnswer === q.correctAnswer) {
                    score++;
                }
            });

            if (!allAnswered) {
                showMessageModal('Incomplete', 'Please answer all questions before submitting.');
                return;
            }

            const percentage = Math.round((score / totalQuestions) * 100);
            const sectionTitle = window.currentSection ? window.currentSection.title : 'Section';
            showMessageModal('Section Complete', `You scored ${score}/${totalQuestions} (${percentage}%) on ${sectionTitle}. Great job!`);
        });
    }
});

/* Default load */
document.addEventListener("DOMContentLoaded", () => {
  showStudentCourses("inprogress");
});

        // --- CERTIFICATE FEATURE ---
        let allCertificatesData = [
            // Certificates for completed courses
            {
                id: 'CERT-001',
                studentId: 4,
                studentName: 'Bob',
                courseId: 101,
                courseName: 'Introduction to Web Development',
                issueDate: '2023-05-15',
                certificateType: 'Course Completion',
                status: 'Active'
            },
            {
                id: 'CERT-002',
                studentId: 3,
                studentName: 'Alice',
                courseId: 102,
                courseName: 'Data Science Fundamentals',
                issueDate: '2023-06-20',
                certificateType: 'Course Completion',
                status: 'Active'
            }
        ];

        // Function to issue certificate to student
        function issueCertificateToStudent(studentId, courseId, courseName) {
            const student = allUsersData.find(u => u.id === studentId);
            if (!student) return;

            const certificateId = 'CERT-' + Date.now();
            const certificate = {
                id: certificateId,
                studentId: studentId,
                studentName: student.name + (student.surname ? ' ' + student.surname : ''),
                courseId: courseId,
                courseName: courseName,
                issueDate: new Date().toISOString().slice(0, 10),
                certificateType: 'Course Completion',
                status: 'Active'
            };
            allCertificatesData.push(certificate);
            showMessageModal('Success', `Certificate issued to ${student.name} for completing ${courseName}.`);
        }

        // Function to show certificate viewer
        function showCertificateViewer(certificateId) {
            const cert = allCertificatesData.find(c => c.id === certificateId);
            if (!cert) {
                showMessageModal('Error', 'Certificate not found.');
                return;
            }

            document.getElementById('certificateName').textContent = 'Certificate of Achievement';
            document.getElementById('certificateStudentName').textContent = cert.studentName;
            document.getElementById('certificateCourseName').textContent = cert.courseName;
            document.getElementById('certificateDate').textContent = cert.issueDate;
            document.getElementById('certificateId').textContent = cert.id;

            document.getElementById('certificateViewerModal').classList.remove('hidden');
            document.getElementById('certificateViewerModal').classList.add('show');
        }

        // Close certificate viewer
        function closeCertificateViewer() {
            document.getElementById('certificateViewerModal').classList.add('hidden');
            document.getElementById('certificateViewerModal').classList.remove('show');
        }

        // Download certificate as image
        function downloadCertificate() {
            // Get certificate details
            const studentName = document.getElementById('certificateStudentName').textContent;
            const courseName = document.getElementById('certificateCourseName').textContent;
            const date = document.getElementById('certificateDate').textContent;
            const certId = document.getElementById('certificateId').textContent;

            // Create canvas for the certificate design
            const canvas = document.createElement('canvas');
            canvas.width = 1200;
            canvas.height = 800;
            const ctx = canvas.getContext('2d');

            // Background gradient
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#fef3c7');
            gradient.addColorStop(1, '#fef08a');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Border
            ctx.strokeStyle = '#b45309';
            ctx.lineWidth = 8;
            ctx.strokeRect(20, 20, canvas.width - 40, canvas.height - 40);

            // Text settings
            ctx.fillStyle = '#78350f';
            ctx.textAlign = 'center';

            // Title
            ctx.font = 'bold 72px Arial';
            ctx.fillText('Certificate of Achievement', canvas.width / 2, 150);

            // Subtitle
            ctx.font = '24px Arial';
            ctx.fillStyle = '#666';
            ctx.fillText('This certifies that', canvas.width / 2, 250);

            // Student name
            ctx.font = 'bold 48px Arial';
            ctx.fillStyle = '#333';
            ctx.fillText(studentName, canvas.width / 2, 350);

            // Completion text
            ctx.font = '24px Arial';
            ctx.fillStyle = '#666';
            ctx.fillText('has successfully completed', canvas.width / 2, 430);

            // Course name
            ctx.font = 'bold 32px Arial';
            ctx.fillStyle = '#333';
            ctx.fillText(courseName, canvas.width / 2, 510);

            // Date
            ctx.font = '18px Arial';
            ctx.fillStyle = '#666';
            ctx.fillText('Date: ' + date, canvas.width / 2, 600);

            // Certificate ID
            ctx.font = '14px Arial';
            ctx.fillStyle = '#999';
            ctx.fillText('Certificate ID: ' + certId, canvas.width / 2, 700);

            // Convert canvas to image
            const imgData = canvas.toDataURL('image/png');

            // Create PDF using jsPDF
            const { jsPDF } = window;
            const pdf = new jsPDF({
                orientation: 'landscape',
                unit: 'px',
                format: [1200, 800]
            });

            // Add image to PDF
            pdf.addImage(imgData, 'PNG', 0, 0, 1200, 800);

            // Download PDF
            pdf.save(`certificate-${certId}.pdf`);
        }

        // --- BADGES FEATURE ---
        let allBadgesData = [
            {
                id: 1,
                name: 'Quick Learner',
                hoursRequired: 5,
                description: 'Completed 5 hours of learning',
                icon: 'üöÄ',
                creatorId: 1,
                createdDate: '2024-01-01',
                timesEarned: 0
            },
            {
                id: 2,
                name: 'Dedicated Scholar',
                hoursRequired: 25,
                description: 'Completed 25 hours of learning',
                icon: 'üìö',
                creatorId: 1,
                createdDate: '2024-01-01',
                timesEarned: 0
            },
            {
                id: 3,
                name: 'Learning Champion',
                hoursRequired: 50,
                description: 'Completed 50 hours of learning',
                icon: 'üèÜ',
                creatorId: 1,
                createdDate: '2024-01-01',
                timesEarned: 0
            }
        ];
        let studentBadgesData = [
            { studentId: 3, badgeId: 1, earnedDate: '2024-01-15' },
            { studentId: 3, badgeId: 2, earnedDate: '2024-02-20' },
            { studentId: 4, badgeId: 1, earnedDate: '2024-02-10' }
        ];

        // Function to create a new badge
        function createNewBadge(name, hoursRequired, description, icon) {
            const badge = {
                id: Date.now(),
                name: name,
                hoursRequired: hoursRequired,
                description: description,
                icon: icon,
                creatorId: loggedInUser.id,
                createdDate: new Date().toISOString().slice(0, 10),
                timesEarned: 0
            };
            allBadgesData.push(badge);
            return badge;
        }

        // Function to award badge to student based on hours spent
        function awardBadgeToStudent(studentId, badgeId) {
            const badge = allBadgesData.find(b => b.id === badgeId);
            if (!badge) return false;

            // Check if student already has this badge
            const alreadyHasBadge = studentBadgesData.some(sb => sb.studentId === studentId && sb.badgeId === badgeId);
            if (alreadyHasBadge) return false;

            const earnedBadge = {
                studentId: studentId,
                badgeId: badgeId,
                earnedDate: new Date().toISOString().slice(0, 10)
            };
            studentBadgesData.push(earnedBadge);
            badge.timesEarned++;
            return true;
        }

        // Function to check and award badges to a student based on hours spent
        function checkAndAwardBadges(studentId) {
            const student = allUsersData.find(u => u.id === studentId);
            if (!student) return;

            const totalHours = student.totalHoursSpent || 0;

            allBadgesData.forEach(badge => {
                // Check if student's hours meet the badge requirement
                if (totalHours >= badge.hoursRequired) {
                    const earned = awardBadgeToStudent(studentId, badge.id);
                    if (earned) {
                        showMessageModal('Badge Earned!', `Congratulations! You earned the "${badge.name}" badge for reaching ${badge.hoursRequired} learning hours!`);
                    }
                }
            });
        }

        // Function to get student badges
        function getStudentBadges(studentId) {
            return studentBadgesData
                .filter(sb => sb.studentId === studentId)
                .map(sb => {
                    const badge = allBadgesData.find(b => b.id === sb.badgeId);
                    return {
                        ...badge,
                        earnedDate: sb.earnedDate
                    };
                });
        }

        // Function to render student badges grid
        function renderStudentBadgesGrid() {
            const container = document.getElementById('studentBadgesContainer');
            if (!container) return;

            const badges = getStudentBadges(loggedInUser.id);
            const student = allUsersData.find(u => u.id === loggedInUser.id);
            
            document.getElementById('studentTotalHours').textContent = student ? (student.totalHoursSpent || 0) : 0;
            document.getElementById('studentBadgesCount').textContent = badges.length;

            if (badges.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <p class="text-gray-500 text-lg">No badges earned yet. Keep learning!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = '';
            badges.forEach(badge => {
                const badgeHtml = `
                    <div class="bg-white rounded-lg shadow p-6 text-center hover:shadow-lg transition cursor-pointer" onclick="showBadgeDetails('${badge.id}', '${badge.name}', '${badge.description}', '${badge.icon}', '${badge.hoursRequired}', '${badge.earnedDate}')">
                        <div class="text-6xl mb-3">${badge.icon}</div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">${badge.name}</h3>
                        <p class="text-sm text-gray-600 mb-3">${badge.description}</p>
                        <div class="text-xs text-gray-500 bg-green-50 p-2 rounded">
                            Earned: ${badge.earnedDate}
                        </div>
                    </div>
                `;
                container.innerHTML += badgeHtml;
            });
        }

        // Function to show badge details
        function showBadgeDetails(badgeId, name, description, icon, hoursRequired, earnedDate) {
            document.getElementById('badgeViewerIcon').textContent = icon;
            document.getElementById('badgeViewerName').textContent = name;
            document.getElementById('badgeViewerDescription').textContent = description;
            document.getElementById('badgeViewerRequirement').textContent = `Complete ${hoursRequired} hours of learning`;
            document.getElementById('badgeEarnedDate').textContent = earnedDate;
            document.getElementById('badgeViewerModal').classList.remove('hidden');
            document.getElementById('badgeViewerModal').classList.add('show');
        }

        // Function to close badge viewer
        function closeBadgeViewer() {
            document.getElementById('badgeViewerModal').classList.add('hidden');
            document.getElementById('badgeViewerModal').classList.remove('show');
        }

        // Function to render created badges table (for training managers)
        function renderCreatedBadgesTable() {
            const tableBody = document.getElementById('createdBadgesTableBody');
            const myBadges = allBadgesData.filter(b => b.creatorId === loggedInUser.id);
            tableBody.innerHTML = '';

            if (myBadges.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No badges created yet.</td>
                    </tr>
                `;
                return;
            }

            myBadges.forEach(badge => {
                const row = `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-center text-2xl">${badge.icon}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${badge.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${badge.hoursRequired} hours</td>
                        <td class="px-6 py-4 text-sm text-gray-700">${badge.description.substring(0, 50)}...</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${badge.timesEarned}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button onclick="editBadge('${badge.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3">Edit</button>
                            <button onclick="deleteBadge('${badge.id}')" class="text-red-600 hover:text-red-900">Delete</button>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        // Function to render all badges table (for admin)
        function renderAllBadgesTable() {
            const tableBody = document.getElementById('allBadgesTableBody');
            tableBody.innerHTML = '';

            if (allBadgesData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">No badges in system yet.</td>
                    </tr>
                `;
                return;
            }

            allBadgesData.forEach(badge => {
                const creator = allUsersData.find(u => u.id === badge.creatorId);
                const creatorName = creator ? creator.name : 'Unknown';
                const row = `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-center text-2xl">${badge.icon}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${badge.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${badge.hoursRequired} hours</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${creatorName}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${badge.timesEarned}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button onclick="viewBadgeDetails('${badge.id}')" class="text-indigo-600 hover:text-indigo-900">View</button>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });

            // Update admin stats
            const uniqueStudentsWithBadges = new Set(studentBadgesData.map(sb => sb.studentId)).size;
            document.getElementById('totalBadgesCount').textContent = allBadgesData.length;
            document.getElementById('totalEarnedCount').textContent = studentBadgesData.length;
            document.getElementById('studentsWithBadgesCount').textContent = uniqueStudentsWithBadges;
        }

        // Function to delete badge
        function deleteBadge(badgeId) {
            if (!confirm('Are you sure you want to delete this badge?')) return;
            allBadgesData = allBadgesData.filter(b => b.id !== badgeId);
            renderCreatedBadgesTable();
            showMessageModal('Deleted', 'Badge has been deleted.');
        }

        // Function to edit badge
        function editBadge(badgeId) {
            showMessageModal('Edit Badge', 'Edit functionality coming soon.');
        }

        // Form submission for creating badge
        const createBadgeForm = document.getElementById('createBadgeForm');
        if (createBadgeForm) {
            createBadgeForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const name = document.getElementById('badgeName').value.trim();
                const hoursRequired = parseInt(document.getElementById('badgeHoursRequired').value, 10);
                const description = document.getElementById('badgeDescription').value.trim();
                const icon = document.getElementById('badgeIcon').value.trim();

                if (!name || !hoursRequired || !description || !icon) {
                    showMessageModal('Input Error', 'Please fill all fields.');
                    return;
                }

                createNewBadge(name, hoursRequired, description, icon);
                showMessageModal('Success', `Badge "${name}" has been created!`);
                renderCreatedBadgesTable();
                this.reset();
            });
        }

        // Reset badge form
        function resetBadgeForm() {
            document.getElementById('createBadgeForm').reset();
        }

        // Event listeners for badges sections
        document.addEventListener('click', function(e) {
            if (e.target.getAttribute('data-section') === 'my-badges') {
                renderStudentBadgesGrid();
            } else if (e.target.getAttribute('data-section') === 'badges-created') {
                renderCreatedBadgesTable();
            } else if (e.target.getAttribute('data-section') === 'badges-management') {
                renderAllBadgesTable();
            }
        });

        // Course Search Functionality
        const courseSearchInput = document.getElementById('courseSearchInput');
        if (courseSearchInput) {
            courseSearchInput.addEventListener('keyup', function() {
                const searchTerm = this.value.toLowerCase();
                const tableRows = document.querySelectorAll('#allExistingCoursesTableBody tr');
                
                tableRows.forEach(row => {
                    const courseName = row.querySelector('td:nth-child(2)')?.textContent.toLowerCase() || '';
                    const description = row.querySelector('td:nth-child(3)')?.textContent.toLowerCase() || '';
                    const creator = row.querySelector('td:nth-child(7)')?.textContent.toLowerCase() || '';
                    
                    if (courseName.includes(searchTerm) || description.includes(searchTerm) || creator.includes(searchTerm)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            });
        }

        // ====================================================
        // SIDEBAR NAVIGATION
        // ====================================================

        document.querySelectorAll('.sidebar-item').forEach(item => {
            item.addEventListener('click', function(e) {
                if (this.id === 'logoutBtn') return;
                
                e.preventDefault();
                
                // Update active state
                document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
                this.classList.add('active');

                // Show content section
                const section = this.dataset.section;
                document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                const content = document.getElementById(section + 'Content');
                if (content) {
                    content.classList.add('active');
                    document.getElementById('pageTitle').textContent = this.querySelector('.sidebar-text').textContent;
                }
            });
        });

        // ====================================================
        // MODAL HELPERS
        // ====================================================

        function showAddUserModal() {
            document.getElementById('addUserModal').classList.remove('hidden');
            document.getElementById('addUserModal').classList.add('show');
        }

        function hideAddUserModal() {
            document.getElementById('addUserModal').classList.add('hidden');
            document.getElementById('addUserModal').classList.remove('show');
        }

        function showLoginModal() {
            document.getElementById('loginModal').classList.remove('hidden');
            document.getElementById('loginModal').classList.add('show');
        }

        function hideLoginModal() {
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('loginModal').classList.remove('show');
        }

        function showMessageModal(title, message) {
            document.getElementById('messageModalTitle').textContent = title;
            document.getElementById('messageModalContent').textContent = message;
            document.getElementById('messageModal').classList.remove('hidden');
            document.getElementById('messageModal').classList.add('show');
        }

        function hideMessageModal() {
            document.getElementById('messageModal').classList.add('hidden');
            document.getElementById('messageModal').classList.remove('show');
        }

        function showCreateAssignmentModal() {
            loadStudentsInAssignmentForm();
            document.getElementById('createAssignmentModal').classList.remove('hidden');
            document.getElementById('createAssignmentModal').classList.add('show');
        }

        function hideCreateAssignmentModal() {
            document.getElementById('createAssignmentModal').classList.add('hidden');
            document.getElementById('createAssignmentModal').classList.remove('show');
        }

        function closeCertificateViewer() {
            document.getElementById('certificateViewerModal').classList.add('hidden');
        }

        function closeBadgeViewer() {
            document.getElementById('badgeViewerModal').classList.add('hidden');
        }

        function closeCourseViewer() {
            document.getElementById('courseViewerModal').classList.add('hidden');
        }

        function showAssignStudentsModal() {
            document.getElementById('assignStudentsModal').classList.remove('hidden');
            document.getElementById('assignStudentsModal').classList.add('show');
        }

        function hideAssignStudentsModal() {
            document.getElementById('assignStudentsModal').classList.add('hidden');
            document.getElementById('assignStudentsModal').classList.remove('show');
        }

        function showPdfViewerModal() {
            document.getElementById('pdfViewerModal').classList.remove('hidden');
            document.getElementById('pdfViewerModal').classList.add('show');
        }

        function hidePdfViewerModal() {
            document.getElementById('pdfViewerModal').classList.add('hidden');
            document.getElementById('pdfViewerModal').classList.remove('show');
        }

        function showViewAssignmentModal() {
            document.getElementById('viewAssignmentModal').classList.remove('hidden');
            document.getElementById('viewAssignmentModal').classList.add('show');
        }

        function hideViewAssignmentModal() {
            document.getElementById('viewAssignmentModal').classList.add('hidden');
            document.getElementById('viewAssignmentModal').classList.remove('show');
        }

        function toggleDropdown(button) {
            const dropdown = button.nextElementSibling;
            if (!dropdown) return;
            
            document.querySelectorAll('.dropdown-menu').forEach(d => {
                if (d !== dropdown) d.classList.add('hidden');
            });
            dropdown.classList.toggle('hidden');
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.dropdown')) {
                document.querySelectorAll('.dropdown-menu').forEach(d => d.classList.add('hidden'));
            }
        });

        // ====================================================
        // ADDITIONAL MODAL FUNCTIONS
        // ====================================================

        function showBulkUploadModal() {
            document.getElementById('bulkUploadModal').classList.remove('hidden');
        }

        function hideBulkUploadModal() {
            document.getElementById('bulkUploadModal').classList.add('hidden');
        }

        function editUser(userId) {
            showMessageModal('Edit User', `Edit functionality - Coming soon!`);
        }

        function downloadCertificate() {
            showMessageModal('Certificate Downloaded', 'Your certificate has been downloaded successfully!');
        }

        function resetProgrammeForm() {
            document.getElementById('createProgrammeForm').reset();
            document.getElementById('programmePicturePreview').src = 'https://placehold.co/128x128/ADD8E6/00008B?text=Programme+Image';
        }

        // ====================================================
        // CALENDAR FUNCTIONALITY FOR STUDENTS
        // ====================================================

        let currentCalendarDate = new Date();
        let calendarEvents = [
            { date: new Date(2026, 0, 25), title: 'JavaScript Assignment Due', type: 'assignment', color: 'blue' },
            { date: new Date(2026, 0, 28), title: 'Web Development Test', type: 'test', color: 'orange' },
            { date: new Date(2026, 1, 5), title: 'Mid-term Exam', type: 'exam', color: 'red' },
            { date: new Date(2026, 1, 10), title: 'React Project Due', type: 'assignment', color: 'blue' },
            { date: new Date(2026, 1, 15), title: 'CSS Quiz', type: 'test', color: 'orange' },
            { date: new Date(2026, 1, 22), title: 'Final Exam', type: 'exam', color: 'red' },
        ];

        function getEventTypeColor(type) {
            const colors = {
                'assignment': 'bg-blue-100 text-blue-800 border-blue-300',
                'test': 'bg-orange-100 text-orange-800 border-orange-300',
                'exam': 'bg-red-100 text-red-800 border-red-300'
            };
            return colors[type] || 'bg-gray-100 text-gray-800 border-gray-300';
        }

        function getEventTypeIcon(type) {
            const icons = {
                'assignment': 'üìù',
                'test': '‚úèÔ∏è',
                'exam': 'üìö'
            };
            return icons[type] || 'üìå';
        }

        function renderCalendar() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            // Set month/year display
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('calendarMonthYear').textContent = monthNames[month] + ' ' + year;
            
            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrevMonth = new Date(year, month, 0).getDate();
            
            let calendarDaysHTML = '';
            
            // Previous month's days
            for (let i = firstDay - 1; i >= 0; i--) {
                calendarDaysHTML += `<div class="p-2 text-center text-gray-400 bg-gray-50 rounded">${daysInPrevMonth - i}</div>`;
            }
            
            // Current month's days
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const hasEvent = calendarEvents.some(e => 
                    e.date.getDate() === day && 
                    e.date.getMonth() === month && 
                    e.date.getFullYear() === year
                );
                const isToday = date.toDateString() === new Date().toDateString();
                
                let dayHTML = `<div class="p-2 text-center rounded border-2 cursor-pointer hover:bg-indigo-50 transition`;
                dayHTML += isToday ? ' bg-indigo-100 border-indigo-500' : hasEvent ? ' bg-blue-50 border-blue-300' : ' border-gray-200';
                dayHTML += `" onclick="selectCalendarDate(new Date(${year}, ${month}, ${day}))">${day}`;
                if (hasEvent) {
                    dayHTML += '<span class="block text-xs text-blue-600 font-semibold mt-1">‚óè</span>';
                }
                dayHTML += '</div>';
                calendarDaysHTML += dayHTML;
            }
            
            // Next month's days
            const totalCells = calendarDaysHTML.match(/<div/g).length;
            for (let day = 1; day <= (42 - totalCells - firstDay); day++) {
                calendarDaysHTML += `<div class="p-2 text-center text-gray-400 bg-gray-50 rounded">${day}</div>`;
            }
            
            document.getElementById('calendarDays').innerHTML = calendarDaysHTML;
            
            // Populate upcoming events
            updateUpcomingEvents();
            updateAllEventsList();
        }

        function updateUpcomingEvents() {
            const today = new Date();
            const upcoming = calendarEvents
                .filter(e => e.date >= today)
                .sort((a, b) => a.date - b.date)
                .slice(0, 5);
            
            let html = '';
            if (upcoming.length === 0) {
                html = '<p class="text-gray-500 text-sm">No upcoming events</p>';
            } else {
                upcoming.forEach(event => {
                    const dateStr = event.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    html += `
                        <div class="p-3 rounded border-l-4 ${getEventTypeColor(event.type)} border-l-4">
                            <p class="text-xs font-medium text-gray-600">${dateStr}</p>
                            <p class="font-semibold text-sm">${getEventTypeIcon(event.type)} ${event.title}</p>
                            <span class="inline-block mt-2 px-2 py-1 text-xs rounded bg-gray-200 text-gray-700">${event.type.charAt(0).toUpperCase() + event.type.slice(1)}</span>
                        </div>
                    `;
                });
            }
            document.getElementById('upcomingEventsList').innerHTML = html;
        }

        function updateAllEventsList() {
            let html = '';
            const sortedEvents = [...calendarEvents]
                .sort((a, b) => a.date - b.date);
            
            if (sortedEvents.length === 0) {
                html = '<tr><td class="px-6 py-4 text-center text-gray-500" colspan="5">No events scheduled</td></tr>';
            } else {
                sortedEvents.forEach(event => {
                    const dateStr = event.date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
                    const isUpcoming = event.date >= new Date();
                    const status = isUpcoming ? '<span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded">Upcoming</span>' 
                                              : '<span class="px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded">Completed</span>';
                    
                    html += `
                        <tr class="hover:bg-gray-50 transition">
                            <td class="px-6 py-4 text-sm">
                                <span class="px-2 py-1 ${getEventTypeColor(event.type)} text-xs rounded font-medium">${event.type}</span>
                            </td>
                            <td class="px-6 py-4 text-sm font-medium text-gray-900">${getEventTypeIcon(event.type)} ${event.title}</td>
                            <td class="px-6 py-4 text-sm text-gray-600">${dateStr}</td>
                            <td class="px-6 py-4 text-sm">${status}</td>
                            <td class="px-6 py-4 text-sm">
                                <button class="text-indigo-600 hover:text-indigo-900 font-semibold">View Details</button>
                            </td>
                        </tr>
                    `;
                });
            }
            document.getElementById('allEventsList').innerHTML = html;
        }

        function selectCalendarDate(date) {
            currentCalendarDate = new Date(date);
            renderCalendar();
        }

        function previousMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
            renderCalendar();
        }

        function goToToday() {
            currentCalendarDate = new Date();
            renderCalendar();
        }

        // ====================================================
        // PREVENT ZOOM & PINCH GESTURES
        // ====================================================

        // Set initial zoom to 100% and lock it
        if (window.devicePixelRatio > 1) {
            document.documentElement.style.zoom = 1 / window.devicePixelRatio;
        }

        // Prevent all zoom gestures
        let lastZoomTime = 0;
        let lastZoomLevel = 1;

        // Continuously monitor zoom level
        setInterval(function() {
            if (window.devicePixelRatio !== lastZoomLevel) {
                lastZoomLevel = window.devicePixelRatio;
                document.documentElement.style.zoom = 1;
                document.body.style.zoom = 1;
            }
        }, 100);

        // Disable pinch-to-zoom on touch devices
        document.addEventListener('touchmove', function(event) {
            if (event.touches.length > 1) {
                event.preventDefault();
            }
        }, { passive: false });

        // Disable double-tap zoom more aggressively
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
                return false;
            }
            lastTouchEnd = now;
        }, { passive: false });

        // Prevent zoom via keyboard
        document.addEventListener('keydown', function(event) {
            if ((event.ctrlKey || event.metaKey) && (event.key === '+' || event.key === '-' || event.key === '0')) {
                event.preventDefault();
                return false;
            }
        });

        // Disable zoom via mouse wheel (Ctrl + scroll)
        document.addEventListener('wheel', function(event) {
            if (event.ctrlKey || event.metaKey) {
                event.preventDefault();
                return false;
            }
        }, { passive: false });

        // Prevent zoom on all interactive elements
        document.addEventListener('click', function(event) {
            // Reset zoom on any click
            if (window.devicePixelRatio !== 1) {
                document.documentElement.style.zoom = 1;
                document.body.style.zoom = 1;
            }
        }, true);

        // Prevent zoom on focus (especially for inputs)
        document.addEventListener('focus', function(event) {
            if (event.target.matches('input, textarea, select, button')) {
                document.documentElement.style.zoom = 1;
                document.body.style.zoom = 1;
            }
        }, true);

        // Lock viewport on resize
        window.addEventListener('resize', function() {
            if (window.innerHeight < window.innerWidth) {
                document.documentElement.style.zoom = 1;
                document.body.style.zoom = 1;
            }
        });

        // ====================================================
        // INITIALIZE ON PAGE LOAD
        // ====================================================

        document.addEventListener('DOMContentLoaded', function() {
            // Reset zoom on load
            document.documentElement.style.zoom = 1;
            document.body.style.zoom = 1;
            
            // Reset body display properties
            document.body.style.display = '';
            document.body.style.flexDirection = '';
            document.body.style.alignItems = '';
            document.body.style.justifyContent = '';
            document.body.style.minHeight = '';
            
            // Set default user info if not set
            const sidebarUsername = document.getElementById('sidebarUsername');
            const sidebarUserrole = document.getElementById('sidebarUserrole');
            const topNavUsername = document.getElementById('topNavUsername');
            const greetingName = document.getElementById('greetingName');
            
            if (!sidebarUsername.textContent) {
                sidebarUsername.textContent = 'Admin User';
                sidebarUserrole.textContent = 'Administrator';
                topNavUsername.textContent = 'Admin User';
                greetingName.textContent = 'Admin';
            }
            
            // Ensure sidebar and content are visible
            const sidebar = document.getElementById('sidebar');
            const contentArea = document.getElementById('contentArea');
            const main = document.querySelector('main');
            
            if (sidebar) sidebar.style.display = '';
            if (contentArea) contentArea.style.display = '';
            if (main) main.style.display = '';
            
            // Show admin nav by default
            const adminNav = document.getElementById('adminNav');
            const trainingManagerNav = document.getElementById('trainingManagerNav');
            const studentNav = document.getElementById('studentNav');
            
            if (adminNav) adminNav.classList.remove('hidden');
            if (trainingManagerNav) trainingManagerNav.classList.add('hidden');
            if (studentNav) studentNav.classList.add('hidden');
            
            // Hide login modal
            const loginModal = document.getElementById('loginModal');
            if (loginModal) {
                loginModal.classList.add('hidden');
            }
            
            // Set first section as active
            const firstSection = document.querySelector('.content-section');
            if (firstSection) {
                firstSection.classList.add('active');
            }
            
            // Initialize calendar for students
            renderCalendar();
        });

</script>


</body>
</html>
